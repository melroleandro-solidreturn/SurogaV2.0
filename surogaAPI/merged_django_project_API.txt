# --- App:  - File: manage.py ---

#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'surogaAPI.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()


# --- App:  - File: geberat-openAI-sc.py ---

import os

"""
This Python script is designed to traverse a Django project's directory structure and merge the content of Python files into a single output file. The intended use is to facilitate code analysis or submission to services like OpenAI, where a consolidated representation of the project is beneficial.

The script performs these primary tasks:

1. It defines a list of Django components (e.g., settings.py, urls.py) that it will search for within the project structure. This list can be expanded with additional Python files deemed relevant for inclusion.

2. The script walks the project's directory tree starting from a specified root path and identifies Python files to be included in the merging process.

3. As it processes each file, the script constructs a header/commentary that marks the start of each new Django component from the different apps or project root. This helps demarcate where one file's content ends, and another begins in the merged output.

4. It reads the content of each identified Python file and writes it to a specified output file, including the headers and necessary separation between files for readability and organization.

5. The result is a single file that aggregates the Python components from the Django project, ready to be used for analysis or any other purpose that would benefit from such consolidated formatting.

Please note: This script should be customized with the proper project root path and desired output file path before execution. Additionally, the environment must have Python installed and the necessary permissions to read the project files and write to the output destination.
"""

# Define the function that merges Django project files...
# rest of the script


def merge_django_project_files(project_root_path, output_file_path):
    # Define the order of merging based on typical Django project structure
    django_components = [
        'settings.py',
        'urls.py',
        'wsgi.py',
        'asgi.py',
        'models.py',
        'views.py',
        'forms.py',
        'admin.py',
        'apps.py',
        'tests.py',
        'tasks.py',
        # Add any other python file you might consider relevant
    ]

    # Open the output file in write mode
    with open(output_file_path, 'w') as merged_file:
        for root, dirs, files in os.walk(project_root_path):
            for file_name in files:
                if file_name.endswith('.py'):  # Considering only Python files
                    # Determine the app name by the relative path to the project root
                    app_name = os.path.relpath(root, project_root_path).replace(os.path.sep, '.')
                    # Before writing the app and file names, we check that it is not the project root
                    if app_name == '.':  # If the file is in the root, app_name should be empty
                        app_name = ''
                    # Write a delimiter with the app name and the name of the file
                    merged_file.write(f"# --- App: {app_name} - File: {file_name} ---\n\n")
                    # Append the content of the file
                    with open(os.path.join(root, file_name), 'r') as file:
                        merged_file.write(file.read())
                        merged_file.write("\n\n")

# Placeholder path for where the script should write the merged project file
output_path = 'merged_django_project.txt'
# Placeholder path for your Django project's root directory (to be replaced with the actual path)
project_root_path = '.'

# Merge the project files into one
merge_django_project_files(project_root_path, output_path)

# --- App: surogaAPI - File: settings.py ---

"""
Django Settings Configuration for the SurogaAPI Project

This file contains a comprehensive list of settings that configure the core behavior of the SurogaAPI Django
application. Settings cover everything from database connections, internationalization preferences,
middleware components, static file handling, security precautions, to custom application variables.

Remark: The configurations herein are tailored for both development and production environments.
Special attention should be given to securing sensitive information such as secret keys, database credentials,
and third-party API tokens. It's advisable to utilize environment variables or dedicated secrets management
tools for production deployments.

Reference Documentation:
- Django settings: https://docs.djangoproject.com/en/4.0/topics/settings/
- Deployment checklist: https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/
"""

from pathlib import Path
import os
from decouple import config

# Build paths inside the project like this: BASE_DIR / 'subdir'.
# BASE_DIR is a reference to the root directory of the Django project. It is used to construct paths 
# throughout the rest of the settings file in a platform-independent way.

BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# The following lines provide instructions and warnings about settings that are specific to a development 
# environment and should be changed or secured when deploying to a production environment.

# SECURITY WARNING: keep the secret key used in production secret!
# SECRET_KEY is a critical setting that should be kept secret and unique to each Django project. It's used for cryptographic signing and should never be checked into version control in production.
SECRET_KEY = config('SECRET_KEY')

# SECURITY WARNING: don't run with debug turned on in production!
# DEBUG is a boolean that turns on/off debug mode. Never deploy a site into production with DEBUG turned on.
DEBUG = True

# ALLOWED_HOSTS defines a list of host/domain names that this site can serve. This is a security measure 
# to prevent HTTP Host header attacks, which are possible even under many seemingly-safe web server configurations.
ALLOWED_HOSTS = ['127.0.0.1','suroo-api-eu.azurewebsites.net','localhost']


# Application definition
# INSTALLED_APPS is a list of strings designating all applications that are enabled in this Django project. 
# These are used to include various configurations and features from the apps to the project.
INSTALLED_APPS = [
    # Default Django apps that provide the base authentication system, session management,
    # messaging framework, and static assets handling.
    'django.contrib.auth',  # User authentication system
    'django.contrib.contenttypes',  # Framework for content types used by Django's permission system
    'django.contrib.sessions',  # Session framework for managing user sessions
    'django.contrib.messages',  # Messaging framework for displaying temporary messages to the user
    'django.contrib.staticfiles', # Managing static files (CSS, JavaScript, Images)
    
    # Third-party app 'widget_tweaks' allows for easy manipulation of form rendering in templates.
    'widget_tweaks',

    # Custom apps created for the Suroga API project; these contain the business logic and data models.
    'core', # May handle core functionality that's common across the application
    'supplier', # Manages suppliers on the platform
    'kit',  # Manages kits, could be related to equipment or packages needed for rides
    'partner', # Manages partner entities or accounts on the platform
    'rides',# Handles the logic and data models for booking and managing rides

    # Django Rest Framework (DRF) apps that provide tools to build web APIs.
    'rest_framework', # Core framework for building RESTful APIs in Django
    'django.contrib.admin',  # These configuration settings include Django’s built-in admin application
    'rest_framework.authtoken', # Token-based authentication for APIs in Django

    # Django Rest Framework API logger app for tracking requests to the API and logging them.
    'drf_api_logger',  # Captures and logs API requests and responses
]

# MIDDLEWARE is a list of middleware to use during request/response processing.
# Order is important and may affect behavior.
MIDDLEWARE = [
    # Adds security features to the HTTP responses. A key middleware that's crucial for safe web operations.
    'django.middleware.security.SecurityMiddleware', 
    
    # Manages sessions across requests, crucial for keeping a persisting state (e.g., login sessions) across the browser visits.
    'django.contrib.sessions.middleware.SessionMiddleware',
    
    # WhiteNoise allows Django to serve static files efficiently, especially suitable for production use.
    "whitenoise.middleware.WhiteNoiseMiddleware",
    
    # Handles some common tasks — it can block User-Agents and set Content-Length, among other things.
    'django.middleware.common.CommonMiddleware',
    
    # Provides protection against Cross-Site Request Forgeries, which is crucial for security.
    'django.middleware.csrf.CsrfViewMiddleware',
    
    # Associates users with requests using sessions. This is essential for handling user logins.
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    
    # Handles temporary messages (flash messages) transfer between views.
    'django.contrib.messages.middleware.MessageMiddleware',
    
    # Adds protection against clickjacking. Prevents render of your pages in an iframe.
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    
    # The 'drf_api_logger' middleware captures all the requested endpoint requests and responses.
    # It is useful for debugging and logging API usage.
    'drf_api_logger.middleware.api_logger_middleware.APILoggerMiddleware',  #API loger
]

# Root URL configuration
# ROOT_URLCONF points to the Python module that contains the root URL patterns for the project.
ROOT_URLCONF = 'surogaAPI.urls'

# Login URLs
# LOGIN_REDIRECT_URL is the path to redirect to after successful login when no 'next' parameter is present.
LOGIN_REDIRECT_URL = '/partner/confirmLogin'

# LOGIN_URL is the path to redirect to for login, typically the path to a login view.
LOGIN_URL = 'login'

# Uncomment the following line if a custom user model is used instead of Django's built-in User model.
# AUTH_USER_MODEL = 'core.User'

# TEMPLATES configures the engine and directory for Django templates.
TEMPLATES = [
    {
        # 'BACKEND' specifies which template engine to use. Here, Django's built-in template engine is used.
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        
        # 'DIRS' is a list of filesystem directories to check when loading templates. It's a way to tell Django where 
        # it should look for template files before it checks the app-specific template directories.
        # BASE_DIR / 'templates' defines a common folder at the root of the project for non-app-specific templates.
        'DIRS': [os.path.join(BASE_DIR,'templates')],
        
        # 'APP_DIRS' when set to True, allows the template engine to look for templates inside installed applications.
        # Each Django application can have its own 'templates' directory which Django will check.
        'APP_DIRS': True,
        
        # 'OPTIONS' provides a collections of custom settings for the template engine.
        # Context processors add variables or information to the context that is passed to every template:
        'OPTIONS': {
            'context_processors': [
                # Adds debug context variables if DEBUG is True.
                'django.template.context_processors.debug',
                
                # Adds 'request' to the context – enabling access to the current HttpRequest in templates.
                'django.template.context_processors.request',
                
                # Adds the 'user' and 'perms' context variables, enabling access to the current user and permissions.
                'django.contrib.auth.context_processors.auth',
                
                # Adds the 'messages' context variable, enabling access to user messages (from Django's messaging framework).
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

# WSGI_APPLICATION refers to the Python path of the WSGI application that Django's built-in server will use.
WSGI_APPLICATION = 'surogaAPI.wsgi.application'

# Internationalization
# Langauges configuration for Django. These are the languages this Django project will support.
LANGUAGES = (
    ('en', 'English'),
    ('pt', 'Português'),
)

# MODELTRANSLATION_DEFAULT_LANGUAGE sets the default language to be used with Django's model translation package.
MODELTRANSLATION_DEFAULT_LANGUAGE = 'en'

# Database Configuration
# DATABASES is a dictionary that configures the database(s) to be used with Django.
# https://docs.djangoproject.com/en/4.0/ref/settings/#databases

DATABASES = {
    # Option that was previously used or can be used for connecting
    # to a Microsoft SQL Server (mssql) database hosted on Azure (as can be deduced from the HOST value). Important
    # details such as HOST, NAME, USER, and PASSWORD would need to be adjusted for actual deployment. However, this 
    # information, particularly the password, should never be committed to version control for security reasons.
    
    #'default': {
    #    'ENGINE': 'mssql',
    #    'HOST': 'tcp:surogasql.database.windows.net',
    #    'NAME': 'surogasql',
    #    'USER':'carlos.leandro@suroga.com',
    #    'PASSWORD':'g66Jv55TejpJNVA',
    #    'PORT': '1433',
    #    'OPTIONS': {
    #        'driver': 'ODBC Driver 17 for SQL Server',
    #        'extra_params':'Authentication=ActiveDirectoryPassword'
    #    }
        
    #}
    
    # For local development or small-scale deployments, the project is set up to use SQLite - this is represented 
    # by the 'default' engine setting.
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password Validators
# AUTH_PASSWORD_VALIDATORS is a list of validators that are used to check the strength of user passwords.

AUTH_PASSWORD_VALIDATORS = [
    {
        # Checks the similarity between the password and a set of attributes of the user.
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
        # This validator helps prevent users from using passwords that are too similar to their personal information,
        # making it harder for attackers to guess passwords based on user data like username or email.
    },
    {
        # Ensures that a password meets a minimum length, which is a common security requirement.
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        # You can set the `OPTIONS` for this validator to specify the `min_length` attribute (default is 8 characters).
        # Longer passwords typically enhance security by making them harder to crack.
    },
    {
        # Checks whether a password is not a common password.
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
        # This validator uses a list of the most common passwords, which must not be used by users.
        # It is important in preventing the use of passwords which are commonly used and hence are likely to be guessed.
    },
    {
        # Validates whether a password is not entirely numeric.
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
        # Numeric-only passwords are typically easier to guess or crack, so this enforces more complexity.
    },
    # These validators are used when creating a new user or changing passwords. It is important to configure them according
    # to the security policies and requirements of your project. By default, Django enforces these validators to encourage
    # good security practices, but they can be adjusted or extended by creating and adding custom validators if needed.
]

# Django REST Framework Configuration
# REST_FRAMEWORK is a dictionary that configures the behavior of Django REST framework, which provides tools
# for building Web APIs.
REST_FRAMEWORK = {
    # DEFAULT_PERMISSION_CLASSES defines the permissions to apply by default to all views. In this configuration,
    # DjangoModelPermissionsOrAnonReadOnly allows read-only access to unauthenticated users, but other operations
    # like create/update/delete require authentication and the appropriate model permissions.
    
    # DEFAULT_SCHEMA_CLASS sets the class to use for generating API schemas.
    
    # DEFAULT_AUTHENTICATION_CLASSES specifies the authentication methods the API will use. 
    # TokenAuthentication is enabled, which means clients will have to include a valid token in the headers of their 
    # requests to perform authenticated API operations.
    
    # DATE_INPUT_FORMATS defines acceptable date input formats that can be used to parse dates in serializers.
    
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly'
    ],
    'DEFAULT_SCHEMA_CLASS': 'rest_framework.schemas.coreapi.AutoSchema',
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',  
    ],
    'DATE_INPUT_FORMATS': ['iso-8601', '%Y-%m-%dT%H:%M:%S.%fZ'],
}

# API Logger Configuration
# DRF_API_LOGGER configuration determines how API requests and responses are logged when using Django REST framework.

# DRF_API_LOGGER_SKIP_URL_NAME specifies a list of URL names to exclude from logging.
DRF_API_LOGGER_SKIP_URL_NAME = ['events']

# DRF_API_LOGGER_DATABASE is a boolean indicating whether to save API logs to the database.
DRF_API_LOGGER_DATABASE = True

# DRF_API_LOGGER_EXCLUDE_KEYS is a list of sensitive keys whose values should be excluded from the API logs.
DRF_API_LOGGER_EXCLUDE_KEYS = ['password', 'token', 'access', 'refresh']

# DRF_API_LOGGER_METHODS is a list of HTTP methods to include in the logging.
DRF_API_LOGGER_METHODS = ['GET', 'POST', 'DELETE', 'PUT'] 

# DRF_API_LOGGER_STATUS_CODES is a list of HTTP status codes to include in the logging.
DRF_API_LOGGER_STATUS_CODES = ['200', '400', '404', '500'] 

# DRF_LOGGER_QUEUE_MAX_SIZE specifies the max size of the queue for batching log entries before saving to database.
DRF_LOGGER_QUEUE_MAX_SIZE = 1 #50 # Originally set to 50, but reduced for this example.


# Internationalization and Localization
# Configuration of internationalization (i18n), date formats, and time zones.

# DATETIME_FORMAT specifies the string format for datetime objects throughout the project.
DATETIME_FORMAT = '%Y-%m-%dT%H:%M:%S.%fZ'

# LANGUAGE_CODE sets the default language for the project (US English).
LANGUAGE_CODE = 'en-us'

# TIME_ZONE configures the time zone for the project.
TIME_ZONE = 'UTC'

# USE_I18N is a boolean that enables Django's translation system (i18n).
USE_I18N = True

# USE_TZ is a boolean that enables timezone support.
USE_TZ = True

# Email Configuration
# Settings to configure the email backend, including SMTP server details and credentials.

# EMAIL_BACKEND specifies Django’s email backend to use.
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'

# The EMAIL_HOST, EMAIL_HOST_USER, and EMAIL_HOST_PASSWORD are used to connect to the email server.
EMAIL_HOST=config('EMAIL_HOST')
EMAIL_HOST_USER=config('EMAIL_HOST_USER')
EMAIL_HOST_PASSWORD = config('EMAIL_HOST_PASSWORD') 

# EMAIL_PORT is the SMTP server port to use.
# EMAIL_USE_TLS/SSL specify whether to use TLS/SSL encryption when sending emails.
EMAIL_PORT= config('EMAIL_PORT', cast=int)
EMAIL_USE_TLS = config('EMAIL_USE_TLS', cast=bool) 
EMAIL_USE_SSL = config('EMAIL_USE_SSL', cast=bool) 

DEFAULT_FROM_EMAIL = EMAIL_HOST_USER # The default from email address used in emails sent by Django.


# Static Files Configuration
# Specifies URL and directories for handling static files such as CSS, JavaScript, and images.

# STATIC_URL is the URL to use when referring to static files.
STATIC_URL = '/static/'

# STATICFILES_DIRS specifies a list of filesystem directories to check when loading static files.
#azure: STATIC_ROOT = os.path.join(BASE_DIR, 'static')
STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]

# Other Settings
# Various other Django settings follow, possibly related to specific deployment scenarios (e.g., Azure),
# default field types for database models, API trust settings, etc. Some are commented out and prefaced with 
# 'azure:' indicating they might be used in a specific deployment context (e.g., Azure).


#azure: STATICFILES_STORAGE = "whitenoise.storage.CompressedManifestStaticFilesStorage"

#azure: CSRF_TRUSTED_ORIGINS = ['https://suroo-api-eu.azurewebsites.net','https://suroo-api-eu.azurewebsites.net']

# Default primary key field type # test
# https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field

#azure: DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

#azure: APPEND_SLASH = True

# Miscellaneous
# Additional placeholders and variables used elsewhere in the project.
IP_PLACEHOLDER = "2001:8a0:6a14:6900:325a:3aff:fe00:9000"
EMAILMARKET = config('EMAILMARKET')
DOMAIN = config('DOMAIN')

# --- App: surogaAPI - File: urls.py ---

"""surogaAPI URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/4.0/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path, include
from django.urls import re_path as url
from django.contrib.auth import views as auth_views
from rest_framework import routers, serializers, viewsets
from rest_framework.schemas import get_schema_view
from rest_framework.documentation import include_docs_urls

from core import views as coreviews

# urlpatterns define the URL routing for the Suroga API project.
urlpatterns = [
    # Includes URL patterns from the 'partner' app, using a namespace to differentiate these URLs
    # from others that may have the same name in different apps.
    path('partner/',include('partner.urls', namespace='partner')),
    
    # Django's built-in administrative interface. Only intended for use by site administrators.
    path('admin/', admin.site.urls),
    
    # Includes URL patterns from the 'core' app, namespaced for 'core', used for API endpoints.
    path('api/v1/',include('core.urls', namespace='core')),
    
    # URLs for Django REST framework's own login and logout views.
    # These are typically used for browsable API views, which are useful during development.
    path('api-auth/', include('rest_framework.urls')),
    
    # Generates and serves the API documentation page using Django REST framework's documentation feature.
    # These URLs are serialized and presented in an interface for developers to read and understand
    # the capabilities of the API.
    path('docs', include_docs_urls(
        title="SurOO openapi: Surrogate your rides",
        description="API is used to build bridges between the real and the virtual world.\n Surrogate rides in your APP.",
    )),


    # Serves the generated OpenAPI schema at the `/openapi` endpoint, providing a machine-readable
    # definition of the API that can be used by a variety of tools, such as code generators, documentation
    # generators, and API testing tools. The OpenAPI standard is widely supported and enables interoperability.
    path('openapi', get_schema_view(
        title="SurOO openapi: Surrogate your rides",
        description="API is used to build bridges between the real and the virtual world.\n Surrogate rides in your APP.",
        version="1.0.0"
    ), name='openapi-schema'),
   
    # The root endpoint of the website, which serves the index view from the 'core' app. This view
    # might display a landing page or redirect to a main part of the application.
    path('', coreviews.index, name='index'),
]


# --- App: surogaAPI - File: wsgi.py ---

"""
WSGI config for the SurogaAPI project.

The Web Server Gateway Interface (WSGI) is a specification for a universal interface 
between the server and web applications. This module, typically named 'wsgi.py', is used 
by Django's deployment process to interface with web servers, such as Apache or gunicorn, 
which serve the actual web pages in a production environment.

This particular file exposes the WSGI callable — this callable object (a function, method, class, 
or an instance with a `__call__` method) is called by the WSGI server to handle each request. 
In Django, the WSGI callable is an instance of the application class provided by Django's 
core WSGI handler, `get_wsgi_application()`.

The `os.environ.setdefault` line sets the `DJANGO_SETTINGS_MODULE` environment variable, 
which provides the Python import path to your Django project's settings module. 
This is how Django knows which settings to use for the particular instance of the application.

For more detailed information about how this works and how to deploy Django using WSGI, 
visit the official Django documentation:
https://docs.djangoproject.com/en/4.0/howto/deployment/wsgi/
"""

import os

# Import Django's function for fetching the WSGI application.
from django.core.wsgi import get_wsgi_application

# Set the default Django settings module for the 'surogaAPI' project.
# This environment variable tells Django which settings to use. If it's not set, Django won't work properly.
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'surogaAPI.settings')

# Get the WSGI application callable that Django provides by default.
# It's used as a hook for WSGI-compliant web servers to serve your project.
application = get_wsgi_application()


# --- App: surogaAPI - File: __init__.py ---



# --- App: surogaAPI - File: asgi.py ---

"""
ASGI config for the SurogaAPI project.

The Asynchronous Server Gateway Interface (ASGI) is a specification for Python web applications to communicate 
with web servers, and it is particularly suited for handling asynchronously rather than the synchronous 
approach taken by WSGI, its predecessor. It provides a standard for building asynchronous web applications 
in Python with frameworks that can handle long-lived connections, such as WebSockets, HTTP/2, and more. 

This module, normally named 'asgi.py', configures the ASGI application for the Django project and 
makes it possible to serve the application via ASGI-compliant web servers. Compared to WSGI, ASGI 
supports asynchronous request processing, which allows for more scalable applications that can 
handle simultaneous connections or long-running operations more efficiently.

The `asgi.py` file exposes the ASGI callable — a function or object instance with a `__call__` method. 
This callable is used by ASGI servers to serve the Django application when deployed. It is analogous to 
the WSGI callable provided in `wsgi.py`, but it is designed for asynchronous applications.

To define the 'application' callable, Django provides an 'asgi' module, and specifically a 
`get_asgi_application()` function, which is imported here and used to create the ASGI application instance.

As with WSGI, the 'os.environ.setdefault' call sets the 'DJANGO_SETTINGS_MODULE' before the application 
is created, to tell Django which settings module should be used.

For additional information on ASGI and how to deploy Django applications with ASGI, see the Django official 
documentation: https://docs.djangoproject.com/en/4.0/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

# Set the default environment variable for Django's settings module.
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'surogaAPI.settings')

# Create the ASGI application instance to be used by an ASGI server.
application = get_asgi_application()


# --- App: core - File: tests.py ---

from django.test import TestCase
from django.urls import reverse
from .models import time_zone, Language, Currency, country, citymunicipality
from django.contrib.auth.models import User

"""
Core Application Test Cases - Suroga API

This module contains a suite of test cases for the Core application of the Suroga API project. These tests 
are designed to ensure that the application's models and their methods behave as expected. Unit tests can 
save time and prevent errors by automatically checking for the correct behavior during development and before deployment.

The `TestCase` class from Django's testing framework provides a set of assertions to verify conditions 
and a test database isolated from the production data. Here we include tests for the string representation 
(`__str__`) methods of the models, which are crucial for accurate identification in the Django admin and 
throughout the application.

Usage:
- `setUpTestData`: Used to create objects shared by all test methods. Objects created here use the test database 
  and are cleaned up after all the tests in the `TestCase` class have run.
- `setUp`: Used to set up objects that may be modified by the tests themselves. Each test method will get a fresh 
  copy of these objects.
- Individual test methods: Defined to perform specific assertions.

Examples:
- Ensuring models return their `name` as their string representation.
- Verifying the correctness of model fields and properties.
- Checking the integrity of application logic under various conditions.

Maintainer: Carlos Leandro
Last updated: 15/3/2014

Refer to Django's testing documentation for detailed instructions on writing and running tests:
https://docs.djangoproject.com/en/4.0/topics/testing/
"""

# CoreModelTests is a TestCase class containing a collection of unit tests for the models in the core app.
class CoreModelTests(TestCase):

    @classmethod
    def setUpTestData(cls):
        # This method is called once at the beginning of the test run for setting up class-level test data.
        # Here, it's used to create a test user that can be shared across several different tests.
        cls.test_user = User.objects.create_user('testuser', password='12345')

    def setUp(self):
        # The setUp method is called before every test function to set up any objects that may be modified by the test.
        # If there is no setup necessary beyond what's done in setUpTestData, you can simply pass.
        pass

    def test_str_method_time_zone(self):
        # Ensures the __str__ method of the time_zone model works correctly by returning the time zone's name.
        # Creates a new time_zone instance and compares the result of converting it to a string with the expected name.
        time_zone_obj = time_zone.objects.create(Name='UTC', TimeZone='Universal Time Coordinated', UTCoffset=0)
        self.assertEqual(str(time_zone_obj), time_zone_obj.Name)

    def test_str_method_language(self):
        # Checks the Language model's __str__ method to verify it properly returns the name of the language.
        # It's important that such fundamental methods of models return the correct values for ease of admin interface use and debugging.
        language_obj = Language.objects.create(Name='English', Code='en')
        self.assertEqual(str(language_obj), language_obj.Name)

    def test_str_method_currency(self):
        # Tests the __str__ method of the Currency model to ensure it matches the expected behavior, 
        # which, in this case, is returning the currency's name.
        currency_obj = Currency.objects.create(Name='Euro', Currency='EUR', CurrencySymbol='€', SymbolRight=False)
        self.assertEqual(str(currency_obj), currency_obj.Name)

    def test_str_method_country(self):
        # Validates that the __str__ method for the country model correctly outputs the country's name.
        # Comparing to hardcoded values is suitable for absolute outcomes such as this.
        country_obj = country.objects.create(Name='TestLand', PhoneCode='123')
        self.assertEqual(str(country_obj), country_obj.Name)

    def test_str_method_citymunicipality(self):
        # Assures that the __str__ method for citymunicipality outputs the correct city or municipality name.
        # This test also illustrates how a ForeignKey relationship needs to be set up, creating a needed 'district' instance first.
        district = districtregion.objects.create(Name='TestDistrict')
        city_municipality_obj = citymunicipality.objects.create(Name='TestCity', districtregion=district)
        self.assertEqual(str(city_municipality_obj), city_municipality_obj.Name)

# More tests can be added for each model and view within the core app.

# --- App: core - File: decorators.py ---

from django.contrib.auth import REDIRECT_FIELD_NAME
from django.contrib.auth.decorators import user_passes_test

"""
Core Application Decorators - Suroga API

This module defines custom decorator functions used within the Core application of the Suroga API project. 
Decorators are a powerful and reusable way to modify or enhance the behavior of functions or methods in Python, 
and in a Django context, they are typically used to enforce certain permissions or conditions on view functions.

Included Decorators:
- api_client_required: Ensures that a view can only be accessed by users with active client status. If a user 
  is not active, they are redirected to the login page.

These decorators allow for separation of concerns by handling checks and redirections away from the view logic itself, 
making code more modular, easier to read, and maintain.

By employing these decorators, we ensure consistent access control throughout the application and prevent unauthorized 
access to certain views that should only be available to specific user types or roles.

Maintainer: Carlos Leandro
Last updated: 15/3/2014

Example usage:
from core.decorators import api_client_required

@api_client_required
def my_view(request):
    # View logic here
"""


# The `api_client_required` is a custom decorator built on top of Django's built-in `user_passes_test` decorator.
# It is designed to verify whether the current user meets certain conditions – specifically, it checks if the
# user is active, which is a common criterion for allowing further access to certain API views or actions.


def api_client_required(function=None, redirect_field_name=REDIRECT_FIELD_NAME, login_url='login'):
    """
    Verify that the currently logged-in user is active.

    The decorator will check the user's `is_active` attribute, typically expecting it to be True. If the user is not
    active, this test will fail and the user will be redirected to the login URL provided, which can be specified if
    necessary.

    Parameters:
        function: The view function that is decorated.
        redirect_field_name: The name of a GET field to put in the URL when redirected (defaults to 'next').
        login_url: The URL of the login page, which defaults to 'login'.

    Returns:
        The actual view function if the check passes, otherwise, it redirects the user to the `login_url`.
        
    This decorator can be used on views that require the user to be a logged-in client with an active account. 
    Use it by adding `@api_client_required` above the view function that you want to protect.
    """
    # Builds the `actual_decorator` using the `user_passes_test` function from Django's authentication framework.
    actual_decorator = user_passes_test(
        lambda u: u.is_active, # The test function that checks if the user is active.
        login_url=login_url,    # If the test fails, the user is redirected to this login URL.
        redirect_field_name=redirect_field_name # The GET parameter name for the redirect field.
    )

    # If the decorator is applied to a function, it modifies the function to incorporate the test; otherwise,
    # it simply returns the decorator itself.
    if function:
        return actual_decorator(function)
    return actual_decorator

# --- App: core - File: urls.py ---


from django.urls import path, include,re_path
from rest_framework import routers, serializers, viewsets
from core.views import time_zoneViewSet , RideDurationViewSet #, ServiceTypeViewSet
#from core.views import PathTypeViewSet, LocalViewSet, CountryViewSet, CurrencyViewSet, LanguageViewSet # TechnologyViewSet,
from core.views import CountryViewSet, CurrencyViewSet, LanguageViewSet # TechnologyViewSet,
from core.views import districtregionViewSet, citymunicipalityViewSet
from core.views import equipmentViewSet, publiceventViewSet, soundViewSet, imageViewSet, localwifiViewSet 
from core.views import eventsViewSet

"""
Suroga API - Core Application URL Configuration

This module defines the URL routing for the Core application within the Suroga API project. Utilizing
Django Rest Framework's routing mechanisms, this configuration maps URL patterns to views for handling
API requests related to core functionalities such as time zones, ride durations, countries, currencies,
languages, and more.

Routes are defined using Django's path and include functions, as well as DRF routers for automatically
generating URLs for view sets. This setup is designed to be scalable and easily maintainable as the
application and its API capabilities continue to grow and evolve.

Each URL pattern corresponds to a specific view set, outlining the way HTTP requests are processed,
and determining the behavior expected for CRUD operations on the associated model instances.

References:
    - Django URL dispatcher documentation: https://docs.djangoproject.com/en/4.0/topics/http/urls/
    - Django Rest Framework routing: https://www.django-rest-framework.org/api-guide/routers/

Note: This file should only be modified if changes to URL patterns are required, ensuring that the
modifications adhere to the existing architectural standards and naming conventions.

Maintainer:  Carlos Leandro
Last Modified: 15/3/2024
"""

# Define the app namespace to allow for reverse-matching of URLs within this 'core' app.
app_name = 'core'

# Set up the Django Rest Framework (DRF) router, which helps generate URL patterns for a ViewSet automatically.
# The DRF routers determine the URL conf based on common naming conventions for common CRUD (Create-Read-Update-Delete) operations.
router = routers.DefaultRouter()

# The router registers multiple view sets with the corresponding URL pattern.
# This allows DRF to auto-generate URLs for accessing the API endpoints,
# typically ones that map closely to database models for CRUD operations.

# Each register call adds a new route to handle requests for listed time zones, durations, countries, currencies, etc. 
router.register(r'time_zones', time_zoneViewSet)
router.register(r'duration', RideDurationViewSet)
router.register(r'country', CountryViewSet)
router.register(r'currency', CurrencyViewSet)
router.register(r'language', LanguageViewSet)
router.register(r'district_region', districtregionViewSet)
router.register(r'city_municipality', citymunicipalityViewSet)
router.register(r'equipment', equipmentViewSet)
router.register(r'public_event', publiceventViewSet)
router.register(r'sound_requirements', soundViewSet)
router.register(r'image_requirements', imageViewSet)
router.register(r'local_wifi', localwifiViewSet)
router.register(r'events', eventsViewSet)


# urlpatterns is the list of URL patterns recognized by the app.
# Each element in the list associates a route pattern with a view or include for further pattern matching.
urlpatterns = [
    # Includes URL patterns for the 'rides' app within this 'core' app. The namespace 'rides' helps ensure reverse URL matching is unique.
    path('rides/',include('rides.urls', namespace='rides')),
    
    # Include router-generated URL patterns, which will cover the CRUD URLs for all registered view sets.
    # This is a shorthand to include all the URLs handled by the router, allowing DRF to handle the request dispatching.
    path('', include(router.urls)),
]

# --- App: core - File: extras.py ---


import threading

"""
Core Application Extra Utilities - Suroga API

This file provides supplementary utility classes and functions that augment the functionality of the Core application 
within the Suroga API. These utilities are not directly bound to models or views but provide important 
background capabilities such as asynchronous email sending.

Utility classes and functions included in this module:
- EmailThread: A utility class that extends Python's threading.Thread to enable asynchronous email sending. This allows 
  the application to send emails without blocking the response cycle of the request handler, improving the user experience by 
  decreasing wait times for actions that include email sending.

Usage of this class should be limited to lightweight background tasks to avoid resource-heavy operations that could interfere 
with the main thread's performance. For more heavy-duty background task handling, consider using a more robust job queuing 
system such as Celery with Redis/RabbitMQ.

Maintainer: Carlos Leandro
Last updated: 15/3/2024

Example usage:
from core.extras import EmailThread
from django.core.mail import EmailMessage

msg = EmailMessage('Subject', 'Message', to=['recipient@example.com'])
EmailThread(msg).start()
"""

# The EmailThread class inherits from Python's built-in Thread class to send emails asyncronously.
class EmailThread(threading.Thread):
    """
    A subclass of `threading.Thread` that sends an email in a separate thread.
    
    By using a separate thread to send the email, the main application can continue processing other
    requests without waiting for the email sending process to complete, which can significantly improve
    responsiveness when sending emails as part of request handling.
    
    The class is initialized with an `EmailMessage` or `send_mail` function call instance which it then
    runs in a separate thread upon calling the `start()` method.

    Example usage:
        msg = EmailMessage('Subject', 'Body', to=['recipient@example.com'])
        EmailThread(msg).start()

    Alternatively, the commented out `send_mail` example shows how the same can be accomplished without
    explicitly constructing an EmailMessage instance.

    Attributes:
        email: The email message instance that needs to be sent.
    """

    def __init__(self,email):
        self.email = email
        # Initialize the Thread part of this class by calling Thread's __init__ method.
        threading.Thread.__init__(self)

    def run(self):
        # This method is called when the thread is started. It sends the email, ensuring
        # that 'fail_silently=False' so exceptions are raised rather than silenced.
        self.email.send(fail_silently=False)

# --- App: core - File: models.py ---

import datetime
import hashlib
import json
import requests
import ipaddress

from django.dispatch import receiver
from django.db import models, IntegrityError
from django.contrib.auth.models import AbstractUser
from django.utils import timezone
from django.conf import settings as conf_settings

from django.contrib.auth import get_user_model
from django.contrib.auth.signals import user_logged_in

User = get_user_model()

"""
Core Application Models - Suroga API

This module defines the data models related to the core functionality of the Suroga API. These models serve as the
blueprint for creating the database schema and define the structure of the database records for various entities such as
local Wi-Fi configurations, endpoint versions for API management, communication channels for CRM and support, and more.

The classes included here are utilized throughout the application, where database interactions are required. Each class
corresponds to a table in the database and each attribute of a class is a field in the table.

- localwifi: Provides data around various Wi-Fi configurations offered by local venues or the service itself.
- version: Manages the versioning of configuration data associated with different API endpoints.
- commchannel: Outlines the communication preferences and channels for the API services in different regions/countries.
- Additional: Models such as `userloginlog`, `events`, `RideDuration`, `equipment`, `publicevent`, `sound`,
  and `image` each represent an important aspect of the data managed through the Core application of the Suroga API.

Refer to Django's model field reference for a deeper understanding of field options:
https://docs.djangoproject.com/en/4.0/ref/models/fields/

Maintainer: Carlos Leandro
Last Modified:  15/3/2024

"""

#from rides.models import Ride, Booking


class time_zone(models.Model):
    """
    Model representing a time zone, which is an area of the earth that observes a standard time for legal, commercial, and social purposes.
    
    Attributes:
        Name: A human-readable name for the time zone (e.g., 'Eastern Standard Time').
        TimeZone: A string representing the actual time zone (e.g., 'EST', 'UTC-05:00').
        UTCoffset: The standard offset from UTC time in hours for this time zone.
    """
    # Define fields for the time_zone model with validation rules and help text for form rendering.
    Name = models.CharField(max_length=100,  blank=False, help_text = "Name")
    TimeZone = models.CharField(max_length=100,  blank=False,  help_text = "TimeZone")
    UTCoffset = models.DecimalField(max_digits=2, decimal_places=0,default=0, help_text = "UTC offset") 
      
    class Meta:
        # Define how multiple instances of the model should be referred to in the admin interface.
        verbose_name_plural = "Time zones"
    def __str__(self):
        # Return the model's name as its string representation, which is displayed in the admin interface and when the model is cast to a string.
        return self.Name

class Language(models.Model):
    """
    Model representing a language supported by the service.
    
    Attributes:
        Name: The name of the language (e.g., 'English', 'Portuguese').
        Code: A short code representing the language (e.g., 'en' for English, 'pt' for Portuguese).
    """
    # Each field definition, such as 'CharField' specifies the type of data and how it should be stored in the database.
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "")
    Code = models.CharField(default='', max_length=5, blank=True, help_text = "")
    class Meta:
        verbose_name_plural = "Languages"
    def __str__(self):
        return self.Name

class Currency(models.Model):
    """
    Model representing a currency used in financial transactions.
    
    Attributes:
        Name: A full human-readable name of the currency (e.g., 'Euro').
        Currency: A string identifier for the currency unit (e.g., 'EUR' for Euro).
        CurrencySymbol: The symbol used for the currency (e.g., '€' for Euro).
        SymbolRight: A boolean indicating if the currency symbol should be displayed to the right of amounts (e.g., 'True' might indicate a format like '100€').
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "")
    Currency = models.CharField(default='EURO', max_length=30, blank=False, help_text = "Country currency.") 
    CurrencySymbol = models.CharField(default='€', max_length=5, blank=False, help_text = "Country currency Sym.") 
    SymbolRight = models.BooleanField(default=False, help_text = "True if country is open to registration.")
     
    class Meta:
        verbose_name_plural = "Currencies"
    def __str__(self):
        return self.Name

class country(models.Model):
    """
    Model representing a country where services are available.
    
    Attributes:
        Name: The name of the country.
        Currency: A ForeignKey reference to a Currency instance, representing the currency used in this country.
        Language: A ForeignKey reference to a Language instance, representing the official or prevalent language(s) of this country.
        PhoneCode: The international telephone dialing prefix for this country.
        TimeZone: A ForeignKey reference to a TimeZone instance, representing the time zone(s) utilized in this country.
        VAT: The standard rate of Value-Added Tax (VAT) applied to goods and services in this country.
        GPS_latitude: Central geographic latitude used for mapping services.
        GPS_longitude: Central geographic longitude used for mapping services.
        ZoomLevel: Default zoom level used when displaying this country on a map.
        GoogleCode: A country-specific code used by Google services.
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "Country Nome")
    Currency =  models.ForeignKey(Currency, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Country Currency") 
    Language =  models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Country Language") 
    PhoneCode = models.CharField(max_length=5, unique=True, blank=False, help_text = "Country Phone Code")
    time_zone =  models.ForeignKey(time_zone, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Country time zone") 
    VAT = models.DecimalField(max_digits=5, decimal_places=2,default=23.0, help_text = "Country VAT") 
    GPS_latitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "Country central GPS latitude") 
    GPS_longitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "Country central GPS latitude") 
    ZoomLevel = models.IntegerField(default=15, help_text = "Country Zoom Level") 
    GoogleCode = models.CharField(default='', max_length=2, blank=True, help_text = "Country Google Code")
    
    class Meta:
        verbose_name_plural = "Countries"
    def __str__(self):
        return self.Name

class districtregion(models.Model):
    """
    Represents a geographical district or region where the Suroga service operates.
    
    Attributes:
        Name: The official name of the district or region.
        GPS_latitude: The central latitude coordinate used for location purposes.
        GPS_longitude: The central longitude coordinate used for location purposes.
        ZoomLevel: A value indicating the default zoom level on maps for this region.
        GoogleCode: A two-letter code representing the region for use with Google services.
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "Service district")
    GPS_latitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "District central GPS latitude") 
    GPS_longitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "District central GPS latitude") 
    ZoomLevel = models.IntegerField(default=15, help_text = "District Zoom Level") 
    GoogleCode = models.CharField(default='', max_length=2, blank=True, help_text = "District Google Code")
    
    class Meta:
        verbose_name_plural = "District/Region"
    def __str__(self):
        return self.Name

class citymunicipality(models.Model):
    """
    Represents a city or municipality within a district or region covered by the service.
    
    Attributes:
        Name: The official name of the city or municipality.
        districtregion: A ForeignKey that links to the parent district or region.
        GPS_latitude: The central latitude coordinate of the city or municipality.
        GPS_longitude: The central longitude coordinate of the city or municipality.
        ZoomLevel: A value indicating the default zoom level on maps for this locality.
        GoogleCode: A two-letter code representing the city for use with Google services.
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "Service Municipality")
    districtregion =  models.ForeignKey(districtregion, on_delete=models.CASCADE, null=False, blank=False, help_text = "Municipality District", related_name='municipality_district') 
    GPS_latitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "Municipality central GPS latitude") 
    GPS_longitude = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "Municipality central GPS latitude") 
    ZoomLevel = models.IntegerField(default=15, help_text = "Municipality Zoom Level") 
    GoogleCode = models.CharField(default='', max_length=2, blank=True, help_text = "Municipality Google Code")
    
    class Meta:
        verbose_name_plural = "City/Municipality"
    def __str__(self):
        return self.Name

class usertype(models.Model):
    """
    Represents a category or type of user within the platform, used to define roles and permissions.
    
    Attributes:
        UserTypeName: A label describing the type of user, defining their role within the service.
    """
    UserTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "User Type")
     
    class Meta:
        verbose_name_plural = "User Type"
    def __str__(self):
        return self.UserTypeName

class userprofile(models.Model):
    """
    Extends the base User model with additional attributes specific to the Suroga service.
    
    Attributes:
        user: A ForeignKey link to the associated User instance.
        PlantformUserType: ForeignKey to the usertype, indicating the role of the user on the platform.
        email_confirmed: Boolean indicating if the user's email address has been confirmed.
        Tele_confirmed: Boolean indicating if the user's telephone number has been confirmed.
        is_blocked: Boolean indicating if the user has been blocked from the service.
        Language1: ForeignKey to a Language, representing the user's primary language.
        Language2: ForeignKey to another Language for bilingual users, representing their second language.
        Paymentupdated: Boolean indicating if payment info, such as details with Stripe, is up-to-date.
    """

    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=True, related_name='profile_user')    
    
    #Users registered on the service
    PlantformUserType = models.ForeignKey(usertype, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "User type", related_name='user_type') 
    
    email_confirmed = models.BooleanField(default=False, help_text = "True if email was confirmed.")
    Tele_confirmed = models.BooleanField(default=False, help_text = "True if telephone was confirmed.")
    
    # User is blocked
    is_blocked = models.BooleanField(default=True, help_text = "True if user was is_blocked.")

    # User default language
    Language1 = models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "Frist Language", related_name='user_language1') 
    Language2 = models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "Second Language", related_name='user_language2') 
        
    # Stripe info updated
    Paymentupdated = models.BooleanField(default=True, help_text = "True if user info was updated on Stripe.")

    # User hash
    def __str__(self):
        return str(self.user)

class userloginlog(models.Model):
    """
    Represents a log entry for a user login attempt.
    
    Attributes:
        user: A reference to the User who attempted the login.
        IP: The IP address from which the login attempt was made.
        user_agent: Detailed string representing the browser or client software used.
        local: The locale from which the login attempt was made (if available).
        region: The region from which the login attempt was made.
        country: The country from which the login attempt was made.
        lon: The longitude of the geolocation of the IP address.
        lat: The latitude of the geolocation of the IP address.
        geo_located: A boolean indicating whether the geolocation was successful.
        RegistrationDate: The date and time when the login attempt occurred.
    """
    user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "payment_user") 
    IP = models.CharField(max_length=15, help_text = "IP")
    user_agent = models.TextField(default='', help_text = "User agent")
    local = models.CharField(max_length=50, default='', help_text = "Local")
    region = models.CharField(max_length=50, default='',)
    country = models.CharField(max_length=100,help_text = "Country")
    lon = models.FloatField(default=0.0)
    lat = models.FloatField(default=0.0)
    geo_located = models.BooleanField(default=False, help_text = "True if IP is geolocated.")
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=True, help_text = "Access Date.")
 
    class Meta:
        verbose_name_plural = "User login log"
    def __str__(self):
        return self.user.username + " (" + self.IP + ") at " + str(self.RegistrationDate)


class events(models.Model):
    """
    Represents an API request event.
    
    Attributes:
        user: A reference to the User associated with the event.
        Type: The type of the event (e.g., CRUD operation).
        Registration: The date and time when the event occurred.
        Request_Id: A unique identifier for the request.
        Request: The actual data of the request.
    """

    # User profile
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, default=None, blank=True, related_name='event_user')    
    Type = models.CharField(max_length=10,  blank=False, help_text = "Event Type")
    Registration = models.DateTimeField(default=timezone.now)
    Request_Id = models.CharField(max_length=20, blank=True, editable=True, help_text = "Request ID")
    Request = models.TextField(max_length=1000, blank=True, help_text = "The request")

      
    class Meta:
        verbose_name_plural = "API request"
    def __str__(self):
        return str(self.Registration)


class RideDuration(models.Model):
    """
    Represents a predefined list of ride durations.
    
    Attributes:
        Duration: The time duration for the ride.
        Token: An authentication token or identifier associated with the ride duration.
    """
    Duration = models.DurationField(null=False,
                                    blank=False,
                                    default='00:30:00',
                                    verbose_name=('timeslot_duration'),
                                    help_text=('HH:[MM]format')
                                    )
    Token = models.CharField(default='',max_length=30,  help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Ride Duration"
    def __str__(self):
        return str(self.Duration)

class equipment(models.Model):
    """
    Represents an item of equipment available for use during rides or events.
    
    Attributes:
        Name: Name of the piece of equipment.
        Token: An authentication token or identifier associated with the equipment.
    """
    Name = models.CharField(max_length=30, unique=True, blank=False, help_text = "Public events type")
    Token = models.CharField(default='',max_length=30, help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Equipments"
    def __str__(self):
        return self.Name

class publicevent(models.Model):
    """
    Represents a type of public event.
    
    Attributes:
        Name: Name of the public event type.
        Token: An authentication token or identifier associated with the public event.
    """
    Name = models.CharField(max_length=30, unique=True, blank=False, help_text = "Public events type")
    Token = models.CharField(default='',max_length=30,  help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Public events"
    def __str__(self):
        return self.Name

class sound(models.Model):
    """
    Represents a category of sound requirements for rides or events.
    
    Attributes:
        Name: Name of the sound requirement category.
        Token: An authentication token or identifier associated with the sound requirement.
    """
    Name = models.CharField(max_length=30, unique=True, blank=False, help_text = "Sound type")
    Token = models.CharField(default='',max_length=30, help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Sound requirements"
    def __str__(self):
        return self.Name

class image(models.Model):
    """
    Represents a category of image requirements for rides or events.
    
    Attributes:
        Name: Name of the image requirement category.
        Token: An authentication token or identifier associated with the image requirement.
    """
    Name = models.CharField(max_length=30, unique=True, blank=False, help_text = "Image type")
    Token = models.CharField(default='',max_length=30, help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Image requirements"
    def __str__(self):
        return self.Name

class localwifi(models.Model):
    """
    Represents different types of Wi-Fi services or configurations provided at local venues or by the service.
    
    Attributes:
        Name: The name or type of the Wi-Fi service/configuration.
        Token: An identifier or access token associated with the Wi-Fi service.
    """
    Name = models.CharField(max_length=30, unique=True, blank=False, help_text = "Local wifi type")
    Token = models.CharField(default='',max_length=30,  help_text = "Token")
    
    class Meta:
        verbose_name_plural = "Local Wi-Fi"
    def __str__(self):
        return self.Name

class version(models.Model):
    """
    Tracks versions of the configuration data for different API endpoints to manage updates and changes.
    
    Attributes:
        endpoint: The name of the API endpoint.
        version: The current version number of the endpoint's configuration data.
        RegistrationDate: The date and time when the version was updated or registered.
    """
    
    endpoint = models.CharField(max_length=50, blank=False, help_text = "Endpoint name")
    version = models.IntegerField(default=0, help_text = "Version")
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of version change")
 
    class Meta:
        verbose_name_plural = "Endpoint Version"
    def __str__(self):
        return self.endpoint


class commchannel(models.Model):
    """
    Defines communication channels such as email addresses for CRM and support, related to API services in different countries.
    
    Attributes:
        Country: A reference to a 'country' model instance indicating which country the communication channel is for.
        mail_crm: The email address for CRM-related communications.
        mail_api: The email address for API support.
        mail_ride: The email address for ride support.
        RegistrationDate: The date and time when the communication channel was updated or registered.
    """
    Country = models.OneToOneField(country, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Country") 
    
    mail_crm = models.CharField(max_length=50, blank=False, help_text = "Email address for CRM communications")
    mail_api = models.CharField(max_length=50, blank=False, help_text = "Email address for API support")
    mail_ride = models.CharField(max_length=50, blank=False, help_text = "Email address for service/ride support")
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of registration or change")
 
    class Meta:
        verbose_name_plural = "Communication Channels"
    def __str__(self):
        return self.Country.Name if self.Country else 'Unknown country'

def get_client_ip(request):
    """
    Utility function to extract the client's IP address from the request.
    
    The 'X-Forwarded-For' header is checked first to account for proxy servers. If not found, 
    'REMOTE_ADDR' is used to get the IP address.
    """
    x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
    if x_forwarded_for:
        ip = x_forwarded_for.split(',')[0]
    else:
        ip = request.META.get('REMOTE_ADDR')

    return ip

def get_location_data__from_ip(ip):
    """
    Retrieves geolocation information for the provided IP address using an external API service.
    
    A private IP address will use a placeholder IP to fetch location data as local IP addresses do not have an associated location.
    """
    # if ip is local (so it's impossible to find lat/long coords and location) project will use random google ip as placeholder]
    if ipaddress.ip_address(ip).is_private:
        if hasattr(conf_settings, 'IP_PLACEHOLDER'):
            ip = conf_settings.IP_PLACEHOLDER
        else:
            ip = "216.58.201.110"
    else:
        pass

    #url = "http://ip-api.com/json/"+ip

    #locationInfo = requests.get(url).json()
    locationInfo =''
    return locationInfo

@receiver(user_logged_in)
def post_login(sender, user, request, **kwargs):
    """
    Signal receiver for the user_logged_in signal to log user's login attempt details.
    
    It captures user's IP, user agent, and location data, creating a userloginlog instance with these details.
    """
    ip = get_client_ip(request)
    locationInfo = get_location_data__from_ip(ip)

    if locationInfo:
        login = userloginlog.objects.create(
            user=user,
            IP=ip,
            user_agent=request.META['HTTP_USER_AGENT'],
            country=locationInfo["country"],
            region=locationInfo["region"],
            local=locationInfo["city"],
            lon=locationInfo["lon"],
            lat=locationInfo["lat"],
            geo_located = True
        )
    else:
        login = userloginlog.objects.create(
            user=user,
            IP=ip,
            user_agent=request.META['HTTP_USER_AGENT'],
            country='',
            region='',
            local='',
            lon=0.0,
            lat=0.0,
            geo_located = True
        )


# --- App: core - File: __init__.py ---



# --- App: core - File: views.py ---


from datetime import datetime, timedelta

from django.shortcuts import render

from rest_framework import routers, serializers, viewsets, generics

from rest_framework.response import Response
from rest_framework.permissions import BasePermission, IsAuthenticated, SAFE_METHODS

from rest_framework.decorators import api_view
from rest_framework.views import APIView
from rest_framework.authentication import SessionAuthentication, BasicAuthentication, TokenAuthentication

from django.utils.translation import activate, gettext

from django.shortcuts import render, redirect
from django.contrib.sites.shortcuts import get_current_site
from django.contrib.auth import get_user_model, login
from django.views.generic import CreateView
from django.contrib.auth.decorators import login_required
from django.http import HttpResponse
from django.template.loader import render_to_string

from django.contrib.auth import get_user_model
User = get_user_model()

from core.models import events, time_zone, RideDuration
from core.models import  Language, Currency, country
from core.models import  districtregion, citymunicipality  
from core.models import equipment, publicevent, sound, image, localwifi 
from core.serializers import time_zoneSerializer, RideDurationSerializer
from core.serializers import CountrySerializer, LanguageSerializer, CurrencySerializer
from core.serializers import districtregionSerializer, citymunicipalitySerializer  
from core.serializers import equipmentSerializer,publiceventSerializer, soundSerializer, imageSerializer, localwifiSerializer   
from core.serializers import eventsSerializer

from core.models import usertype,userprofile
from partner.models import profilepartner

from drf_api_logger.models import APILogsModel

"""
Core Application Views - Suroga API

This file contains the view logic for the Core application of the Suroga API project. The views are responsible for processing incoming requests and returning appropriate responses. They handle the API endpoints related to essential services and data models, such as equipment, public events, sound requirements, image standards, and Wi-Fi conditions, as well as user events and logs for administrative purposes.

The views in this file utilize Django Rest Framework's ViewSets to provide a convenient interface for representing data models over a RESTful API. The ViewSets are configured with specific permissions to ensure that only authorized users can access or modify the resources as intended by the business logic.

The ViewSets are also configured with appropriate serializers to represent data models as JSON, making it accessible for client applications and ensuring a consistent structure across the API.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024

Please refer to Django and Django Rest Framework documentation for additional details:
- Django Views: https://docs.djangoproject.com/en/4.0/topics/http/views/
- Django Rest Framework ViewSets: https://www.django-rest-framework.org/api-guide/viewsets/
"""

# The index view is the default view for the Suroga API project. It serves the homepage
# and handles redirection based on the user's authentication status and roles.
def index(request, *args, **kwargs):

    # Determine if the current user is anonymous (not logged in).
    is_anonymous = request.user.is_anonymous

    # Initialize a flag for client status. We are assuming this might relate to user types,
    # with is_client indicating a non-admin, authenticated user.
    is_client = False

    # Try to retrieve the language code from the user's session. Fallback to 'en' if not found.
    try:
        code = request.session['code']
    except KeyError:
        code = "en"

    # Activate the selected language for this session or request based on 'code'.
    activate(code)

    # Prepare the context data for the template. Convert 'is_anonymous' to int for template use.
    data = {'is_anonymous': int(is_anonymous),'is_client': 0}

    # If the user is authenticated, further determine their status and redirect accordingly.
    if not is_anonymous:

        is_superuser = request.user.is_superuser
        if is_superuser: # If user is an admin, redirect to the admin dashboard.
            return redirect('/admin/')
        else: # If user is not an admin, treat as a client and redirect to the partner app.
            data['is_client'] = 1
            return redirect('/partner/')

    # If the user is anonymous, render the 'index.html' template with the provided data.
    return render(request, 'index.html', data)


# Custom permission class that implements read-only access.
# It allows unauthenticated users to view the data but not modify it.
class ReadOnly(BasePermission):
    def has_permission(self, request, view):
        # Only allow methods that are deemed "safe" (i.e., read-only) like GET, OPTIONS, and HEAD.
        return request.method in SAFE_METHODS

# time_zoneViewSet defines the view behavior for time zones within the API.
# It extends the ModelViewSet, offering an interface for listing and retrieving time zone instances.
class time_zoneViewSet(viewsets.ModelViewSet):
    """
    API endpoint that allows time zones to be viewed.
    * Requires token authentication.
    * Only authenticated users are given access, with read-only permissions.
    """
    # Define the authentication and permission classes required to access this view.
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]

    # Define the queryset that the view will use to retrieve Time Zone objects.
    queryset = time_zone.objects.all()

    # Specify the serializer that should be used to format the Time Zone objects for return to the client.
    serializer_class = time_zoneSerializer

# Similarly, RideDurationViewSet defines the view behavior for ride durations.
class RideDurationViewSet(viewsets.ModelViewSet):
    """
    API endpoint that allows ride durations to be viewed.
    * Requires token authentication.
    * Only authenticated users are given access, with read-only permissions.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = RideDuration.objects.all()
    serializer_class = RideDurationSerializer

# LanguageViewSet extends Django REST Framework's ModelViewSet to provide a full set of views (list, create, retrieve, update, delete)
# for Language objects. The API endpoint will allow clients to view the available languages offered for rides.
class LanguageViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available languages.

    The `TokenAuthentication` ensures that each request has a valid token, providing user authentication.
    The `ReadOnly` permission allows only read operations (GET requests) for any authenticated user, ensuring
    no changes can be made through this viewset.

    'queryset' collects all instances of the Language model, and the 'serializer_class' formats these instances 
    as JSON responses conforming to the LanguageSerializer fields.
    """ 
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = Language.objects.all()
    serializer_class = LanguageSerializer

# CurrencyViewSet provides a full set of views for Currency objects, similar to LanguageViewSet,
# allowing clients to view the different types of currency available for transactions within the service.
class CurrencyViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available currencies.

    This will include the PK, Name of the currency, Currency code, Symbol, and whether the
    Symbol is positioned to the right of currency values.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = Currency.objects.all()
    serializer_class = CurrencySerializer

# CountryViewSet allows clients to view the service's available countries, providing details
# such as the country's name, currency, language, phone code, time zone, VAT details, GPS coordinates, 
# the zoom level used on maps, and a Google Maps-compatible code.
class CountryViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available countries.

    The retrieved fields include a primary key (pk), Name, Currency, Language, PhoneCode, TimeZone,
    Value-Added Tax (VAT), GPS coordinates, and a ZoomLevel that might be used for map displays along with a Google-specific code.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = country.objects.all()
    serializer_class = CountrySerializer
 

# districtregionViewSet provides views for district or region objects that the service covers,
# It helps users to view various geographic and administrative regions within countries.
class districtregionViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available districts or regions.

    The focus is on geographical regions that are covered by the service, with the response including
    details such as GPS coordinates, zoom levels for maps, and a code compatible with Google's geo APIs.
    
    Retrieve: ['pk','Name','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = districtregion.objects.all()
    serializer_class = districtregionSerializer

# citymunicipalityViewSet extends the ModelViewSet for city and municipality objects.
# It offers detailed views of these localities, which are subdivisions of the district/regions.
class citymunicipalityViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available cities and municipalities.

    This ViewSet is scoped to more granular geographical data that includes names, associated
    district or region data (foreign key), plus GPS coordinates, zoom level, and a Google code.
    
    Retrieve: ['pk','Name','districtregion','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = citymunicipality.objects.all()
    serializer_class = citymunicipalitySerializer

# equipmentViewSet provides a full set of views for equipment objects. It allows clients to retrieve
# information about the available equipment which might be necessary for the rides or associated services.
class equipmentViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing available equipment.

    The view restricts changes by only providing read-only access to authenticated users, as indicated by
    the `ReadOnly` permission. The queryset contains all equipment objects, formatable by equipmentSerializer.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = equipment.objects.all()
    serializer_class = equipmentSerializer

# publiceventViewSet extends ModelViewSet to provide views for public event objects,
# which might include events where rides are commonly required or provided.

class publiceventViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing a list of public event conditions.

    The data returned may include information such as district/region, GPS coordinates, and Google location codes,
    which can be useful for mapping services or event location identification.
    
    Retrieve: ['pk','Name','districtregion','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = publicevent.objects.all()
    serializer_class = publiceventSerializer

# soundViewSet allows clients to view possible sound requirements for rides or events,
# which can be essential when planning for events or services that involve audio setup.

class soundViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing a list of sound requirements.

    The endpoint might be used to present different categories or types of sound equipment or services provided.
    

    Retrieve: ['pk','Name']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = sound.objects.all()
    serializer_class = soundSerializer

# imageViewSet provides views for image requirements, which might be used to specify
# particular photography or image standards for rides or events.

class imageViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing a list of image requirements.

    Useful for detailing the image standards or photography guidelines for services offered by Suroga API.
    

    Retrieve: ['pk','Name']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = image.objects.all()
    serializer_class = imageSerializer

# localwifiViewSet allows clients to view the possible conditions or standards for local wifi services,
# which might be relevant in rides or venues where internet connectivity is a consideration.

class localwifiViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing a list of local wifi conditions.

    Details returned may include technical specifications for wifi services provided or available.
    
    Retrieve: ['pk','Name']

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated,ReadOnly]
    queryset = localwifi.objects.all()
    serializer_class = localwifiSerializer

# eventsViewSet provides models and tools to view a log of user events.
# It appears to offer logged data related to API usage and user interactions.

class eventsViewSet(viewsets.ModelViewSet):
    """
    API endpoint for viewing user events, which could entail user actions, API call logs, system events, etc.

    The queryset is filtered by the requesting user, ensuring that users can only access their own event logs.
    The commented section suggests filtering of event logs by date range, which is currently not active.
    

    Retrieve: ['pk','Type','Registration','Request']

    """
    
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = APILogsModel.objects.all()
    serializer_class = eventsSerializer


    def get_queryset(self):
        # Overrides the standard queryset to return only those API logs that belong to the currently authenticated user.      
        queryset = APILogsModel.objects.filter(user=self.request.user)
        '''
        end   = datetime.today()
        start = end - timedelta(days=8)
    
        startdate = start.strftime("%Y-%m-%d")

        startstr = self.request.query_params.get('Start')
        endstr = self.request.query_params.get('End')

        if startstr is not None:
            None
        elif endstr is not None:
            None
        else:
            queryset = queryset.filter(added_on__gte=start)
        '''
        return queryset


# --- App: core - File: admin.py ---

from django.contrib import admin

# Register your models here.
from core.models import time_zone, Language, Currency, country
from core.models import districtregion, citymunicipality, usertype, userprofile
from core.models import equipment, userloginlog, events, RideDuration
from core.models import version, commchannel, publicevent, sound, image, localwifi

"""
Core Application Administration - Suroga API

This file configures the admin interface for the Core application of the Suroga API project. Each model within the
application has an associated admin class that defines how it should be displayed and manipulated within the Django
admin site. Customizations include defining the list of fields displayed in the admin list view, any fieldsets for
detail views, filters, search capabilities, and more.

The use of list_display is prevalent to ensure essential fields are immediately visible when admins list records
of each model. For models that are involved in user interaction logging, such as userloginlog, or manage static
reference data, such as time_zone or Language, the admin classes provide a clear, useful snapshot of each record
at a glance.

By registering these admin classes with the admin site, we enable site administrators to manage the data with ease,
utilizing the Django admin interface's powerful tools for querying and modifying data as needed.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024

Refer to Django's admin documentation for additional details on admin site customization:
https://docs.djangoproject.com/en/4.0/ref/contrib/admin/
"""

# Registers the `time_zone` model with Django's admin interface using a custom admin class.
# This allows for customization of how the time zones are displayed in the admin panel.
class time_zoneAdmin(admin.ModelAdmin):
    # Defines what information is displayed for each time zone entry in the list view of the admin.
    
	list_display = (
    'pk',
    'Name',
    'TimeZone',
    'UTCoffset',
    )
# Connects the model with the custom admin class so that it's used when displaying time zones in the admin.
admin.site.register(time_zone,time_zoneAdmin)

# Registration process is similar for the `Language` model.
# The LanguageAdmin class configures admin list view for `Language` objects.
class LanguageAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Code',
    )
admin.site.register(Language,LanguageAdmin)


# CurrencyAdmin customizes the admin panel for `Currency` models,
# ensuring that currency names, their symbols, and positioning preferences are visible in the list view.
class CurrencyAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Currency',
    'CurrencySymbol',
    'SymbolRight',
    )
admin.site.register(Currency,CurrencyAdmin)


# CountryAdmin enables the admin to manage `country` instances within the admin interface effectively,
# displaying a broad set of fields for comprehensive administrative visibility.
class CountryAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Currency',
    'Language',
    'PhoneCode',
    'time_zone',
    'VAT',
    'GPS_latitude',
    'GPS_longitude',
    'ZoomLevel',
    'GoogleCode'
    )
admin.site.register(country,CountryAdmin)


# citymunicipalityAdmin is similar to above admin classes,
# focusing on the city and municipality details, including GPS information and other identifiers.
class citymunicipalityAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'districtregion',
    'GPS_latitude',
    'GPS_longitude',
    'ZoomLevel',
    'GoogleCode',
    )
admin.site.register(citymunicipality,citymunicipalityAdmin)

# usertypeAdmin configures the admin interface for User Type models, showing primary key and type name.
class usertypeAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'UserTypeName',
    )
admin.site.register(usertype,usertypeAdmin)


# userprofileAdmin presents relevant profile fields in the admin interface for UserProfile models.
class userprofileAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'user',
    'PlantformUserType',
    'email_confirmed',
    'Tele_confirmed',
    'is_blocked',
    'Language1',
    'Language1',
    'Paymentupdated',
    )
admin.site.register(userprofile,userprofileAdmin)


# userloginlogAdmin displays login log details in the admin panel, aiding in user activity tracking and debugging.
class userloginlogAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'user',
    'IP',
    'local',
    'region',
    'country',
    'lon',
    'lat',
    'geo_located',
    'RegistrationDate',
    )
admin.site.register(userloginlog,userloginlogAdmin)


# RideDurationAdmin organizes how Ride Duration models are represented in the admin list views.
class RideDurationAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Duration',
    'Token',
    )
admin.site.register(RideDuration,RideDurationAdmin)

# equipmentAdmin allows for management of equipment models, showcasing name and token.
class equipmentAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Token',
    )
admin.site.register(equipment,equipmentAdmin)


# publiceventAdmin makes public event models manageable within the admin interface, presenting keys and names.
class publiceventAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Token',
    )
admin.site.register(publicevent,publiceventAdmin)

# soundAdmin sets up the admin display for sound requirement models, providing quick reference with token information.
class soundAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Token',
    )
admin.site.register(sound,soundAdmin)


# imageAdmin designed to streamline how image requirement models appear in admin with primary key and names.
class imageAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Token',
    )
admin.site.register(image,imageAdmin)

# localwifiAdmin enables admin users to view and manage local Wi-Fi model data efficiently.
class localwifiAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Name',
    'Token',
    )
admin.site.register(localwifi,localwifiAdmin)

# eventsAdmin provides access to event models logging API requests, with request ID and type fields available.
class eventsAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'Request_Id',
    'Type',
    'Registration',
    )
admin.site.register(events,eventsAdmin)

# commchannelAdmin sets how communication channel models are navigated and managed within the admin interface, 
# especially for contact-related fields like emails.
class commchannelAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'mail_crm',
    'mail_api',
    'mail_ride',
    )
admin.site.register(commchannel,commchannelAdmin)

# versionAdmin organizes the admin representation for the versioning data of endpoint models, 
# displaying the endpoint name and related version numbers.
class versionAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'endpoint',
    'version',
    'RegistrationDate',
    )
admin.site.register(version,versionAdmin)

# --- App: core - File: serializers.py ---


from rest_framework import routers, serializers, viewsets
#from core.models import time_zone, rating, RideDuration, ServiceType, PathType
#from core.models import PathType, Technology, Local, Language, Currency, Country
from core.models import events, time_zone, RideDuration
from core.models import  Language, Currency, country
from core.models import  districtregion, citymunicipality  
from core.models import equipment, publicevent, sound, image, localwifi 
from drf_api_logger.models import APILogsModel

"""
Core Application Serializers - Suroga API

This file contains serializers that convert complex data types, such as querysets and model instances, to native Python 
data types. The serialized data can then be easily rendered into JSON (or other content types) for API responses, or 
used for parsing incoming data in API requests. 

The serializers defined here correspond closely with the models defined in the core app's `models.py`. They ensure that 
the data representation for API communication conforms to a consistent structure and format. They also handle validation 
for incoming data used to create or update model instances.

Serializers included:
- soundSerializer: Handles sound requirements data.
- imageSerializer: Manages image requirements.
- localwifiSerializer: Processes local Wi-Fi configurations.
- eventsSerializer: Logs API interaction events.

These serializers extend Django REST Framework's ModelSerializer class and automatically generate a set of fields and 
validators based on the corresponding models. The Serializers are primarily configured to be read-only as many of the 
endpoints serve static or reference data not intended for frequent modification through the API.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014

Refer to Django REST Framework's serializer documentation for more information:
https://www.django-rest-framework.org/api-guide/serializers/
"""

# time_zoneSerializer converts time_zone instances to and from JSON.
class time_zoneSerializer(serializers.ModelSerializer):
    class Meta:
        model = time_zone
        fields = ['pk','Name', 'TimeZone', 'UTCoffset']
        read_only_fields = fields # Prevents modification of the serialized fields.


# LanguageSerializer is responsible for the serialization process of the Language model,
# allowing for representation as JSON, used for API responses or submissions.
class LanguageSerializer(serializers.ModelSerializer):
    class Meta:
        model = Language
        fields = ['pk','Name','Code']
        read_only_fields = fields

# RideDurationSerializer serializes instances of the RideDuration model, enabling them to 
# be outputted as JSON, often necessary for interaction with frontend applications.
class RideDurationSerializer(serializers.ModelSerializer):
    class Meta:
        model = RideDuration
        fields = ['pk','Duration']
        read_only_fields = fields

# citymunicipalitySerializer is responsible for handling the serialization of city/municipality data.
# It includes extra fields such as GPS coordinates and a related district/region.
class citymunicipalitySerializer(serializers.ModelSerializer):  
    
    class Meta:
            model = citymunicipality
            fields = ['pk','Name','districtregion','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode']
            read_only_fields = fields

# districtregionSerializer embeds the citymunicipalitySerializer to include related city/municipality
# data nested within the representation of each district/region.
class districtregionSerializer(serializers.ModelSerializer):
    
    municipality_district = citymunicipalitySerializer(many=True, read_only=True)
    
    
    class Meta:
            model = districtregion
            fields = ['pk','Name','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode','municipality_district']
            read_only_fields = fields

# CurrencySerializer handles serialization of currency instances which may include name, code, symbol, 
# and a boolean indicating the conventional position of the currency symbol.
class CurrencySerializer(serializers.ModelSerializer):
    
    
    class Meta:
        model = Currency
        fields = ['pk','Name','Currency','CurrencySymbol','SymbolRight']
        read_only_fields = fields

# CountrySerializer serializes country instances, including nested details provided by currency,
# language, and time zone serializers.
class CountrySerializer(serializers.ModelSerializer):
    
    Currency = CurrencySerializer(read_only=True)
    Language = LanguageSerializer(read_only=True)
    time_zone = time_zoneSerializer(read_only=True)

    class Meta:
        model = country
        fields = ['pk','Name','Currency','Language','PhoneCode','time_zone','VAT','GPS_latitude','GPS_longitude','ZoomLevel','GoogleCode']

# equipmentSerializer provides serialization for equipment items, including the name and a unique identifier.
class equipmentSerializer(serializers.ModelSerializer):  
    class Meta:
            model = equipment
            fields = ['pk','Name']
            read_only_fields = fields

# publiceventSerializer manages serialization of public event types, essential for endpoints which manage event-based data.
class publiceventSerializer(serializers.ModelSerializer):  
    class Meta:
            model = publicevent
            fields = ['pk','Name']
            read_only_fields = fields

# soundSerializer converts instances of the sound model to and from JSON format.
class soundSerializer(serializers.ModelSerializer):  
    class Meta:
            # Specifies the model associated with this serializer.
            model = sound
            # Defines the list of fields that should be included in the serialized output.
            fields = ['pk','Name']
            # Declares all fields as read-only, preventing modification through API requests.
            read_only_fields = fields

# imageSerializer handles serialization for image requirement objects,
# allowing them to be easily converted to JSON for API responses.
class imageSerializer(serializers.ModelSerializer):  
    class Meta:
            # Associates the serializer with the image model.
            model = image
            # Selects which fields from the image model should be included in the serialized data.
            fields = ['pk','Name']
            # Marks these fields as not writable, ensuring they can only be read through the API.
            read_only_fields = fields

# localwifiSerializer is responsible for the serialization of local Wi-Fi configuration data.
class localwifiSerializer(serializers.ModelSerializer):  
    class Meta:
            # Points to localwifi as the source model for the serializer.
            model = localwifi
            # Lists the fields to be included in the serialization process.
            fields = ['pk','Name']
            # Sets the field permissions to read-only to prevent changes via the API.
            read_only_fields = fields

# eventsSerializer is designed for creating representations of API log entries.
class eventsSerializer(serializers.ModelSerializer):  
    class Meta:
            # Sets APILogsModel as the model that backs this serializer.
            model = APILogsModel
            # Specifies the fields from APILogsModel that should appear in the serialized form.
            fields = ['pk','user','added_on','method','api','client_ip_address','status_code','execution_time','response']
            # Sets all these fields as immutable in the context of an API operation.
            read_only_fields = fields



# --- App: core - File: apps.py ---

from django.apps import AppConfig

"""
Core Application Configuration - Suroga API

This module contains the application configuration for the 'core' app within the Suroga API Django project. It is used by 
Django's application registry to configure app-specific settings such as the name of the app and the default auto field 
type for the database models.

In larger projects with multiple apps, each app would have a similar configuration class, typically found in its 
'apps.py' module, to hold its unique settings and metadata. This configuration is critical for Django to properly 
handle different applications and make features such as models and signals available to the rest of the project.

The CoreConfig class extends Django's AppConfig and customizes the behavior of the 'core' app. By setting attributes 
like 'default_auto_field' we ensure that any auto-created primary key fields use a big integer field, which is 
necessary for databases that will store a large number of records.

Maintainer: Carlos Leandro
Last updated: 15/3/2024

Refer to Django's documentation for more details on application configurations:
https://docs.djangoproject.com/en/4.0/ref/applications/
"""

# The CoreConfig class is used by Django's app configuration system to hold
# metadata for the 'core' application. It defines common application properties
# and acts as a container for app-specific configurations.

class CoreConfig(AppConfig):
    # Specifies the default field type for auto-generated primary key fields.
    # The 'BigAutoField' is a 64-bit integer, generally useful if you anticipate
    # that your data will exceed the maximum auto-increment value of standard AutoFields.
    default_auto_field = 'django.db.models.BigAutoField'

    # The 'name' attribute defines the full Python path to the application.
    # Django uses this attribute to identify the app and its configuration.
    name = 'core'


# --- App: core - File: forms.py ---



# --- App: core.migrations - File: 0008_alter_events_request.py ---

# Generated by Django 4.0.1 on 2022-12-16 16:32

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0007_delete_paymentlog'),
    ]

    operations = [
        migrations.AlterField(
            model_name='events',
            name='Request',
            field=models.TextField(blank=True, help_text='The request', max_length=1000),
        ),
    ]


# --- App: core.migrations - File: 0019_equipment_token_image_token_localwifi_token_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-18 02:37

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0018_equipment'),
    ]

    operations = [
        migrations.AddField(
            model_name='equipment',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
        migrations.AddField(
            model_name='image',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
        migrations.AddField(
            model_name='localwifi',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
        migrations.AddField(
            model_name='publicevent',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
        migrations.AddField(
            model_name='sound',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
    ]


# --- App: core.migrations - File: 0015_alter_regionstate_country.py ---

# Generated by Django 4.0.1 on 2023-01-11 21:17

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0014_version_commchannel_registrationdate'),
    ]

    operations = [
        migrations.AlterField(
            model_name='regionstate',
            name='Country',
            field=models.ForeignKey(help_text='Region country', on_delete=django.db.models.deletion.CASCADE, related_name='state_country', to='core.country'),
        ),
    ]


# --- App: core.migrations - File: 0014_version_commchannel_registrationdate.py ---

# Generated by Django 4.0.1 on 2022-12-26 12:39

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0013_alter_commchannel_options'),
    ]

    operations = [
        migrations.CreateModel(
            name='version',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('endpoint', models.CharField(help_text='Endpoint name', max_length=50)),
                ('version', models.IntegerField(default=0, help_text='Version')),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Change Date.')),
            ],
            options={
                'verbose_name_plural': 'Endpoint Version',
            },
        ),
        migrations.AddField(
            model_name='commchannel',
            name='RegistrationDate',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Access Date.'),
        ),
    ]


# --- App: core.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:05

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='country',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Country Nome', max_length=100, unique=True)),
                ('PhoneCode', models.CharField(help_text='Country Phone Code', max_length=5, unique=True)),
                ('VAT', models.DecimalField(decimal_places=2, default=23.0, help_text='Country VAT', max_digits=5)),
                ('GPS_latitude', models.DecimalField(decimal_places=8, default=0, help_text='Country central GPS latitude', max_digits=12)),
                ('GPS_longitude', models.DecimalField(decimal_places=8, default=0, help_text='Country central GPS latitude', max_digits=12)),
                ('ZoomLevel', models.IntegerField(default=15, help_text='Country Zoom Level')),
                ('GoogleCode', models.CharField(blank=True, default='', help_text='Country Google Code', max_length=2)),
            ],
            options={
                'verbose_name_plural': 'Countries',
            },
        ),
        migrations.CreateModel(
            name='Currency',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(max_length=100, unique=True)),
                ('Currency', models.CharField(default='EURO', help_text='Country currency.', max_length=30)),
                ('CurrencySymbol', models.CharField(default='€', help_text='Country currency Sym.', max_length=5)),
                ('SymbolRight', models.BooleanField(default=False, help_text='True if country is open to registration.')),
            ],
            options={
                'verbose_name_plural': 'Currencies',
            },
        ),
        migrations.CreateModel(
            name='image',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Image type', max_length=30, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Image requirements',
            },
        ),
        migrations.CreateModel(
            name='Language',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(max_length=100, unique=True)),
                ('Code', models.CharField(blank=True, default='', max_length=5)),
            ],
            options={
                'verbose_name_plural': 'Languages',
            },
        ),
        migrations.CreateModel(
            name='localwifi',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Local wifi type', max_length=30, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Local wifi',
            },
        ),
        migrations.CreateModel(
            name='paymentlog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('PlantformUserType', models.CharField(help_text='User type', max_length=10, unique=True)),
                ('PlantformUser', models.CharField(help_text='User hash', max_length=15, unique=True)),
                ('OperationType', models.CharField(help_text='Operation type', max_length=10, unique=True)),
                ('SettlementDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Transation settlement date')),
                ('PaymMethodResul', models.CharField(help_text='Payment result', max_length=100, unique=True)),
                ('StripTransactionID', models.CharField(help_text='Strip Transation ID', max_length=20, unique=True)),
                ('SurooBankTransactionID', models.CharField(help_text='Bank Transation ID', max_length=20, unique=True)),
                ('Ride', models.CharField(help_text='Ride hash', max_length=15, unique=True)),
                ('Booking', models.CharField(help_text='Booking hash', max_length=15, unique=True)),
                ('Value', models.DecimalField(decimal_places=8, default=0, help_text='Value', max_digits=12)),
                ('is_debit', models.BooleanField(default=False, help_text='True if it is a debit.')),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.')),
            ],
            options={
                'verbose_name_plural': 'Payment log',
            },
        ),
        migrations.CreateModel(
            name='publicevent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Public events type', max_length=30, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Public events',
            },
        ),
        migrations.CreateModel(
            name='RideDuration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Duration', models.DurationField(default='00:30:00', help_text='HH:[MM]format', verbose_name='timeslot_duration')),
            ],
            options={
                'verbose_name_plural': 'Ride Duration',
            },
        ),
        migrations.CreateModel(
            name='sound',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Sound type', max_length=30, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Sound requirements',
            },
        ),
        migrations.CreateModel(
            name='time_zone',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Name', max_length=100)),
                ('TimeZone', models.CharField(help_text='TimeZone', max_length=100)),
                ('UTCoffset', models.DecimalField(decimal_places=0, default=0, help_text='UTC offset', max_digits=2)),
            ],
            options={
                'verbose_name_plural': 'Time zones',
            },
        ),
        migrations.CreateModel(
            name='usertype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('UserTypeName', models.CharField(help_text='User Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'User Type',
            },
        ),
        migrations.CreateModel(
            name='userloginlog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('IP', models.CharField(help_text='IP', max_length=100, unique=True)),
                ('local', models.CharField(help_text='IP', max_length=100, unique=True)),
                ('country', models.CharField(help_text='IP', max_length=100, unique=True)),
                ('geo_located', models.BooleanField(default=False, help_text='True if IP is geolocated.')),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.')),
                ('user', models.ForeignKey(blank=True, default='', help_text='User', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'User Type',
            },
        ),
        migrations.CreateModel(
            name='regionstate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Service region', max_length=100, unique=True)),
                ('GPS_latitude', models.DecimalField(decimal_places=8, default=0, help_text='Region central GPS latitude', max_digits=12)),
                ('GPS_longitude', models.DecimalField(decimal_places=8, default=0, help_text='Region central GPS latitude', max_digits=12)),
                ('ZoomLevel', models.IntegerField(default=15, help_text='Region Zoom Level')),
                ('GoogleCode', models.CharField(blank=True, default='', help_text='Region Google Code', max_length=2)),
                ('Country', models.ForeignKey(help_text='Region country', on_delete=django.db.models.deletion.CASCADE, to='core.country')),
            ],
            options={
                'verbose_name_plural': 'Region/States',
            },
        ),
        migrations.CreateModel(
            name='events',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Type', models.CharField(help_text='Event Type', max_length=10)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('Request_Id', models.CharField(blank=True, editable=False, help_text='Request ID', max_length=20)),
                ('Request', models.TextField(blank=True, help_text='The requests', max_length=1000)),
                ('user', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='event_user', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'API request',
            },
        ),
        migrations.CreateModel(
            name='districtregion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Service district', max_length=100, unique=True)),
                ('GPS_latitude', models.DecimalField(decimal_places=8, default=0, help_text='District central GPS latitude', max_digits=12)),
                ('GPS_longitude', models.DecimalField(decimal_places=8, default=0, help_text='District central GPS latitude', max_digits=12)),
                ('ZoomLevel', models.IntegerField(default=15, help_text='District Zoom Level')),
                ('GoogleCode', models.CharField(blank=True, default='', help_text='District Google Code', max_length=2)),
                ('regionstate', models.ForeignKey(help_text='District country', on_delete=django.db.models.deletion.CASCADE, to='core.regionstate')),
            ],
            options={
                'verbose_name_plural': 'District/Region',
            },
        ),
        migrations.AddField(
            model_name='country',
            name='Currency',
            field=models.ForeignKey(help_text='Country Currency', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.currency'),
        ),
        migrations.AddField(
            model_name='country',
            name='Language',
            field=models.ForeignKey(help_text='Country Language', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.language'),
        ),
        migrations.AddField(
            model_name='country',
            name='time_zone',
            field=models.ForeignKey(help_text='Country time zone', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.time_zone'),
        ),
        migrations.CreateModel(
            name='citymunicipality',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Service Municipality', max_length=100, unique=True)),
                ('GPS_latitude', models.DecimalField(decimal_places=8, default=0, help_text='Municipality central GPS latitude', max_digits=12)),
                ('GPS_longitude', models.DecimalField(decimal_places=8, default=0, help_text='Municipality central GPS latitude', max_digits=12)),
                ('ZoomLevel', models.IntegerField(default=15, help_text='Municipality Zoom Level')),
                ('GoogleCode', models.CharField(blank=True, default='', help_text='Municipality Google Code', max_length=2)),
                ('districtregion', models.ForeignKey(help_text='Municipality District', on_delete=django.db.models.deletion.CASCADE, to='core.districtregion')),
            ],
            options={
                'verbose_name_plural': 'City/Municipality',
            },
        ),
    ]


# --- App: core.migrations - File: 0005_alter_paymentlog_plantformuser.py ---

# Generated by Django 4.0.1 on 2022-12-13 21:57

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0004_alter_userloginlog_registrationdate_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='paymentlog',
            name='PlantformUser',
            field=models.ForeignKey(blank=True, default='', help_text='User', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: core.migrations - File: 0017_remove_districtregion_regionstate_delete_regionstate.py ---

# Generated by Django 4.0.1 on 2023-01-15 17:43

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0009_remove_contractsection_regionstate'),
        ('core', '0016_alter_citymunicipality_districtregion_and_more'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='districtregion',
            name='regionstate',
        ),
        migrations.DeleteModel(
            name='regionstate',
        ),
    ]


# --- App: core.migrations - File: __init__.py ---



# --- App: core.migrations - File: 0020_rideduration_token.py ---

# Generated by Django 4.0.1 on 2023-01-29 03:02

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='rideduration',
            name='Token',
            field=models.CharField(default='', help_text='Token', max_length=30),
        ),
    ]


# --- App: core.migrations - File: 0003_alter_userloginlog_options_alter_events_request_id.py ---

# Generated by Django 4.0.1 on 2022-12-10 02:03

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0002_userprofile'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='userloginlog',
            options={'verbose_name_plural': 'User login log'},
        ),
        migrations.AlterField(
            model_name='events',
            name='Request_Id',
            field=models.CharField(blank=True, help_text='Request ID', max_length=20),
        ),
    ]


# --- App: core.migrations - File: 0012_remove_commchannel_host_remove_commchannel_port_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-19 22:26

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0011_userloginlog_lat_userloginlog_lon_and_more'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='commchannel',
            name='host',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='port',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='pw_api',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='pw_crm',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='pw_ride',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='ssl_certfile',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='ssl_keyfile',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='use_ssl',
        ),
        migrations.RemoveField(
            model_name='commchannel',
            name='use_tls',
        ),
        migrations.AlterField(
            model_name='commchannel',
            name='Country',
            field=models.OneToOneField(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.country'),
        ),
    ]


# --- App: core.migrations - File: 0013_alter_commchannel_options.py ---

# Generated by Django 4.0.1 on 2022-12-20 02:05

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0012_remove_commchannel_host_remove_commchannel_port_and_more'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='commchannel',
            options={'verbose_name_plural': 'Communication channels'},
        ),
    ]


# --- App: core.migrations - File: 0006_alter_userloginlog_user.py ---

# Generated by Django 4.0.1 on 2022-12-13 21:58

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0005_alter_paymentlog_plantformuser'),
    ]

    operations = [
        migrations.AlterField(
            model_name='userloginlog',
            name='user',
            field=models.ForeignKey(blank=True, default='', help_text='payment_user', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: core.migrations - File: 0002_userprofile.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:16

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='userprofile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email_confirmed', models.BooleanField(default=False, help_text='True if email was confirmed.')),
                ('Tele_confirmed', models.BooleanField(default=False, help_text='True if telephone was confirmed.')),
                ('is_blocked', models.BooleanField(default=True, help_text='True if user was is_blocked.')),
                ('Paymentupdated', models.BooleanField(default=True, help_text='True if user info was updated on Stripe.')),
                ('Language1', models.ForeignKey(blank=True, default='', help_text='Frist Language', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_language1', to='core.language')),
                ('Language2', models.ForeignKey(blank=True, default='', help_text='Second Language', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_language2', to='core.language')),
                ('PlantformUserType', models.ForeignKey(blank=True, default='', help_text='User type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_type', to='core.usertype')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='profile_user', to=settings.AUTH_USER_MODEL)),
            ],
        ),
    ]


# --- App: core.migrations - File: 0016_alter_citymunicipality_districtregion_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-11 21:32

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0015_alter_regionstate_country'),
    ]

    operations = [
        migrations.AlterField(
            model_name='citymunicipality',
            name='districtregion',
            field=models.ForeignKey(help_text='Municipality District', on_delete=django.db.models.deletion.CASCADE, related_name='municipality_district', to='core.districtregion'),
        ),
        migrations.AlterField(
            model_name='districtregion',
            name='regionstate',
            field=models.ForeignKey(help_text='District country', on_delete=django.db.models.deletion.CASCADE, related_name='district_region', to='core.regionstate'),
        ),
        migrations.AlterField(
            model_name='regionstate',
            name='Country',
            field=models.ForeignKey(help_text='Region country', on_delete=django.db.models.deletion.CASCADE, related_name='region_country', to='core.country'),
        ),
    ]


# --- App: core.migrations - File: 0004_alter_userloginlog_registrationdate_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-13 21:47

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0003_alter_userloginlog_options_alter_events_request_id'),
    ]

    operations = [
        migrations.AlterField(
            model_name='userloginlog',
            name='RegistrationDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Access Date.'),
        ),
        migrations.AlterField(
            model_name='userloginlog',
            name='country',
            field=models.CharField(help_text='Country', max_length=100, unique=True),
        ),
        migrations.AlterField(
            model_name='userloginlog',
            name='local',
            field=models.CharField(help_text='Local', max_length=100, unique=True),
        ),
    ]


# --- App: core.migrations - File: 0018_equipment.py ---

# Generated by Django 4.0.1 on 2023-01-18 02:20

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0017_remove_districtregion_regionstate_delete_regionstate'),
    ]

    operations = [
        migrations.CreateModel(
            name='equipment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Public events type', max_length=30, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Equipments',
            },
        ),
    ]


# --- App: core.migrations - File: 0007_delete_paymentlog.py ---

# Generated by Django 4.0.1 on 2022-12-13 22:07

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0006_alter_userloginlog_user'),
    ]

    operations = [
        migrations.DeleteModel(
            name='paymentlog',
        ),
    ]


# --- App: core.migrations - File: 0010_rename_pr_ride_commchannel_pw_ride.py ---

# Generated by Django 4.0.1 on 2022-12-19 02:16

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0009_commchannel'),
    ]

    operations = [
        migrations.RenameField(
            model_name='commchannel',
            old_name='pr_ride',
            new_name='pw_ride',
        ),
    ]


# --- App: core.migrations - File: 0011_userloginlog_lat_userloginlog_lon_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-19 21:49

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0010_rename_pr_ride_commchannel_pw_ride'),
    ]

    operations = [
        migrations.AddField(
            model_name='userloginlog',
            name='lat',
            field=models.FloatField(default=0.0),
        ),
        migrations.AddField(
            model_name='userloginlog',
            name='lon',
            field=models.FloatField(default=0.0),
        ),
        migrations.AddField(
            model_name='userloginlog',
            name='region',
            field=models.CharField(default='', max_length=50),
        ),
        migrations.AddField(
            model_name='userloginlog',
            name='user_agent',
            field=models.TextField(default='', help_text='User agent'),
        ),
        migrations.AlterField(
            model_name='userloginlog',
            name='IP',
            field=models.CharField(help_text='IP', max_length=15),
        ),
        migrations.AlterField(
            model_name='userloginlog',
            name='country',
            field=models.CharField(help_text='Country', max_length=100),
        ),
        migrations.AlterField(
            model_name='userloginlog',
            name='local',
            field=models.CharField(default='', help_text='Local', max_length=50),
        ),
    ]


# --- App: core.migrations - File: 0009_commchannel.py ---

# Generated by Django 4.0.1 on 2022-12-19 02:10

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0008_alter_events_request'),
    ]

    operations = [
        migrations.CreateModel(
            name='commchannel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mail_crm', models.CharField(help_text='Country CRM e-mail', max_length=50)),
                ('pw_crm', models.CharField(help_text='CRM e-mail  Password', max_length=50)),
                ('mail_api', models.CharField(help_text='Country API support', max_length=50)),
                ('pw_api', models.CharField(help_text='API support Password', max_length=50)),
                ('mail_ride', models.CharField(help_text='Country Ride support', max_length=50)),
                ('pr_ride', models.CharField(help_text='Ride support Password', max_length=50)),
                ('host', models.CharField(help_text='E-mail host', max_length=50)),
                ('port', models.CharField(help_text='E-mail port', max_length=10)),
                ('use_tls', models.BooleanField(default=False, help_text='Use tls')),
                ('use_ssl', models.BooleanField(default=False, help_text='Use ssl')),
                ('ssl_keyfile', models.TextField(help_text='Ssl keyfile', max_length=300)),
                ('ssl_certfile', models.TextField(help_text='Ssl certfile', max_length=300)),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.country', unique=True)),
            ],
            options={
                'verbose_name_plural': 'Communication cannels',
            },
        ),
    ]


# --- App: supplier - File: tests.py ---

"""
Suroga Supplier App Test Suite

This module contains test cases for the 'supplier' app within the Suroga API project. It's
designed to ensure that the app's models, views, forms, and other components are working
as expected. Automated tests help in maintaining code quality and stability as the app changes
over time.

Usage:
    Run the tests from the command line using the `python manage.py test supplier` command.
    This will search for tests in this file and any other test files within the 'supplier' app.

References:
    - Django testing documentation: https://docs.djangoproject.com/en/4.0/topics/testing/
    - Writing and running tests: https://docs.djangoproject.com/en/4.0/topics/testing/overview/

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""

from django.test import TestCase


from django.test import TestCase
from .models import ProfileAgency, ProfileRepresentative, Contract, ContractSection
from django.contrib.auth.models import User
from django.utils import timezone

class ProfileAgencyModelTests(TestCase):
    @classmethod
    def setUpTestData(cls):
        # Set up data for the whole TestCase
        user = User.objects.create_user(username='testuser', password='12345')
        ProfileAgency.objects.create(user=user, Name='Test Agency', Address='123 Test Street')

    def test_name_label(self):
        agency = ProfileAgency.objects.get(id=1)
        field_label = agency._meta.get_field('Name').verbose_name
        self.assertEqual(field_label, 'Name')

    def test_registration_default(self):
        agency = ProfileAgency.objects.get(id=1)
        self.assertEqual(agency.Registration.date(), timezone.now().date())

class ProfileRepresentativeModelTests(TestCase):
    # Add setUpTestData and test methods for ProfileRepresentative model

    pass  # Placeholder for actual test methods

class ContractModelTests(TestCase):
    # Add setUpTestData and test methods for Contract model

    pass  # Placeholder for actual test methods

class ContractSectionModelTests(TestCase):
    # Add setUpTestData and test methods for ContractSection model

    pass  # Placeholder for actual test methods

# --- App: supplier - File: models.py ---

"""
Suroga Supplier App - Models Configuration

This module defines the data models for the Supplier application within the Suroga API project. By leveraging
Django's Object-Relational Mapping (ORM), these models represent the various entities and their interactions
as part of the app's domain. This includes profiles for agencies and representatives, contract details,
service types, communication channels, and many more.

Each class within this module corresponds to a table in the database, with fields representing the table
columns and relationships among tables mirroring the associations between the entities these models depict.
Furthermore, custom methods are added to some models to encapsulate logic related to the creation, update,
and retrieval of instances.

Highlights:
    - ForeignKey relationships to embody many-to-one associations.
    - Fields with various data types to accurately represent different properties of an entity.
    - Custom save methods to apply business rules and data integrity checks during the persistence of a model.
    - Meta subclass within each model to provide metadata and custom behavior.
    - Rich text-based help fields to guide the user/administrator through the Django admin interface.

References:
    - Django model field reference: https://docs.djangoproject.com/en/4.0/ref/models/fields/
    - Django model instance methods: https://docs.djangoproject.com/en/4.0/ref/models/instances/

Caution: Direct modifications to this file can affect the database schema and application behavior. Ensuring
that any changes follow Django's best practices and are coupled with appropriate migrations is critical to the
stability and integrity of the application's data.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
import datetime
import hashlib

from django.db import models, IntegrityError
from django.utils import timezone
from django.http import HttpResponse

from django.contrib.auth import get_user_model
User = get_user_model()

from core.models import equipment,country, districtregion, citymunicipality, RideDuration, image, sound, localwifi, publicevent


#from supplier.models import requisitiontype, selectiontype, offertype, informationtype, identificationtype, protocol, profileagency, reprecategory, profilerepresentative, contracttype, contractpaymenttype, contractpricetype, contract, contractsection, contractsectionchannels, servicetype, commtype, commlog

# Create your models here.
class requisitiontype(models.Model):
    """
    Represents types of requisitions available for requesting a surrogate service.
    
    Attributes:
        requisition: Human-readable text indicating the type of requisition method available.
    """
    requistion = models.CharField(max_length=50, unique=True, blank=False, help_text = "Requisition type")
     
    class Meta:
        verbose_name_plural = "Requisition type"
    def __str__(self):
        return self.requistion

class selectiontype(models.Model):
    """
    Denotes how surrogates are offered for selection by the service.
    
    Attributes:
        selection: A choice between single or multiple surrogate selection methods.
    """
    selection = models.CharField(max_length=50, unique=True, blank=False, help_text = "selection type")
     
    class Meta:
        verbose_name_plural = "Selection Types"
    def __str__(self):
        return self.selection


class offertype(models.Model):
    """
    Categorizes types of offers provided by the service.
    
    Attributes:
        offer: Details about the service offer like single or multiple options.
    """
    offer = models.CharField(max_length=50, unique=True, blank=False, help_text = "Offer type")
     
    class Meta:
        verbose_name_plural = "Offer Types"
    def __str__(self):
        return self.offer

class informationtype(models.Model):
    """
    Captures the kinds of information available about surrogates.
    
    Attributes:
        information: Description of the data provided about the surrogate.
    """
    information = models.CharField(max_length=50, unique=True, blank=False, help_text = "Information type")
     
    class Meta:
        verbose_name_plural = "Information Types"
    def __str__(self):
        return self.information

class identificationtype(models.Model):
    """
    Lists identifiable types for surrogates.
    
    Attributes:
        identification: Describes the means of identifying surrogates.
    """
    identification = models.CharField(max_length=50, unique=True, blank=False, help_text = "Identification type")
     
    class Meta:
        verbose_name_plural = "Identification Types"
    def __str__(self):
        return self.identification

class protocol(models.Model):
    """
    Details the agency's protocol for offering surrogate services.
    
    Attributes:
        Agency: Reference to the User model for the agency.
        Is_API: Flags if the agency employs an API.
        API_tested: Confirms if the agency's API is tested.
        API_ID: The API key or identifier if an API is used.
        WebSite: Official website or API endpoint URL.
        type_requisition: Links to the type of requisition used.
        type_selection: Links to the surrogate selection type.
        type_offer: Connects to the offer type used by the agency.
        type_information: Associates with the information type about surrogates.
        type_identification: Relates to the identification type used.
        Registration: Timestamp when the entry was made or updated.
    """
    Agency = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Agency", related_name='protocol_agency') 
    Is_API = models.BooleanField(default=False, help_text = "Agency has an API")  
    API_tested = models.BooleanField(default=False, help_text = "API was tested")  
    API_ID = models.CharField(max_length=50, unique=True, blank=True, help_text = "API key")
    WebSite = models.CharField(max_length=50, unique=True, blank=True, help_text = "API root page")
    type_requisition = models.ForeignKey(requisitiontype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Requisition type", related_name='protocol_requisition') 
    type_selection = models.ForeignKey(selectiontype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Selection type", related_name='protocol_selectionr') 
    type_offer = models.ForeignKey(offertype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Offer type", related_name='protocol_offer') 
    type_information = models.ForeignKey(informationtype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Information type", related_name='protocol_information') 
    type_identification = models.ForeignKey(identificationtype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Identification type", related_name='protocol_identification') 
    Registration = models.DateTimeField(default=timezone.now, help_text="Time of protocol creation or update")  
     
    class Meta:
        verbose_name_plural = "Protocol"
    def __str__(self):
        # Return the agency's username with a check if the Agency exists to prevent errors.
        return self.Agency.username if self.Agency else 'Unknown'


class profileagency(models.Model):

    """
    Model representing an agency's profile within the supplier app.
    
    Attributes:
        user: A foreign key to the Django's built-in User model, set to NULL if the related user is deleted.
        Name: The name of the agency (optional field).
        Address: The physical address of the agency (optional field).
        Zip_Code: The postal code for the agency's location (optional field).
        Country: A foreign key to another model 'country' representing the agency's country (optional field).
        Telephone: Contact telephone number for the agency (optional field).
        ITIN: Agency's Individual Tax Identification Number (optional field).
        IBAN: The International Bank Account Number associated with the agency (optional field).
        HashKey: A unique hash key to identify the agency, generated if not provided (not editable).
        Registration: The date and time when the agency profile was registered (non-editable, set to the current time by default).
        Website: The URL to the agency's official website (optional field).
        Stripe_ID: An identifier used for processing payments through Stripe (optional field).
        Extra_record: A text field to store extra records in a JSON format (optional field).
        Observation: A text field for any additional observations about the agency (optional field).
    """
    
    # Fields with types, constraints and help texts
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=False, related_name='agency_user')    
    
    Name = models.CharField(max_length=100, blank=True, help_text = "Agency Name") # Agency name
    Address = models.CharField(max_length=100, blank=True, help_text = "Address") # Agency address
    Zip_Code = models.CharField(max_length=100, blank=True, help_text = "Zip Code.") # Zip Code
    Country = models.ForeignKey(country, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Country", related_name='agency_Country') 
    Telephone = models.CharField(max_length=100, blank=True, help_text = "Business telephone.") # The contact number  
    ITIN = models.CharField(max_length=40, editable=True, blank=True, help_text = "Individual Tax Identification Number")    
    IBAN = models.CharField(max_length=40, editable=True, blank=True, help_text = "Agency IBAN")    
    HashKey = models.CharField(max_length=40, editable=False, blank=True, help_text = "Hash key to identity Agency")
    Registration = models.DateTimeField(default=timezone.now, editable=False)  
    Website = models.URLField(default='',blank=True, help_text = "Agency Website. ")  
    Stripe_ID = models.CharField(max_length=10, editable=True, blank=True, default='', help_text = "Agency ID")
    Extra_record  = models.TextField(max_length=1000, blank=True, help_text = "JSON: extra records.")
    Observation  = models.TextField(max_length=1000, blank=True, help_text = "Observation about Agency.")
    
    class Meta:
        verbose_name_plural = "Agency profile"
        
    def __str__(self):
        """
        String for representing the Model object.
        """
        return self.Name

    def save(self,force_insert=False, force_update=False, using=None):

        """
        Overwrites the save method to generate a hash key for the agency profile if not already set.
        """
        if not self.HashKey:
            # Generating the HashKey from the primary key, current date and time
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
            
        try:
            # Attempt to save the instance using superclass's save method
            return super(profileagency, self).save()
        except IntegrityError:
            # Handling the IntegrityError in the unlikely event it is raised
            return HttpResponse("ERROR: this agency can not be saved...") 

class reprecategory(models.Model):
    """
    Model for listing categories of representatives within the supplier app.

    Attributes:
    - JobCategory: The category title of a representative; a required field and must be unique.
    """

    JobCategory = models.CharField(max_length=50, unique=True, blank=False, help_text = "Representative category")
     
    class Meta:
        # Plural name for admin panel
        verbose_name_plural = "Representative category"
    def __str__(self):
        # Representation of the model object in human-readable form
        return self.JobCategory

class profilerepresentative(models.Model):

    """
    Model representing an individual representative's profile.

    Attributes:
    - user: A ForeignKey to Django's built-in User model, set to NULL if the related user is deleted.
    - Name: The representative's name; an optional field.
    - Address: The representative's address; an optional field.
    - Zip_Code: The zip code for the representative's address; an optional field.
    - Country: A ForeignKey to the 'country' model; an optional field.
    - Telephone: The representative's business telephone number; an optional field.
    - HashKey: An automatically generated unique hash key to identify the representative; not editable.
    - Registration: The date and time of registration; non-editable, automatic timestamp.
    - Agency: A ForeignKey linking to a 'profileagency' representing the representative's agency; an optional field.
    - Extra_record: A TextField containing extra records in JSON format; an optional field.
    - Observation: A TextField for any additional notes about the representative; an optional field.
    - Category: A ForeignKey linking to the 'reprecategory' model; an optional field.
    """

    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=False, related_name='representative_user')    
    
    Name = models.CharField(max_length=100, blank=True, help_text = "ARepresentativegency Name") # Representative name
    Address = models.CharField(max_length=100, blank=True, help_text = "Address") # Representative address
    Zip_Code = models.CharField(max_length=100, blank=True, help_text = "Zip Code.") # Zip Code
    Country = models.ForeignKey(country, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Country", related_name='representative_country') 
    Telephone = models.CharField(max_length=15, blank=True, help_text = "Business telephone.") # The contact number  
    HashKey = models.CharField(max_length=40, editable=False, blank=True, help_text = "Hash key to identity Representative")
    Registration = models.DateTimeField(default=timezone.now, editable=False)  
    Agency = models.ForeignKey(profileagency, on_delete=models.SET_NULL, null=True, blank=True,related_name='Agency')    
    Extra_record  = models.TextField(max_length=1000, blank=True, help_text = "JSON: extra records.")
    Observation  = models.TextField(max_length=1000, blank=True, help_text = "Observation about Representative.")
    Category = models.ForeignKey(reprecategory,on_delete=models.SET_NULL, null=True, blank=True,related_name='representative_category')    
    
    class Meta:
        # Plural name for admin panel
        verbose_name_plural = "Representative profile"
        
    def __str__(self):
        # Representation of the model object in human-readable form
        return self.Name

    # Custom save method to handle HashKey generation and catching IntegrityError can be written here.
    def save(self,force_insert=False, force_update=False, using=None):

        if not self.HashKey:
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
            
        try:
            return super(profilerepresentative, self).save()
        except IntegrityError:
            return HttpResponse("ERROR: this representative can not be saved...") 

class contracttype(models.Model):
    """
    Model for listing types of contracts.

    Attributes:
    - ContractTypeName: A unique name for a type of contract; a required field.
    """
    ContratctTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "Contract Type")
     
    class Meta:
        # Plural name for admin panel
        verbose_name_plural = "Contract Types"
    def __str__(self):
        # Representation of the model object in human-readable form
        return self.ContratctTypeName


class contractpaymenttype(models.Model):
    """
    Model for listing types of contract payments.

    Attributes:
    - PaymentTypeName: A unique name for a payment type; a required field.
    """
    PaymentTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "Payment Type")
     
    class Meta:
        # Plural name for admin panel
        verbose_name_plural = "Contract Payment Types"
    def __str__(self):
        # Representation of the model object in human-readable form
        return self.PaymentTypeName

class contractpricetype(models.Model):
    """
    Model for listing different types of pricing strategies or structures that can be applied to contracts.

    Attributes:
    - PriceTypeName: A name given to the specific price type; must be unique and is a required field.
    """
    # Field for storing the name of the price type
    PriceTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "Price Type")
     
    class Meta:
        # Plural name for the admin panel to describe this collection of models
        verbose_name_plural = "Contract Price Types"
    def __str__(self):
        # Representation of the model object in human-readable form
        return self.PriceTypeName

class contract(models.Model):
    """
    Model for managing contracts between suppliers and other entities.

    Attributes:
    - Supplier: A ForeignKey to the User model representing the supplier involved in the contract. It can be null.
    - contract_type: A ForeignKey to the contracttype model that specifies the type of the contract. It can be null.
    - Contract_Date_start: The start date of the contract.
    - Contract_Date_expiration: The expiration or end date of the contract.
    - Contract_POC: A ForeignKey to the profilerepresentative model; the Point of Contact (POC) for the contract. It can be null.
    - Payment_type: A ForeignKey to the contractpaymenttype model describing how payments are to be made. It can be null.
    - Price_type: A ForeignKey to the contractpricetype model specifying the pricing structure. It can be null.
    - Registration: The date and time the contract was registered; not editable.
    - is_active: A Boolean indicating whether the contract is currently active.
    """
    # Relationships to other models and essential fields
    Supplier = models.ForeignKey(User,on_delete=models.SET_NULL,null=True, blank=True, related_name='contract_supplier')    
    contract_type = models.ForeignKey(contracttype,default='', on_delete=models.SET_NULL, null=True, blank=True, related_name='contract_type')
    Contract_Date_start = models.DateField(default=timezone.now, help_text = "contract Start")
    Contract_Date_expiration = models.DateField(default=timezone.now, help_text = "contract Deadline")
    Contract_POC = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='contract_POC')    
    Payment_type = models.ForeignKey(contractpaymenttype,on_delete=models.SET_NULL,null=True, blank=True, related_name='contract_payment')    
    Price_type = models.ForeignKey(contractpricetype,on_delete=models.SET_NULL,null=True, blank=True, related_name='contract_price')    
    Registration = models.DateTimeField(default=timezone.now, editable=False)  
    is_active = models.BooleanField(default=True, help_text = "True if contract is active")  
    class Meta:
        verbose_name_plural = "Contracts"

class contractsection(models.Model):
    """
    Model for managing specific sections or clauses within a contract.

    Attributes:
    - contract: A ForeignKey to the contract model that this section belongs to. It can be null.
    - Country: A ForeignKey to the country model specifying the country of operation or relevance for the section. It can be null.
    - DistrictRegion: A ForeignKey to the districtregion model; the region or district mentioned in the section. It can be null.
    - CityMunicipality: A ForeignKey to the citymunicipality model; the city or municipality covered by the section. It can be null.
    - RequiredMaxConfigTime: A DecimalField specifying the maximum allowable time for configuration or setup in hours.
    - SectonStock: A TextField containing a JSON description of the stock associated with the section, if any.
    - Registration: The date and time the section was registered; not editable.
    - is_active: A Boolean indicating whether the contract section is currently active.
    - variante: A TextField containing a JSON description of any variants or special conditions of the contract section.
    """
    # Relationships to other models and additional fields for storing contract details
    contract = models.ForeignKey(contract,on_delete=models.SET_NULL, null=True, blank=True,help_text = "contract", related_name='section_contract')
    Country = models.ForeignKey(country,on_delete=models.SET_NULL,null=True, blank=True, help_text = "Country", related_name='section_country')
    DistrictRegion = models.ForeignKey(districtregion,on_delete=models.SET_NULL, null=True, blank=True,help_text = "District/Region", related_name='section_district')
    CityMunicipality = models.ForeignKey(citymunicipality,on_delete=models.SET_NULL,null=True, blank=True, help_text = "City/Municipality", related_name='section_municipality')
    RequiredMaxConfigTime = models.DecimalField(max_digits=5, decimal_places=1, default=0, help_text = "Required Max Config Time (hours)")  
    SectonStock = models.TextField(max_length=1000, blank=True, help_text = "JSON: Section stock description")
    Registration = models.DateTimeField(default=timezone.now, editable=False)  
    is_active = models.BooleanField(default=True, help_text = "True if contract is active") 
    variante = models.TextField(max_length=1000, blank=True, help_text = "JSON: contract variant") 

    class Meta:
        verbose_name_plural = "Contract Sections"


class contractsectionchannels(models.Model):
    """
    Model for representing communication channels associated with a particular contract section.

    Attributes:
    - ContractSection: A ForeignKey to the contractsection model that this communication channel is related to.
    - CommOrderSaToSupp: A ForeignKey to a profilerepresentative model for communication from sales assistant to supplier.
    - CommRideSuppToSa: A ForeignKey to a profilerepresentative model for communication from supplier to sales assistant regarding rides.
    - CommOrderSaToSupp: A ForeignKey to a profilerepresentative model for communication regarding orders from sales assistant to supplier. (Duplicate field, likely a mistake.)
    - CommOrderSuppToSa: A ForeignKey to a profilerepresentative model for communication regarding orders from supplier to sales assistant.
    - CommInvoice: A ForeignKey to a profilerepresentative model for communication regarding invoices.
    - CommPaymConfirm: A ForeignKey to a profilerepresentative model for confirming payments.
    """
    # Relationships to other models. Please note there seems to be an error with duplicate field 'CommOrderSaToSupp', which should be addressed.
    ContractSection = models.ForeignKey(contractsection,on_delete=models.SET_NULL, null=True, blank=False, related_name='channel_section')    
    CommOrderSaToSupp = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm1')    
    CommRideSuppToSa = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm2')    
    CommOrderSaToSupp = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm3')    
    CommOrderSuppToSa = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm4')    
    CommInvoice = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm5')    
    CommPaymConfirm = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='channel_comm6')    

    class Meta:
        verbose_name_plural = "Contract Section Channels"

class servicetype(models.Model):
    """
    Model for categorizing different types of provided services.

    Attributes:
    - Name: The unique name of the service.
    - Duration: A ForeignKey to the RideDuration model relating to the duration of the service.
    - Equipment: A ForeignKey to the equipment model representing equipment associated with the service.
    - Image: A ForeignKey to the image model representing images associated with the service.
    - Sound: A ForeignKey to the sound model representing sound aspects of the service.
    - LocalWifi: A ForeignKey to the localwifi model representing wifi services involved.
    - PublicEvent: A ForeignKey to the publicevent model representing if the service involves public events.
    - ContractA to ContractF: Boolean fields to indicate if the service requires different types of contracts.
    - ServiceRules: A TextField to store service rules in a JSON format.
    - ServiceSetting: A TextField to store service settings in a JSON format.
    """
    Name = models.CharField(max_length=50, unique=True, blank=False, help_text = "Service name")
    Duration = models.ForeignKey(RideDuration,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Duration') 
    Equipment = models.ForeignKey(equipment,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Image')
    Image = models.ForeignKey(image,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Image')
    Sound = models.ForeignKey(sound,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Sound')
    LocalWifi = models.ForeignKey(localwifi,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Wifi')
    PublicEvent = models.ForeignKey(publicevent,on_delete=models.SET_NULL, null=True, blank=True,related_name='service_Event')
    ContractA = models.BooleanField(default=False, help_text = "True if requires type A contract") 
    ContractB = models.BooleanField(default=False, help_text = "True if requires type B contract") 
    ContractC = models.BooleanField(default=False, help_text = "True if requires type C contract") 
    ContractD = models.BooleanField(default=False, help_text = "True if requires type D contract") 
    ContractE = models.BooleanField(default=False, help_text = "True if requires type E contract") 
    ContractF = models.BooleanField(default=False, help_text = "True if requires type F contract") 
    ServiceRules = models.TextField(max_length=1000, blank=True, help_text = "JSON: Service rules") 
    ServiceSetting = models.TextField(max_length=1000, blank=True, help_text = "JSON: Service rules")
    class Meta:
        verbose_name_plural = "Service Types"
    def __str__(self):
        return self.Name


class commtype(models.Model):
    """
    Model for listing communication types, such as email, phone call, messaging app, etc.

    Attributes:
    - CommTypeName: The unique name of the communication type; a required field.
    """
    CommTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "Communication Type")
     
    class Meta:
        verbose_name_plural = "Communication Types"
    def __str__(self):
        return self.CommTypeName





# --- App: supplier - File: __init__.py ---



# --- App: supplier - File: views.py ---

from django.shortcuts import render

# Create your views here.


# --- App: supplier - File: admin.py ---

"""
Suroga Supplier App - Admin Configuration

This module defines the configuration for presenting Supplier app models
in the Django Administrator Site. It uses Django's in-built admin.ModelAdmin
subclassing to specify the layout and options for admin pages rendered for each
model.

With custom admin classes that extend admin.ModelAdmin, administrators can
customize how models are displayed, searched, and filtered, enhancing the
admin interface for entities such as contract sections, service types, and
communication types.

Each admin class defines a 'list_display' attribute determining which model fields
are displayed in the admin list view. The admin.site.register function binds these
classes to their respective models, activating them within the admin interface.

Usage:
    To include a model in the admin interface, define an admin class subclassing
    'admin.ModelAdmin', customize its presentation as necessary, and register it
    with the 'admin.site.register' call.

References:
    - Django admin site documentation: https://docs.djangoproject.com/en/4.0/ref/contrib/admin/
    - Django ModelAdmin documentation: https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
from django.contrib import admin

# Register your models here.
from supplier.models import requisitiontype, selectiontype, offertype, informationtype
from supplier.models import identificationtype, protocol, profileagency, reprecategory
from supplier.models import profilerepresentative, contracttype, contractpaymenttype
from supplier.models import contractpricetype, contract, contractsection
from supplier.models import contractsectionchannels, servicetype, commtype


class requisitiontypeAdmin(admin.ModelAdmin):
	# Configuration for how 'requisitiontype' model should be displayed in the admin interface
    list_display = (
    'pk',
    'requistion',
    )
    # 'list_display' defines the fields of 'requisitiontype' model that appear in the list display

# Registers the 'requisitiontype' model with the admin interface using the 'requisitiontypeAdmin' class for settings
admin.site.register(requisitiontype,requisitiontypeAdmin)

class selectiontypeAdmin(admin.ModelAdmin):
	list_display = (
    'pk',
    'selection',
    )
admin.site.register(selectiontype,selectiontypeAdmin)

class offertypeAdmin(admin.ModelAdmin):
	# Admin configuration for displaying 'selectiontype' model instances
    list_display = (
    'pk',
    'offer',
    )
# Registers the 'selectiontype' model with the admin interface
admin.site.register(offertype,offertypeAdmin)

class informationtypeAdmin(admin.ModelAdmin):
	# Defines how 'informationtype' model entries are represented in the admin list
    list_display = (
    'pk',
    'information',
    )
# Registration of the 'informationtype' model with the admin interface
admin.site.register(informationtype,informationtypeAdmin)


class identificationtypeAdmin(admin.ModelAdmin):
	# Sets up the admin list view for 'identificationtype' model
    list_display = (
    'pk',
    'identification',
    )
# Makes the 'identificationtype' model administrable through Django admin
admin.site.register(identificationtype,identificationtypeAdmin)

class protocolAdmin(admin.ModelAdmin):
	# Admin configuration that details how 'protocol' model instances are displayed
    list_display = (
    'pk',
    'Agency',
    'Is_API',
    'type_requisition',
    'type_selection',
    'type_offer',
    'type_information',
    'type_identification',
    )
# Registers the 'protocol' model with the admin interface
admin.site.register(protocol,protocolAdmin)

class profileagencyAdmin(admin.ModelAdmin):
	# Outlines the representation of 'profileagency' model instances in the admin interface
    list_display = (
    'pk',
    'user',
    'Name',
    'Address',
    'Zip_Code',
    'Country',
    'Telephone',
    )
# Adds the 'profileagency' model to the admin panel for managing those instances
admin.site.register(profileagency,profileagencyAdmin)

class reprecategoryAdmin(admin.ModelAdmin):
	# Specifies columns for 'reprecategory' model in Django admin list view
    list_display = (
    'pk',
    'JobCategory',
    )
# Registers the 'reprecategory' model and applies 'reprecategoryAdmin' class configurations to the admin interface
admin.site.register(reprecategory,reprecategoryAdmin)

class profilerepresentativeAdmin(admin.ModelAdmin):
	# Defines the representation of 'profilerepresentative' model instances with selected fields in the admin list view
    list_display = (
    'pk',
    'user',
    'Agency',
    'Category',
    'Name',
    'Telephone',
    )
# Registers 'profilerepresentative' for management via the admin interface with 'profilerepresentativeAdmin' settings
admin.site.register(profilerepresentative,profilerepresentativeAdmin)

class contracttypeAdmin(admin.ModelAdmin):
	# Sets the fields for 'contracttype' that will be shown in the admin interface list view
    list_display = (
    'pk',
    'ContratctTypeName',
    )
# Adds 'contracttype' model to Django admin and specifies the admin display settings with 'contracttypeAdmin' class
admin.site.register(contracttype,contracttypeAdmin)

class contractpaymenttypeAdmin(admin.ModelAdmin):
	# Configures how 'contractpaymenttype' is displayed in the admin panel, showing the primary key and payment type name
    list_display = (
    'pk',
    'PaymentTypeName',
    )
# Registers the 'contractpaymenttype' model with the admin site using the defined 'contractpaymenttypeAdmin' class
admin.site.register(contractpaymenttype,contractpaymenttypeAdmin)

class contractpricetypeAdmin(admin.ModelAdmin):
	# Customizes the admin list for 'contractpricetype' to display the ID and price type name
    list_display = (
    'pk',
    'PriceTypeName',
    )
# Registers 'contractpricetype' with the Django admin site and applies the 'contractpricetypeAdmin' configuration
admin.site.register(contractpricetype,contractpricetypeAdmin)

class contractAdmin(admin.ModelAdmin):
	# Admin configuration that enumerates the fields to show for 'contract' model list view in admin
    list_display = (
    'pk',
    'Supplier',
    'is_active',
    'contract_type',
    'Contract_Date_start',
    'Contract_POC',
    'Payment_type',
    'Price_type',
    )
# Allows the 'contract' model to be managed via the admin interface with the given 'contractAdmin' settings
admin.site.register(contract,contractAdmin)

class contractsectionAdmin(admin.ModelAdmin):
	# Decides which columns to display in the admin for 'contractsection', including status and related contract/detail fields
    list_display = (
    'pk',
    'is_active',
    'contract',
    'CityMunicipality',
    'DistrictRegion',
    'Country',
    'RequiredMaxConfigTime',
    )
# Registers the 'contractsection' model to be administrable in the Django admin site with 'contractsectionAdmin' settings
admin.site.register(contractsection,contractsectionAdmin)

class contractsectionchannelsAdmin(admin.ModelAdmin):
	# Configures the admin panel list view for the 'contractsectionchannels' model.
    # list_display specifies the model fields to be displayed in the list view.
    list_display = (
    'pk', # The primary key of the record.
    'ContractSection', # ForeignKey pointing to a 'contractsection' instance.
    'CommOrderSaToSupp', # ForeignKey to a 'profilerepresentative' for one type of communication channel.
    'CommRideSuppToSa', # ForeignKey to a 'profilerepresentative' for another type of communication channel.
    'CommOrderSaToSupp',# Duplicate field name, likely an error; it should be unique or different from the previous one.
    'CommOrderSuppToSa',# ForeignKey to a 'profilerepresentative' for a different communication channel.
    'CommInvoice',# ForeignKey to a 'profilerepresentative' related to the invoice communication.
    'CommPaymConfirm',  # ForeignKey to a 'profilerepresentative' for payment confirmation communication.
    )
# Registers the 'contractsectionchannels' model for management with the defined admin class to the admin site.
admin.site.register(contractsectionchannels,contractsectionchannelsAdmin)

class servicetypeAdmin(admin.ModelAdmin):
	# This admin class outlines how instances of 'servicetype' will appear in the admin list view.
    # Fields listed in list_display are shown as columns on the list page.
    list_display = (
    'pk', # The primary key.
    'Name', # Name of the service type.
    'Duration',  # ForeignKey to another model defining the duration of the service.
    'Image',  # ForeignKey to a model that possibly holds images related to the service.
    'Sound', # ForeignKey to a model holding sound files related to the service.
    'LocalWifi', # ForeignKey to a model representing local wireless internet service.
    'PublicEvent',# ForeignKey to a model indicating if the service involves public events.
    'ContractB',# A series of boolean flags indicating if the service requires a specific type of contract.
    'ContractC',# A series of boolean flags indicating if the service requires a specific type of contract.
    'ContractD',# A series of boolean flags indicating if the service requires a specific type of contract.
    'ContractE',# A series of boolean flags indicating if the service requires a specific type of contract.
    'ContractF', # A series of boolean flags indicating if the service requires a specific type of contract.
    )
# Registers 'servicetype' model with the admin site and applies the 'servicetypeAdmin' class settings.
admin.site.register(servicetype,servicetypeAdmin)

class commtypeAdmin(admin.ModelAdmin):
	# Gestures how 'commtype' model instances will be administrated in the list view.
    list_display = (
    'pk', # The primary key of the record.
    'CommTypeName',  # The name of the communication type, a unique attribute of the model.
    
    )
# Activates the 'commtype' model in the Django admin and uses 'commtypeAdmin' class to define display settings.
admin.site.register(commtype,commtypeAdmin)

# --- App: supplier - File: apps.py ---

"""
Suroga Supplier App Configuration

This module contains the Django AppConfig subclass for the 'supplier' app. AppConfig classes
are used by Django to configure application properties and behaviors. This is the class that
represents the supplier application configuration and is used to set up any application-specific
settings such as the default field types for database models.

Django uses this class to get information about the application and especially when initializing
the application during the startup process.

Attributes:
    default_auto_field: Specifies the default AutoField to use as a primary key for models
                        within this application when no field is explicitly specified. Using
                        'BigAutoField' supports a larger number of objects.
    name: The full Python path of the application, used by Django to reference and import
          the app as needed throughout the project.

Tips:
    Make sure to point the 'INSTALLED_APPS' setting in the project's `settings.py` file to
    this AppConfig class to ensure application configuration is correctly applied.

References:
    - AppConfig documentation: https://docs.djangoproject.com/en/4.0/ref/applications/#django.apps.AppConfig
    - Applications in Django: https://docs.djangoproject.com/en/4.0/ref/applications/

Maintainer: Carlos Leandro
Last Modified: 15/4/2014
"""
from django.apps import AppConfig


class SupplierConfig(AppConfig):
    # This property is a string that points to a model field class to be used as the default for primary key fields
    # if no specific primary key field is defined in a model. The 'BigAutoField' is recommended for new projects as it
    # provides a 64-bit integer field that auto-increments. This is generally used when expecting a high number of objects
    # to avoid primary key value exhaustion.
    default_auto_field = 'django.db.models.BigAutoField'
    
    # The 'name' property sets a string that defines the full Python path to the app. In this case, the app is named 'supplier'.
    # This dotted path is how Django identifies and imports the app throughout the project. The name is used in various
    # Django commands and settings, such as the INSTALLED_APPS setting in the project's settings.py file which is used to
    # include this app within the project.
    name = 'supplier'


# --- App: supplier.migrations - File: 0009_remove_contractsection_regionstate.py ---

# Generated by Django 4.0.1 on 2023-01-15 17:43

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0008_contract_contract_type'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='contractsection',
            name='RegionState',
        ),
    ]


# --- App: supplier.migrations - File: 0011_servicetype_servicesetting.py ---

# Generated by Django 4.0.1 on 2023-01-17 22:39

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0010_remove_contractsection_price_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='servicetype',
            name='ServiceSetting',
            field=models.TextField(blank=True, help_text='JSON: Service rules', max_length=1000),
        ),
    ]


# --- App: supplier.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:06

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('core', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='commtype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('CommTypeName', models.CharField(help_text='Communication Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Communication Types',
            },
        ),
        migrations.CreateModel(
            name='contract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Contract_Date_start', models.DateField(default=django.utils.timezone.now, help_text='contract Start')),
                ('Contract_Date_expiration', models.DateField(default=django.utils.timezone.now, help_text='contract Deadline')),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('is_active', models.BooleanField(default=True, help_text='True if contract is active')),
            ],
            options={
                'verbose_name_plural': 'Contract',
            },
        ),
        migrations.CreateModel(
            name='contractpaymenttype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('PaymentTypeName', models.CharField(help_text='Payment Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Contract payment Type',
            },
        ),
        migrations.CreateModel(
            name='contractpricetype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('PriceTypeName', models.CharField(help_text='Price Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Contract price Type',
            },
        ),
        migrations.CreateModel(
            name='contractsection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('RequiredMaxConfigTime', models.DecimalField(decimal_places=1, default=0, help_text='Required Max Config Time (hours)', max_digits=5)),
                ('SectonStock', models.CharField(help_text='Price Type', max_length=50, unique=True)),
                ('Price', models.DecimalField(decimal_places=2, default=0, help_text='Price (local)', max_digits=6)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('is_active', models.BooleanField(default=True, help_text='True if contract is active')),
                ('DeadlineSApayment', models.DateField(default=django.utils.timezone.now, help_text='payment Type Deadline')),
                ('CityMunicipality', models.ForeignKey(blank=True, help_text='City/Municipality', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='section_municipality', to='core.citymunicipality')),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='section_country', to='core.country')),
                ('DistrictRegion', models.ForeignKey(blank=True, help_text='District/Region', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='section_district', to='core.districtregion')),
                ('RegionState', models.ForeignKey(blank=True, help_text='Region/State', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='section_region', to='core.regionstate')),
                ('contract', models.ForeignKey(blank=True, help_text='contract', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='section_contract', to='supplier.contract')),
            ],
            options={
                'verbose_name_plural': 'Contract section',
            },
        ),
        migrations.CreateModel(
            name='contracttype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ContratctTypeName', models.CharField(help_text='Contract Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Contract Types',
            },
        ),
        migrations.CreateModel(
            name='identificationtype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('identification', models.CharField(help_text='Identification type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Identification type',
            },
        ),
        migrations.CreateModel(
            name='informationtype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('offer', models.CharField(help_text='Information type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Information type',
            },
        ),
        migrations.CreateModel(
            name='offertype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('selection', models.CharField(help_text='Offer type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Offer type',
            },
        ),
        migrations.CreateModel(
            name='profileagency',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(blank=True, help_text='Agency Name', max_length=100)),
                ('Address', models.CharField(blank=True, help_text='Address', max_length=100)),
                ('Zip_Code', models.CharField(blank=True, help_text='Zip Code.', max_length=100)),
                ('Telephone', models.CharField(blank=True, help_text='Business telephone.', max_length=100)),
                ('ITIN', models.CharField(blank=True, help_text='Individual Tax Identification Number', max_length=40)),
                ('IBAN', models.CharField(blank=True, help_text='Agency IBAN', max_length=40)),
                ('HashKey', models.CharField(blank=True, help_text='Hash key to identity Agency', max_length=40)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('Website', models.URLField(blank=True, default='', help_text='Agency Website. ')),
                ('Stripe_ID', models.CharField(blank=True, default='', help_text='Agency ID', max_length=10)),
                ('Extra_record', models.TextField(blank=True, help_text='JSON: extra records.', max_length=1000)),
                ('Observation', models.TextField(blank=True, help_text='Observation about Agency.', max_length=1000)),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='agency_Country', to='core.country')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='agency_user', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Agency profile',
            },
        ),
        migrations.CreateModel(
            name='reprecategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('JobCategory', models.CharField(help_text='Representative category', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Representative category',
            },
        ),
        migrations.CreateModel(
            name='requisitiontype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('requistion', models.CharField(help_text='Requisition type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Requisition type',
            },
        ),
        migrations.CreateModel(
            name='selectiontype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('selection', models.CharField(help_text='selection type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Selection type',
            },
        ),
        migrations.CreateModel(
            name='servicetype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Service name', max_length=50, unique=True)),
                ('ContractB', models.BooleanField(default=False, help_text='True if requires type B contract')),
                ('ContractC', models.BooleanField(default=False, help_text='True if requires type C contract')),
                ('ContractD', models.BooleanField(default=False, help_text='True if requires type D contract')),
                ('ContractE', models.BooleanField(default=False, help_text='True if requires type E contract')),
                ('ContractF', models.BooleanField(default=False, help_text='True if requires type F contract')),
                ('ServiceRules', models.TextField(blank=True, help_text='JSON: Service rules', max_length=1000)),
                ('Duration', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Duration', to='core.rideduration')),
                ('Image', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Image', to='core.image')),
                ('LocalWifi', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Wifi', to='core.localwifi')),
                ('PublicEvent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Event', to='core.publicevent')),
                ('Sound', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Sound', to='core.sound')),
            ],
            options={
                'verbose_name_plural': 'Service Types',
            },
        ),
        migrations.CreateModel(
            name='protocol',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Is_API', models.BooleanField(default=False, help_text='Agency has an API')),
                ('API_tested', models.BooleanField(default=False, help_text='API was tested')),
                ('API_ID', models.CharField(help_text='API key', max_length=50, unique=True)),
                ('WebSite', models.CharField(help_text='API root page', max_length=50, unique=True)),
                ('Agency', models.ForeignKey(help_text='Agency', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_agency', to=settings.AUTH_USER_MODEL)),
                ('type_identification', models.ForeignKey(help_text='Identification type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_identification', to='supplier.identificationtype')),
                ('type_information', models.ForeignKey(help_text='Information type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_information', to='supplier.informationtype')),
                ('type_offer', models.ForeignKey(help_text='Offer type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_offer', to='supplier.offertype')),
                ('type_requisition', models.ForeignKey(help_text='Requisition type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_requisition', to='supplier.requisitiontype')),
                ('type_selection', models.ForeignKey(help_text='Selection type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='protocol_selectionr', to='supplier.selectiontype')),
            ],
            options={
                'verbose_name_plural': 'Protocol',
            },
        ),
        migrations.CreateModel(
            name='profilerepresentative',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(blank=True, help_text='ARepresentativegency Name', max_length=100)),
                ('Address', models.CharField(blank=True, help_text='Address', max_length=100)),
                ('Zip_Code', models.CharField(blank=True, help_text='Zip Code.', max_length=100)),
                ('Telephone', models.CharField(blank=True, help_text='Business telephone.', max_length=15)),
                ('HashKey', models.CharField(blank=True, help_text='Hash key to identity Representative', max_length=40)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('Extra_record', models.TextField(blank=True, help_text='JSON: extra records.', max_length=1000)),
                ('Observation', models.TextField(blank=True, help_text='Observation about Representative.', max_length=1000)),
                ('Agency', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='Agency', to='supplier.profileagency')),
                ('Category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='representative_category', to='supplier.reprecategory')),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='representative_country', to='core.country')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='representative_user', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Representative profile',
            },
        ),
        migrations.CreateModel(
            name='contractsectionchannels',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('CommInvoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_comm5', to='supplier.profilerepresentative')),
                ('CommOrderSaToSupp', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_comm3', to='supplier.profilerepresentative')),
                ('CommOrderSuppToSa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_comm4', to='supplier.profilerepresentative')),
                ('CommPaymConfirm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_comm6', to='supplier.profilerepresentative')),
                ('CommRideSuppToSa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_comm2', to='supplier.profilerepresentative')),
                ('ContractSection', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_section', to='supplier.contractsection')),
            ],
            options={
                'verbose_name_plural': 'Contract section Channels',
            },
        ),
        migrations.AddField(
            model_name='contract',
            name='Contract_POC',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_POC', to='supplier.profilerepresentative'),
        ),
        migrations.AddField(
            model_name='contract',
            name='Payment_type',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_payment', to='supplier.contractpaymenttype'),
        ),
        migrations.AddField(
            model_name='contract',
            name='Price_type',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_price', to='supplier.contractpricetype'),
        ),
        migrations.AddField(
            model_name='contract',
            name='Supplier',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_supplier', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: supplier.migrations - File: 0012_servicetype_contracta.py ---

# Generated by Django 4.0.1 on 2023-01-18 01:02

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0011_servicetype_servicesetting'),
    ]

    operations = [
        migrations.AddField(
            model_name='servicetype',
            name='ContractA',
            field=models.BooleanField(default=False, help_text='True if requires type A contract'),
        ),
    ]


# --- App: supplier.migrations - File: __init__.py ---



# --- App: supplier.migrations - File: 0006_alter_contract_registration.py ---

# Generated by Django 4.0.1 on 2022-12-26 17:37

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0005_alter_protocol_api_id_alter_protocol_website'),
    ]

    operations = [
        migrations.AlterField(
            model_name='contract',
            name='Registration',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
    ]


# --- App: supplier.migrations - File: 0002_rename_offer_informationtype_information_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-10 11:05

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0001_initial'),
    ]

    operations = [
        migrations.RenameField(
            model_name='informationtype',
            old_name='offer',
            new_name='information',
        ),
        migrations.RenameField(
            model_name='offertype',
            old_name='selection',
            new_name='offer',
        ),
    ]


# --- App: supplier.migrations - File: 0007_remove_contractsection_deadlinesapayment_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-26 17:59

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0006_alter_contract_registration'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='contractsection',
            name='DeadlineSApayment',
        ),
        migrations.AlterField(
            model_name='contractsection',
            name='Registration',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
        migrations.AlterField(
            model_name='contractsection',
            name='SectonStock',
            field=models.TextField(blank=True, help_text='JSON: Section stock description', max_length=1000),
        ),
    ]


# --- App: supplier.migrations - File: 0010_remove_contractsection_price_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-17 21:33

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0009_remove_contractsection_regionstate'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='contractsection',
            name='Price',
        ),
        migrations.AddField(
            model_name='contractsection',
            name='variante',
            field=models.TextField(blank=True, help_text='JSON: contract variant', max_length=1000),
        ),
    ]


# --- App: supplier.migrations - File: 0005_alter_protocol_api_id_alter_protocol_website.py ---

# Generated by Django 4.0.1 on 2022-12-26 16:38

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0004_protocol_registration'),
    ]

    operations = [
        migrations.AlterField(
            model_name='protocol',
            name='API_ID',
            field=models.CharField(blank=True, help_text='API key', max_length=50, unique=True),
        ),
        migrations.AlterField(
            model_name='protocol',
            name='WebSite',
            field=models.CharField(blank=True, help_text='API root page', max_length=50, unique=True),
        ),
    ]


# --- App: supplier.migrations - File: 0003_alter_profileagency_hashkey_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-26 14:01

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0002_rename_offer_informationtype_information_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='profileagency',
            name='HashKey',
            field=models.CharField(blank=True, editable=False, help_text='Hash key to identity Agency', max_length=40),
        ),
        migrations.AlterField(
            model_name='profileagency',
            name='Registration',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
        migrations.AlterField(
            model_name='profilerepresentative',
            name='HashKey',
            field=models.CharField(blank=True, editable=False, help_text='Hash key to identity Representative', max_length=40),
        ),
        migrations.AlterField(
            model_name='profilerepresentative',
            name='Registration',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
    ]


# --- App: supplier.migrations - File: 0008_contract_contract_type.py ---

# Generated by Django 4.0.1 on 2022-12-26 19:12

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0007_remove_contractsection_deadlinesapayment_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='contract',
            name='contract_type',
            field=models.ForeignKey(blank=True, default='', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_type', to='supplier.contracttype'),
        ),
    ]


# --- App: supplier.migrations - File: 0013_servicetype_equipment.py ---

# Generated by Django 4.0.1 on 2023-01-19 23:16

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
        ('supplier', '0012_servicetype_contracta'),
    ]

    operations = [
        migrations.AddField(
            model_name='servicetype',
            name='Equipment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_Image', to='core.equipment'),
        ),
    ]


# --- App: supplier.migrations - File: 0004_protocol_registration.py ---

# Generated by Django 4.0.1 on 2022-12-26 16:34

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('supplier', '0003_alter_profileagency_hashkey_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='protocol',
            name='Registration',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
    ]


# --- App: drf_api_logger - File: tests.py ---

from django.test import TestCase

# Create your tests here.


# --- App: drf_api_logger - File: insert_log_into_database.py ---

from queue import Queue
import time
from django.conf import settings
from threading import Thread
from django.db.utils import OperationalError

from drf_api_logger.models import APILogsModel


class InsertLogIntoDatabase(Thread):

    def __init__(self):
        super().__init__()

        self.DRF_API_LOGGER_DEFAULT_DATABASE = 'default'
        if hasattr(settings, 'DRF_API_LOGGER_DEFAULT_DATABASE'):
            self.DRF_API_LOGGER_DEFAULT_DATABASE = settings.DRF_API_LOGGER_DEFAULT_DATABASE

        self.DRF_LOGGER_QUEUE_MAX_SIZE = 50  # Default queue size 50
        if hasattr(settings, 'DRF_LOGGER_QUEUE_MAX_SIZE'):
            self.DRF_LOGGER_QUEUE_MAX_SIZE = settings.DRF_LOGGER_QUEUE_MAX_SIZE

        if self.DRF_LOGGER_QUEUE_MAX_SIZE < 1:
            raise Exception("""
            DRF API LOGGER EXCEPTION
            Value of DRF_LOGGER_QUEUE_MAX_SIZE must be greater than 0
            """)

        self.DRF_LOGGER_INTERVAL = 10  # Default DB insertion interval is 10 seconds.
        if hasattr(settings, 'DRF_LOGGER_INTERVAL'):
            self.DRF_LOGGER_INTERVAL = settings.DRF_LOGGER_INTERVAL

            if self.DRF_LOGGER_INTERVAL < 1:
                raise Exception("""
                DRF API LOGGER EXCEPTION
                Value of DRF_LOGGER_INTERVAL must be greater than 0
                """)

        self._queue = Queue(maxsize=self.DRF_LOGGER_QUEUE_MAX_SIZE)

    def run(self) -> None:
        self.start_queue_process()

    def put_log_data(self, data):
        self._queue.put(APILogsModel(**data))

        if self._queue.qsize() >= self.DRF_LOGGER_QUEUE_MAX_SIZE:
            self._start_bulk_insertion()

    def start_queue_process(self):
        while True:
            time.sleep(self.DRF_LOGGER_INTERVAL)
            self._start_bulk_insertion()

    def _start_bulk_insertion(self):
        bulk_item = []
        while not self._queue.empty():
            bulk_item.append(self._queue.get())
        if bulk_item:
            self._insert_into_data_base(bulk_item)

    def _insert_into_data_base(self, bulk_item):
        try:
            APILogsModel.objects.using(self.DRF_API_LOGGER_DEFAULT_DATABASE).bulk_create(bulk_item)
        except OperationalError:
            raise Exception("""
            DRF API LOGGER EXCEPTION
            Model does not exists.
            Did you forget to migrate?
            """)
        except Exception as e:
            print('DRF API LOGGER EXCEPTION:', e)


# --- App: drf_api_logger - File: events.py ---

class EventsException(Exception):
    pass


class Events:
    """
    Encapsulates the core to event subscription and event firing, and feels
    like a "natural" part of the language.
    The class Events is there mainly for 3 reasons:
        - Events (Slots) are added automatically, so there is no need to
        declare/create them separately. This is great for prototyping. (Note
        that `__events__` is optional and should primarily help detect
        misspelled event names.)
        - To provide (and encapsulate) some level of introspection.
        - To "steel the name" and hereby remove unneeded redundancy in a call
        like:
            xxx.OnChange = event('OnChange')
    """

    def __init__(self, events=None):

        if events is not None:

            try:
                iter(events)
            except:
                raise AttributeError("type object %s is not iterable" %
                                     (type(events)))
            else:
                self.__events__ = events

    def __getattr__(self, name):
        if name.startswith('__'):
            raise AttributeError("type object '%s' has no attribute '%s'" %
                                 (self.__class__.__name__, name))

        if hasattr(self, '__events__'):
            if name not in self.__events__:
                raise EventsException("Event '%s' is not declared" % name)

        elif hasattr(self.__class__, '__events__'):
            if name not in self.__class__.__events__:
                raise EventsException("Event '%s' is not declared" % name)

        self.__dict__[name] = ev = _EventSlot(name)
        return ev

    def __repr__(self):
        return '<%s.%s object at %s>' % (self.__class__.__module__,
                                         self.__class__.__name__,
                                         hex(id(self)))

    __str__ = __repr__

    def __len__(self):
        return len(self.__dict__.items())

    def __iter__(self):
        def gen(dictitems=self.__dict__.items()):
            for attr, val in dictitems:
                if isinstance(val, _EventSlot):
                    yield val

        return gen()


class _EventSlot:
    def __init__(self, name):
        self.targets = []
        self.__name__ = name

    def __repr__(self):
        return "event '%s'" % self.__name__

    def __call__(self, *a, **kw):
        for f in tuple(self.targets):
            f(*a, **kw)

    def __iadd__(self, f):
        self.targets.append(f)
        return self

    def __isub__(self, f):
        while f in self.targets:
            self.targets.remove(f)
        return self

    def __len__(self):
        return len(self.targets)

    def __iter__(self):
        def gen():
            for target in self.targets:
                yield target

        return gen()

    def __getitem__(self, key):
        return self.targets[key]


# --- App: drf_api_logger - File: start_logger_when_server_starts.py ---

from drf_api_logger.utils import database_log_enabled

LOGGER_THREAD = None

if database_log_enabled():
    from drf_api_logger.insert_log_into_database import InsertLogIntoDatabase
    import threading

    LOG_THREAD_NAME = 'insert_log_into_database'

    already_exists = False

    for t in threading.enumerate():
        if t.name == LOG_THREAD_NAME:
            already_exists = True
            break

    if not already_exists:
        t = InsertLogIntoDatabase()
        t.daemon = True
        t.name = LOG_THREAD_NAME
        t.start()
        LOGGER_THREAD = t

# --- App: drf_api_logger - File: models.py ---

from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

from drf_api_logger.utils import database_log_enabled


if database_log_enabled():
    """
    Load models only if DRF_API_LOGGER_DATABASE is True
    """
    class BaseModel(models.Model):
        id = models.BigAutoField(primary_key=True)

        added_on = models.DateTimeField()

        def __str__(self):
            return str(self.id)

        class Meta:
            abstract = True
            ordering = ('-added_on',)


    class APILogsModel(BaseModel):
        user = models.ForeignKey(User, on_delete=models.CASCADE)
        api = models.CharField(max_length=1024, help_text='API URL')
        headers = models.TextField()
        body = models.TextField()
        method = models.CharField(max_length=10, db_index=True)
        client_ip_address = models.CharField(max_length=50)
        response = models.TextField()
        status_code = models.PositiveSmallIntegerField(help_text='Response status code', db_index=True)
        execution_time = models.DecimalField(decimal_places=5, max_digits=8,
                                             help_text='Server execution time (Not complete response time.)')

        def __str__(self):
            return self.api

        class Meta:
            db_table = 'drf_api_logs'
            verbose_name = 'API Log'
            verbose_name_plural = 'API Logs'


# --- App: drf_api_logger - File: __init__.py ---

import os
from drf_api_logger.events import Events

if os.environ.get('RUN_MAIN', None) != 'true':
    default_app_config = 'drf_api_logger.apps.LoggerConfig'

API_LOGGER_SIGNAL = Events()

# --- App: drf_api_logger - File: utils.py ---

import re
from django.conf import settings

SENSITIVE_KEYS = ['password', 'token', 'access', 'refresh']
if hasattr(settings, 'DRF_API_LOGGER_EXCLUDE_KEYS'):
    if type(settings.DRF_API_LOGGER_EXCLUDE_KEYS) in (list, tuple):
        SENSITIVE_KEYS.extend(settings.DRF_API_LOGGER_EXCLUDE_KEYS)


def get_headers(request=None):
    """
        Function:       get_headers(self, request)
        Description:    To get all the headers from request
    """
    regex = re.compile('^HTTP_')
    return dict((regex.sub('', header), value) for (header, value)
                in request.META.items() if header.startswith('HTTP_'))


def get_client_ip(request):
    try:
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip
    except:
        return ''


def is_api_logger_enabled():
    drf_api_logger_database = False
    if hasattr(settings, 'DRF_API_LOGGER_DATABASE'):
        drf_api_logger_database = settings.DRF_API_LOGGER_DATABASE

    drf_api_logger_signal = False
    if hasattr(settings, 'DRF_API_LOGGER_SIGNAL'):
        drf_api_logger_signal = settings.DRF_API_LOGGER_SIGNAL
    return drf_api_logger_database or drf_api_logger_signal


def database_log_enabled():
    drf_api_logger_database = False
    if hasattr(settings, 'DRF_API_LOGGER_DATABASE'):
        drf_api_logger_database = settings.DRF_API_LOGGER_DATABASE
    return drf_api_logger_database


def mask_sensitive_data(data):
    """
    Hides sensitive keys specified in sensitive_keys settings.
    Loops recursively over nested dictionaries.
    """

    if type(data) != dict:
        return data

    for key, value in data.items():
        if key in SENSITIVE_KEYS:
            data[key] = "***FILTERED***"

        if type(value) == dict:
            data[key] = mask_sensitive_data(data[key])

        if type(value) == list:
            data[key] = [mask_sensitive_data(item) for item in data[key]]

    return data

# --- App: drf_api_logger - File: admin.py ---

from datetime import timedelta

from django.conf import settings
from django.contrib import admin
from django.db.models import Count
from django.http import HttpResponse

from drf_api_logger.utils import database_log_enabled

if database_log_enabled():
    from drf_api_logger.models import APILogsModel
    from django.utils.translation import gettext_lazy as _
    import csv

    class ExportCsvMixin:
        def export_as_csv(self, request, queryset):
            meta = self.model._meta
            field_names = [field.name for field in meta.fields]

            response = HttpResponse(content_type='text/csv')
            response['Content-Disposition'] = 'attachment; filename={}.csv'.format(meta)
            writer = csv.writer(response)

            writer.writerow(field_names)
            for obj in queryset:
                row = writer.writerow([getattr(obj, field) for field in field_names])

            return response

        export_as_csv.short_description = "Export Selected"

    class SlowAPIsFilter(admin.SimpleListFilter):
        title = _('API Performance')

        # Parameter for the filter that will be used in the URL query.
        parameter_name = 'api_performance'

        def __init__(self, request, params, model, model_admin):
            super().__init__(request, params, model, model_admin)
            if hasattr(settings, 'DRF_API_LOGGER_SLOW_API_ABOVE'):
                if type(settings.DRF_API_LOGGER_SLOW_API_ABOVE) == int:  # Making sure for integer value.
                    self._DRF_API_LOGGER_SLOW_API_ABOVE = settings.DRF_API_LOGGER_SLOW_API_ABOVE / 1000  # Converting to seconds.

        def lookups(self, request, model_admin):
            """
            Returns a list of tuples. The first element in each
            tuple is the coded value for the option that will
            appear in the URL query. The second element is the
            human-readable name for the option that will appear
            in the right sidebar.
            """
            slow = 'Slow'
            fast = 'Fast'
            if hasattr(settings, 'DRF_API_LOGGER_SLOW_API_ABOVE'):
                slow += ', >={}ms'.format(settings.DRF_API_LOGGER_SLOW_API_ABOVE)
                fast += ', <{}ms'.format(settings.DRF_API_LOGGER_SLOW_API_ABOVE)

            return (
                ('slow', _(slow)),
                ('fast', _(fast)),
            )

        def queryset(self, request, queryset):
            """
            Returns the filtered queryset based on the value
            provided in the query string and retrievable via
            `self.value()`.
            """
            # to decide how to filter the queryset.
            if self.value() == 'slow':
                return queryset.filter(execution_time__gte=self._DRF_API_LOGGER_SLOW_API_ABOVE)
            if self.value() == 'fast':
                return queryset.filter(execution_time__lt=self._DRF_API_LOGGER_SLOW_API_ABOVE)

            return queryset

    class APILogsAdmin(admin.ModelAdmin, ExportCsvMixin):

        actions = ["export_as_csv"]

        def __init__(self, model, admin_site):
            super().__init__(model, admin_site)
            self._DRF_API_LOGGER_TIMEDELTA = 0
            if hasattr(settings, 'DRF_API_LOGGER_SLOW_API_ABOVE'):
                if type(settings.DRF_API_LOGGER_SLOW_API_ABOVE) == int:  # Making sure for integer value.
                    self.list_filter += (SlowAPIsFilter,)
            if hasattr(settings, 'DRF_API_LOGGER_TIMEDELTA'):
                if type(settings.DRF_API_LOGGER_TIMEDELTA) == int:  # Making sure for integer value.
                    self._DRF_API_LOGGER_TIMEDELTA = settings.DRF_API_LOGGER_TIMEDELTA

        def added_on_time(self, obj):
            return (obj.added_on + timedelta(minutes=self._DRF_API_LOGGER_TIMEDELTA)).strftime("%d %b %Y %H:%M:%S")

        added_on_time.admin_order_field = 'added_on'
        added_on_time.short_description = 'Added on'

        list_per_page = 20
        list_display = ('id', 'user','api', 'method', 'status_code', 'execution_time', 'added_on_time',)
        list_filter = ('added_on', 'status_code', 'method',)
        search_fields = ('body', 'response', 'headers', 'api',)
        readonly_fields = (
            'execution_time', 'client_ip_address', 'api',
            'headers', 'body', 'method', 'response', 'status_code', 'added_on_time',
        )
        exclude = ('added_on',)

        change_list_template = 'charts_change_list.html'
        change_form_template = 'change_form.html'
        date_hierarchy = 'added_on'

        def changelist_view(self, request, extra_context=None):
            response = super(APILogsAdmin, self).changelist_view(request, extra_context)
            try:
                filtered_query_set = response.context_data["cl"].queryset
            except:
                return response
            analytics_model = filtered_query_set.values('added_on__date').annotate(total=Count('id')).order_by('total')
            status_code_count_mode = filtered_query_set.values('id').values('status_code').annotate(
                total=Count('id')).order_by('status_code')
            status_code_count_keys = list()
            status_code_count_values = list()
            for item in status_code_count_mode:
                status_code_count_keys.append(item.get('status_code'))
                status_code_count_values.append(item.get('total'))
            extra_context = dict(
                analytics=analytics_model,
                status_code_count_keys=status_code_count_keys,
                status_code_count_values=status_code_count_values
            )
            response.context_data.update(extra_context)
            return response

        def get_queryset(self, request):
            drf_api_logger_default_database = 'default'
            if hasattr(settings, 'DRF_API_LOGGER_DEFAULT_DATABASE'):
                drf_api_logger_default_database = settings.DRF_API_LOGGER_DEFAULT_DATABASE
            return super(APILogsAdmin, self).get_queryset(request).using(drf_api_logger_default_database)

        def changeform_view(self, request, object_id=None, form_url='', extra_context=None):
            if request.GET.get('export', False):
                drf_api_logger_default_database = 'default'
                if hasattr(settings, 'DRF_API_LOGGER_DEFAULT_DATABASE'):
                    drf_api_logger_default_database = settings.DRF_API_LOGGER_DEFAULT_DATABASE
                export_queryset = self.get_queryset(request).filter(pk=object_id).using(drf_api_logger_default_database)
                return self.export_as_csv(request, export_queryset)
            return super(APILogsAdmin, self).changeform_view(request, object_id, form_url, extra_context)

        def has_add_permission(self, request, obj=None):
            return False

        def has_change_permission(self, request, obj=None):
            return False


    admin.site.register(APILogsModel, APILogsAdmin)


# --- App: drf_api_logger - File: apps.py ---

from django.apps import AppConfig


class LoggerConfig(AppConfig):
    name = 'drf_api_logger'
    verbose_name = 'DRF API Logger'


# --- App: drf_api_logger - File: collectstatic.py ---

from django.core.management import call_command

from boot_django import boot_django

# call the django setup routine
boot_django()

call_command("collectstatic")


# --- App: drf_api_logger.middleware - File: api_logger_middleware.py ---

import json
import time
from django.conf import settings
from django.urls import resolve
from django.utils import timezone

from drf_api_logger import API_LOGGER_SIGNAL
from drf_api_logger.start_logger_when_server_starts import LOGGER_THREAD
from drf_api_logger.utils import get_headers, get_client_ip, mask_sensitive_data

"""
File: api_logger_middleware.py
Class: APILoggerMiddleware
"""


class APILoggerMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
        # One-time configuration and initialization.

        self.DRF_API_LOGGER_DATABASE = False
        if hasattr(settings, 'DRF_API_LOGGER_DATABASE'):
            self.DRF_API_LOGGER_DATABASE = settings.DRF_API_LOGGER_DATABASE

        self.DRF_API_LOGGER_SIGNAL = False
        if hasattr(settings, 'DRF_API_LOGGER_SIGNAL'):
            self.DRF_API_LOGGER_SIGNAL = settings.DRF_API_LOGGER_SIGNAL

        self.DRF_API_LOGGER_PATH_TYPE = 'ABSOLUTE'
        if hasattr(settings, 'DRF_API_LOGGER_PATH_TYPE'):
            if settings.DRF_API_LOGGER_PATH_TYPE in ['ABSOLUTE', 'RAW_URI', 'FULL_PATH']:
                self.DRF_API_LOGGER_PATH_TYPE = settings.DRF_API_LOGGER_PATH_TYPE

        self.DRF_API_LOGGER_SKIP_URL_NAME = []
        if hasattr(settings, 'DRF_API_LOGGER_SKIP_URL_NAME'):
            if type(settings.DRF_API_LOGGER_SKIP_URL_NAME) is tuple or type(
                    settings.DRF_API_LOGGER_SKIP_URL_NAME) is list:
                self.DRF_API_LOGGER_SKIP_URL_NAME = settings.DRF_API_LOGGER_SKIP_URL_NAME

        self.DRF_API_LOGGER_SKIP_NAMESPACE = []
        if hasattr(settings, 'DRF_API_LOGGER_SKIP_NAMESPACE'):
            if type(settings.DRF_API_LOGGER_SKIP_NAMESPACE) is tuple or type(
                    settings.DRF_API_LOGGER_SKIP_NAMESPACE) is list:
                self.DRF_API_LOGGER_SKIP_NAMESPACE = settings.DRF_API_LOGGER_SKIP_NAMESPACE

        self.DRF_API_LOGGER_METHODS = []
        if hasattr(settings, 'DRF_API_LOGGER_METHODS'):
            if type(settings.DRF_API_LOGGER_METHODS) is tuple or type(
                    settings.DRF_API_LOGGER_METHODS) is list:
                self.DRF_API_LOGGER_METHODS = settings.DRF_API_LOGGER_METHODS

        self.DRF_API_LOGGER_STATUS_CODES = []
        if hasattr(settings, 'DRF_API_LOGGER_STATUS_CODES'):
            if type(settings.DRF_API_LOGGER_STATUS_CODES) is tuple or type(
                    settings.DRF_API_LOGGER_STATUS_CODES) is list:
                self.DRF_API_LOGGER_STATUS_CODES = settings.DRF_API_LOGGER_STATUS_CODES

    def __call__(self, request):

        # Run only if logger is enabled.
        if self.DRF_API_LOGGER_DATABASE or self.DRF_API_LOGGER_SIGNAL:

            url_name = resolve(request.path_info).url_name
            namespace = resolve(request.path_info).namespace

            # Always skip Admin panel
            if namespace == 'admin':
                return self.get_response(request)

            # Skip for url name
            if url_name in self.DRF_API_LOGGER_SKIP_URL_NAME:
                return self.get_response(request)

            # Skip entire app using namespace
            if namespace in self.DRF_API_LOGGER_SKIP_NAMESPACE:
                return self.get_response(request)

            start_time = time.time()
            request_data = ''
            try:
                request_data = json.loads(request.body) if request.body else ''
            except:
                pass

            # Code to be executed for each request before
            # the view (and later middleware) are called.
            response = self.get_response(request)

            # Only log required status codes if matching
            if self.DRF_API_LOGGER_STATUS_CODES and response.status_code not in self.DRF_API_LOGGER_STATUS_CODES:
                return response

            # Code to be executed for each request/response after
            # the view is called.

            headers = get_headers(request=request)
            method = request.method

            # Log only registered methods if available.
            if len(self.DRF_API_LOGGER_METHODS) > 0 and method not in self.DRF_API_LOGGER_METHODS:
                return response

            if response.get('content-type') in ('application/json', 'application/vnd.api+json',):
                if getattr(response, 'streaming', False):
                    response_body = '** Streaming **'
                else:
                    if type(response.content) == bytes:
                        response_body = json.loads(response.content.decode())
                    else:
                        response_body = json.loads(response.content)
                if self.DRF_API_LOGGER_PATH_TYPE == 'ABSOLUTE':
                    api = request.build_absolute_uri()
                elif self.DRF_API_LOGGER_PATH_TYPE == 'FULL_PATH':
                    api = request.get_full_path()
                elif self.DRF_API_LOGGER_PATH_TYPE == 'RAW_URI':
                    api = request.get_raw_uri()
                else:
                    api = request.build_absolute_uri()

                data = dict(
                    api=api,
                    user = request.user,
                    headers=mask_sensitive_data(headers),
                    body=mask_sensitive_data(request_data),
                    method=method,
                    client_ip_address=get_client_ip(request),
                    response=mask_sensitive_data(response_body),
                    status_code=response.status_code,
                    execution_time=time.time() - start_time,
                    added_on=timezone.now()
                )
                if self.DRF_API_LOGGER_DATABASE:
                    if LOGGER_THREAD:
                        d = data.copy()
                        d['headers'] = json.dumps(d['headers'], indent=4, ensure_ascii=False)
                        if request_data:
                            d['body'] = json.dumps(d['body'], indent=4, ensure_ascii=False)
                        d['response'] = json.dumps(d['response'], indent=4, ensure_ascii=False)
                        LOGGER_THREAD.put_log_data(data=d)
                if self.DRF_API_LOGGER_SIGNAL:
                    API_LOGGER_SIGNAL.listen(**data)
            else:
                return response
        else:
            response = self.get_response(request)
        return response


# --- App: drf_api_logger.middleware - File: __init__.py ---



# --- App: drf_api_logger.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-20 22:47

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='APILogsModel',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('added_on', models.DateTimeField()),
                ('api', models.CharField(help_text='API URL', max_length=1024)),
                ('headers', models.TextField()),
                ('body', models.TextField()),
                ('method', models.CharField(db_index=True, max_length=10)),
                ('client_ip_address', models.CharField(max_length=50)),
                ('response', models.TextField()),
                ('status_code', models.PositiveSmallIntegerField(db_index=True, help_text='Response status code')),
                ('execution_time', models.DecimalField(decimal_places=5, help_text='Server execution time (Not complete response time.)', max_digits=8)),
            ],
            options={
                'verbose_name': 'API Log',
                'verbose_name_plural': 'API Logs',
                'db_table': 'drf_api_logs',
            },
        ),
    ]


# --- App: drf_api_logger.migrations - File: 0002_apilogsmodel_user.py ---

# Generated by Django 4.0.1 on 2022-12-20 22:52

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('drf_api_logger', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='apilogsmodel',
            name='user',
            field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: drf_api_logger.migrations - File: __init__.py ---



# --- App: drf_api_logger.migrations - File: 0003_alter_apilogsmodel_user.py ---

# Generated by Django 4.0.1 on 2022-12-20 22:53

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('drf_api_logger', '0002_apilogsmodel_user'),
    ]

    operations = [
        migrations.AlterField(
            model_name='apilogsmodel',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: partner - File: tests.py ---

"""
Partner App Tests - Suroga API

This module contains automated tests for the 'partner' application within the Suroga API. It aims to validate
the behavior of the partner models, views, forms, and other related functionalities. The tests ensure that
critical workflows such as partner registration, profile updates, and authentication processes perform
as expected and conform to the specified business rules.

Usage:
    Tests should be run regularly as part of the development process to identify and resolve regressions or bugs.
    They can be executed using the Django test runner with the following command:
    `python manage.py test partner`

Features:
    - Includes test cases for creating, retrieving, updating, and deleting partner profiles.
    - Covers authentication tests to ensure secure access to partner-related endpoints.
    - Utilizes Django's TestCase and REST framework's APITestCase for comprehensive test coverage.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024
"""
from django.urls import reverse
from django.contrib.auth.models import User
from rest_framework import status
from rest_framework.test import APITestCase, APIClient
from partner.models import PartnerProfile  # Adjust import based on your model name

class PartnerTests(APITestCase):
    def setUp(self):
        # Set up the test client and other test variables
        self.client = APIClient()
        self.user = User.objects.create_user('testuser', 'test@example.com', 'password')
        self.partner_profile = PartnerProfile.objects.create(user=self.user, name='Test Partner')

    def test_partner_profile_creation(self):
        # Test to verify that a profile can be created
        self.assertEqual(self.partner_profile.name, 'Test Partner')

    def test_view_partner_profile(self):
        # Test to verify partner profile view
        url = reverse('partner:partner-detail', kwargs={'pk': self.partner_profile.pk})
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        
        # Here you can add more tests e.g. update, delete


# --- App: partner - File: urls.py ---

"""
Partner Application URL Configuration - Suroga API

This module outlines the URL patterns for the Partner application, responsible for facilitating
web requests to appropriate views related to partner management and operations within the Suroga API.

By defining these patterns, the application can serve different web pages and API endpoints,
effectively mapping URL routes to the functions that handle requests for those routes.

Usage:
    - Include these URL patterns in the project's main `urls.py` file using Django's `include()` function.
    - Use the `name` parameter to reverse these URLs in templates and views for consistent URL referencing.

Patterns:
    - Authentication views are provided by Django's built-in auth views with additional customization.
    - Sign-up, login, profile management, and other functionalities relevant to partner management are routed here.
    - Custom views for specific partner interactions are defined with clear, actionable names.

References:
    - Django URL dispatcher: https://docs.djangoproject.com/en/4.0/topics/http/urls/
    - Django Authentication Views: https://docs.djangoproject.com/en/4.0/topics/auth/default/#module-django.contrib.auth.views

Ensure that all views are properly imported and available for creating URL patterns, and that the
named URL patterns match those used in the rest of the application for consistency.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024
"""
from django.contrib import admin
from django.urls import path, include
from django.urls import re_path as url
from django.contrib.auth import views as auth_views
from rest_framework import routers, serializers, viewsets
from rest_framework.schemas import get_schema_view

from core import views as coreviews
from partner import forms as partnerforms
from partner import views as partnerviews

app_name = 'partner'

urlpatterns = [
    # Change password view for a partner
    url(r'^password/$', partnerviews.change_password, name='password_change'),
    
    # Logout view which redirects to the home page after logging out
    url(r'^logout/$',auth_views.LogoutView.as_view(next_page = '/'), name='logout'),
    
    # Signup view for new clients
    url(r'^signup/$',partnerviews.ClientSignUp.as_view(), name='client_signup'),
    
    # Login view with a custom authentication form and a language code in the context
    url(r'^login/$', auth_views.LoginView.as_view(template_name = 'partner/clientlogin.html',
        authentication_form = partnerforms.CustomAuthenticationForm, extra_context = {'code':'en'}), name='login'),
    
    # Confirm login attempt view
    url(r'^confirmLogin/$', partnerviews.confirmLogin, name='confirmLogin'),
    
    # Profile update view for a client with a specific primary key (pk)
    path('clientProfile/<int:pk>/', partnerviews.clientProfile.as_view(), name='profile-update'),  
    
    # View for updating, adding, and deleting contacts
    path('contactUpdate/<int:pk>/',partnerviews.ContactUpdate.as_view(), name='contact-update'),
    path('contactAdd/',partnerviews.ContactsAdd.as_view(), name='contact-add'),
    path('contactDelete/<int:pk>/', partnerviews.ContactsDelete.as_view(), name='contact-delete'),
    
    # View for updating, adding, and deleting location information
    path('localUpdate/<int:pk>/',partnerviews.LocalUpdate.as_view(), name='local-update'),
    path('localAdd/',partnerviews.LocalAdd.as_view(), name='local-add'),
    path('localDelete/<int:pk>/', partnerviews.LocalDelete.as_view(), name='local-delete'),
    
    # Confirm view for account confirmation operations
    url(r'^confirm/$', partnerviews.confirm, name='confirm'),
    
    # Search and view transactions, requests, and login data within a given date range
    path('searchTransactions/<str:start>/<str:end>/', partnerviews.searchTransaction, name='searchTransaction'),
    path('searchRequests/<str:start>/<str:end>/', partnerviews.searchRequests, name='searchRequests'),
    path('searchLogin/<str:start>/<str:end>/', partnerviews.searchLogin, name='searchLogin'),
    path('viewTransation/<int:pk>/', partnerviews.viewTransation, name='viewTransation'),
    path('viewRequest/<int:pk>/', partnerviews.viewRequest, name='viewRequest'),
    path('viewLogin/<int:pk>/', partnerviews.viewLogin, name='viewLogin'),
    
    # The main dashboard view for clients
    path('',partnerviews.ClientDashboard, name='client_dashboard'),
]

# --- App: partner - File: models.py ---

"""
Partner App Models - Suroga API

This module defines the models for the 'partner' application within the Suroga API.
These models represent the various entities associated with partners, such as partner profiles, 
points of contact (POCs), and geographical coverage areas. The models encapsulate information concerning 
the partner's contact details, verification status for various attributes, and app related information,
as well as providing relationships to other aspects of the Suroga API like user accounts and services.

Usage: 
    - Defining the data structure for partner-related information stored in the database.
    - Use these models to interact with the database through Django's ORM in views, serializers, and other components.

Best Practices:
    - Keep model fields with clear and concise naming conventions.
    - Write detailed and comprehensive help_text for each model field for better clarity when used within the Django admin interface.
    - Maintain proper indexing and database optimization techniques for larger datasets.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
import datetime
import hashlib

from django.db import models, IntegrityError
from django.utils import timezone
from django.http import HttpResponse

from django.contrib.auth import get_user_model
User = get_user_model()

from core.models import country, Language
from rides.models import ServiceCategory


class profilepartner(models.Model):
    """
    Model representing a partner's profile in the partner app.

    Attributes:
        user: Reference to the user associated with the partner profile.
        Name: The full name of the partner.
        Address: Physical address of the partner.
        Zip_Code: Postal code of the partner's location.
        City: The city where the partner is located.
        Country: Reference to the country where the partner's business operations are based.
        Address_verified: Boolean field indicating whether the partner's address is verified.
        Language: The preferred language of communication for the partner.
        Telephone: Contact telephone number for the partner.
        Telephone_verified: Boolean indicating whether the partner's phone number is verified.
        ITIN: The Individual Tax Identification Number for the partner.
        ITIN_verified: Status of verification of the ITIN.
        IBAN: International Bank Account Number of the partner.
        IBAN_verified: Status of verification of the IBAN.
        HashKey: A unique hash to identify the partner.
        Registration: The timestamp when the partner was registered.
        Website: Official website URL of the partner.
        Google_play: URL to the partner's app on Google Play.
        Google_play_verified: Verification status of the app on Google Play.
        Apple_store: URL to the partner's app on the Apple Store.
        Apple_store_verified: Verification status of the app on the Apple Store.
        Stripe_ID: Stripe identification number for payment processing.
        API_activated: Status indicating whether the partner's API access is activated.
        API_test_mode: Boolean indicating if the partner is in API test mode.
        API_integration_level: Text field indicating the level of integration of the partner's API.
        APP_description: A text field to describe the partner's app in JSON format.
        APP_domain: The domain associated with the partner's app.
        APP_domain_verified: Status indicating whether the app's domain is verified.
        webwooks_suroo: URL for Suroo webhooks.
        webwooks_suroo_verified: Verification status of Suroo webhooks.
        Payment_Policy: Text field for the partner's payment policy in JSON format.
        Observation: Text field for additional observations about the partner.
        NumberRegisteredRides: The number of rides the partner has registered.
        NumberBookedRides: The number of rides the partner has booked.
        NumberCancedRides: The number of rides the partner has canceled.
        NumberCompletedRides: The number of rides the partner has completed.
        Balance: The financial balance of the partner.
        Validated_profile: Boolean indicating whether the partner's profile has been validated.
    """
    # User profile
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, default=None, blank=True, related_name='partner_user')    
    
    Name = models.CharField(max_length=100, blank=True, help_text = "Partner Name") # Partner name
    Address = models.CharField(max_length=100, blank=True, help_text = "Address") # Partner address
    Zip_Code = models.CharField(max_length=100, blank=True, help_text = "Zip Code.") # Zip Code
    City = models.CharField(max_length=100, blank=True, help_text = "City") 
    Country = models.ForeignKey(country, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Country") 
    Address_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    Language = models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Language") 
    Telephone = models.CharField(max_length=100, blank=True, help_text = "Business telephone.") # The contact number 
    Telephone_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    ITIN = models.CharField(max_length=40, editable=True, blank=True, help_text = "Individual Tax Identification Number")    
    ITIN_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    IBAN = models.CharField(max_length=40, editable=True, blank=True, help_text = "Agency IBAN")     
    IBAN_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    HashKey = models.CharField(max_length=40, editable=True, blank=True, help_text = "Hash key to identity the partners agents")
    Registration = models.DateTimeField(default=timezone.now)  
    Website = models.URLField(default='',blank=True, help_text = "Partner Website. ")   
    Google_play = models.URLField(default='',blank=True, help_text = "APP in Google Play. ")   
    Google_play_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    Apple_store = models.URLField(default='',blank=True, help_text = "APP in Apple Store. ")   
    Apple_store_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    
    Stripe_ID = models.CharField(max_length=10, editable=True, blank=True, default='', help_text = "Partner ID")
    API_activated  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    API_test_mode  = models.BooleanField(default=True, help_text = "Test mode status TRUE=active/FALSE=inactive.") 
    API_integration_level  = models.CharField(max_length=10, editable=True, blank=True, default='', help_text = "API integration level.")
    APP_description  = models.TextField(max_length=1000, blank=True, help_text = "JSON APP description.")
    APP_domain = models.URLField(default='API calls',blank=True, help_text = "APP web domain")   
    APP_domain_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    webwooks_suroo = models.URLField(default='',blank=True, help_text = "Webwook suroo alerts")   
    webwooks_suroo_verified  = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.") 
    
    Payment_Policy  = models.TextField(max_length=1000, blank=True, help_text = "JSON payment policy.")
    Observation  = models.TextField(max_length=1000, blank=True, help_text = "Observation about client.")
    
    NumberRegisteredRides = models.IntegerField(default=0, help_text = "Number registered rides")
    NumberBookedRides = models.IntegerField(default=0, help_text = "Number booked rides")
    NumberCancedRides = models.IntegerField(default=0, help_text = "Number of canced rides")
    NumberCompletedRides = models.IntegerField(default=0, help_text = "Number of completed rides")
    Balance = models.DecimalField(max_digits=7, decimal_places=2,default=0, help_text = "Balance")
    
    Validated_profile = models.BooleanField(default=False, help_text = "API status TRUE=active/FALSE=inactive.")
    
    class Meta:
            verbose_name_plural = "Partners"
        
    def __str__(self):
        """
        Returns a human-readable string representation of the partner profile.
        """
        return self.Name

    def save(self,force_insert=False, force_update=False, using=None):
        """
        Overridden save method that ensures valid data is in place before saving
        and generates a unique HashKey if it isn't provided.
        """
        self.user.Language = self.Language # for for simplification...
        # Logic for generating HashKey and saving...
        if not self.HashKey:
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
        # Error handling for the save method...    
        try:
            return super(profilepartner, self).save()
        except IntegrityError:
            return HttpResponse("ERROR: this user can not be saved...")    


class jobpoc(models.Model):
    """
    Model representing categories of Points of Contact (POC) within the partner organization.

    Attributes:
        JobCategory: A categorical description of the POC's role within the partner organization.
    """
    JobCategory = models.CharField(max_length=50, unique=True, blank=False, help_text = "POC category")
     
    class Meta:
        verbose_name_plural = "Partners POC Categories"
    def __str__(self):
        """
        Returns a string representation of the POC category.
        """
        return self.JobCategory

class partnerpoc(models.Model):
    """
    Model representing a Point of Contact (POC) profile for a partner's agency.

    Attributes:
        user: A ForeignKey to a user model, which is nullable and associated with the 'partner_user' related name.
        Name: The full name of the partner's POC.
        Address: The address of the partner's POC.
        Zip_Code: The postal code related to the partner's POC address.
        City: The city where the partner's POC is located.
        Country: A ForeignKey to a country model, representing the country of the POC's location.
        email: The business email of the partner's POC.
        email_verified: A Boolean indicating if the POC's business email has been verified.
        Telephone: The business telephone number of the partner's POC.
        HashKey: A unique identifier hash key for the partner's POC.
        Registration: The date and time of registration for the partner's POC.
        Extra_record: A Text field containing extra JSON formatted records related to the POC.
        Observation: Text field for additional observations about the partner's POC.
        Category: A ForeignKey to the jobpoc model, which specifies the category of the POC.
        Language1: A ForeignKey to the Language model representing the POC's primary language.
        Language2: A ForeignKey to the Language model representing the POC's secondary language if any.
    """
    user = models.ForeignKey(User, on_delete=models.SET_NULL,  null=True, blank=True, related_name='POC_Agency')    
    
    Name = models.CharField(max_length=100, blank=True, help_text = "ARepresentativegency Name") # Representative name
    Address = models.CharField(max_length=100, blank=True, help_text = "Address") # Representative address
    Zip_Code = models.CharField(max_length=100, blank=True, help_text = "Zip Code.") # Zip Code
    Country = models.ForeignKey(country, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Country", related_name='POC_Country') 
    email = models.CharField(max_length=50, blank=True, help_text = "Business email.")
    email_verified  = models.BooleanField(default=False, help_text = "True if email was verified") 
    Telephone = models.CharField(max_length=15, blank=True, help_text = "Business telephone.") # The contact number  
    HashKey = models.CharField(max_length=40, editable=True, blank=True, help_text = "Hash key to identity Representative")
    Registration = models.DateTimeField(default=timezone.now)  
    Extra_record  = models.TextField(max_length=1000, blank=True, help_text = "JSON: extra records.")
    Observation  = models.TextField(max_length=1000, blank=True, help_text = "Observation about Representative.")
    Category = models.ForeignKey(jobpoc,on_delete=models.SET_NULL,  null=True, blank=True, related_name='POC_category')    
    Language1 = models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=True, help_text = "POC_Language 1", related_name='POC_Language1') 
    Language2 = models.ForeignKey(Language, on_delete=models.SET_NULL, null=True, blank=True, help_text = "POC Language 2", related_name='POC_Language2') 
    
    class Meta:
            verbose_name_plural = "Partner POCs"
        
    def __str__(self):
        """
        String for representing the Model object in the admin interface and anywhere else the model is referenced.
        """
        return self.Name

    def save(self,force_insert=False, force_update=False, using=None):
        """
        Overwrites the save method to perform custom actions such as generating a unique HashKey for new POC records.
        """
        if not self.HashKey:
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
            
        try:
            return super(partnerpoc, self).save()
        except IntegrityError:
            return HttpResponse("ERROR: this POC can not be saved...") 

class coverage(models.Model):
    """
    Model representing the geographic coverage area and service type for a partner's offerings.

    Attributes:
        user: A ForeignKey reference to the user model, indicating the user associated with the coverage.
        Country: The name of the country where the service coverage applies.
        DistrictRegion: The name of the district or region where the service coverage applies.
        CityMunicipality: The name of the city or municipality where the service coverage applies.
        ServiceCategory: A ForeignKey to the ServiceCategory model, specifying the type of services covered.
    """
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, default=None, blank=True, related_name='coverage_user')    
    
    Country = models.CharField(max_length=30, blank=True, help_text = "Country") 
    DistrictRegion = models.CharField(max_length=30, blank=True, help_text = "District/Region") 
    CityMunicipality = models.CharField(max_length=30, blank=True, help_text = "City/Municipality") 
    ServiceCategory = models.ForeignKey(ServiceCategory, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Service type") 
    
    class Meta:
            verbose_name_plural = "APP Coverage"



# --- App: partner - File: __init__.py ---



# --- App: partner - File: views.py ---

"""
Partner Views - Suroga API

This module defines view functions and view classes for the Partner application of the Suroga API.
It includes views to handle various actions like partner login, payment and API log searches, 
client registration, handling user profiles, adding, updating and deleting partner-related records.

The views are secured with login and API-specific permissions to ensure that only authenticated 
and authorized users can access and modify partner data. They handle both form submissions and 
rendering of templates, providing necessary responses to users based on their requests.

Usage:
    - The views should be imported and included in the app's `urls.py` file to be accessible via HTTP.
    - They should be used paired with appropriate templates and forms to provide a complete user experience.

Functions:
    - Confirm views for rendering confirmation templates post-actions (login, signup)
    - Search views for querying transaction logs, API logs and other user activities
    - `CreateView`, `UpdateView`, and `DeleteView` subclasses to handle CRUD operations through class-based views

Ensure that the views adhere to the business logic and application flow. Changes should be thoroughly 
tested before deployment to maintain application stability and integrity.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024
"""
from datetime import datetime, timedelta
import pytz

from django.shortcuts import render, redirect
from django.views.generic import DeleteView, CreateView, DetailView, UpdateView
from django.contrib.auth.decorators import login_required
from django.http import HttpResponse
from django.template.loader import render_to_string
from django.contrib.sites.shortcuts import get_current_site
from django.contrib.auth import get_user_model, login, update_session_auth_hash
from django.contrib.auth.forms import PasswordChangeForm
from django.http import Http404
from django.urls import reverse_lazy

from django.core.mail import send_mail
from django.core.mail import EmailMessage

from django.utils.decorators import method_decorator
from django.utils.translation import activate, gettext
from django.utils import timezone

User = get_user_model()

from core.decorators import api_client_required
from partner.models import profilepartner, partnerpoc,coverage,profilepartner
from rides.models import paymentlog
from core.models import events,userloginlog
from rest_framework.authtoken.models import Token
from .forms import profileForm, localForm, contactForm, SignUpForm
from drf_api_logger.models import APILogsModel

# Create your views here.

def price_format(value,country):
    """
    Format the given value based on the currency settings of the country.

    Args:
        value: A numerical amount of money.
        country: An object of type country containing currency settings.

    Returns:
        A string representing the formatted value with the currency symbol.
    """
    Currency = country.Currency
    Value = format(value, '.2f') 

    if Currency.SymbolRight:
        Value = Value + Currency.CurrencySymbol
    else:
        Value = Currency.CurrencySymbol + Value

    return Value

@login_required(login_url="login")
@api_client_required
def change_password(request):
    """
    Process a password change request for the user.
    
    Upon successful password change, updates the session to keep the user logged in.
    """
    if request.method == 'POST':
        form = PasswordChangeForm(request.user, request.POST)
        if form.is_valid():
            user = form.save()
            update_session_auth_hash(request, user)  # Important!

            ## Alert staff
            #m=MessageBoard(Sender = request.user, Code = 0, 
            #Text = "Password changed."
            #)
            #m.save()
            
            return HttpResponse(render_to_string('partner/confirm.html'))
        #else:
        #    messages.error(request, 'Please correct the error below.')
    else:

        form = PasswordChangeForm(request.user)

    return render(request, 'partner/password_change.html', {
        'form': form, 
    })


@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class clientProfile(UpdateView):
    """
    A class-based view handling profile updates for partner clients.

    Performs access control checks and returns the updated profile object upon success.
    """
    model = profilepartner
    form_class = profileForm
    template_name = 'partner/profile.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        """
        Extends the base implementation to include additional context such as user data and API token.
        """

        if self.object.user != self.request.user:
            raise Http404

        if self.object.API_activated:
            key = Token.objects.get(user=self.request.user)
        else:
            key = ''

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        context['user'] = self.object.user
        context['partner'] = self.object
        context['key'] = key
        context['pk'] = self.object.pk
        context['is_client'] = 1

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context
    
    def form_valid(self, form):
        """
        Logic executed when the submitted form data is valid.

        Updates the partner's profile with new data and redirects to the partner dashboard.
        """

        profile = form.save(commit=False)

        profile.save()


        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        
        return redirect('/partner/')

@login_required(login_url="login")
@api_client_required
def confirm(request):
    """
    View to display a confirmation page to the user.

    This view is decorated with 'login_required' to ensure that only
    authenticated users can access it, and 'api_client_required' to
    check for API client permissions.
    """
    return HttpResponse(render_to_string('partner/confirm.html'))

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class ContactsAdd(CreateView):
    """
    A view for adding new Point of Contact (POC) records to a partner's profile.

    'login_required' and 'api_client_required' enforce the need for authenticated users with proper API permissions.
    """
    model = partnerpoc
    form_class = contactForm
    template_name = 'partner/addcontact.html'
    success_url = '/'

    def get_context_data(self, **kwargs):

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        
        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context
    
    def form_valid(self, form):
        """
        Logic to execute when the contact form is valid.

        Sets the user associated with the contact and saves the contact instance.
        Then redirects to the confirmation page.
        """

        contact = form.save(commit=False)
        contact.user = self.request.user

        # Saving contact and redirecting to the confirmation page.
        contact.save()


        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        return redirect('/partner/confirm')

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class ContactsDelete(DeleteView):
    """
    View for deleting a Point of Contact (POC) associated with a partner's profile.
    
    Enforces access constraints to ensure that only the owner can delete the POC.
    """
    model = partnerpoc
    template_name = 'partner/deletecontact.html'
    success_url = '/'

    def get_context_data(self, **kwargs):

        # Ensure the user requesting deletion is the owner of the POC.
        if self.object.user != self.request.user:
            raise Http404

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        context['pk'] = self.object.pk

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class ContactUpdate(UpdateView):
    """
    View for updating an existing Point of Contact (POC) for a partner's profile.

    Enforces access controls and facilitates updates to POC information with validation.
    """
    model = partnerpoc
    form_class = contactForm
    template_name = 'partner/updatecontact.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        # Ensure that the user attempting to update is the owner of the POC.
        if self.object.user != self.request.user:
            raise Http404

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        context['pk'] = self.object.pk

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context
    
    def form_valid(self, form):
        """
        Executes logic when the form to update a partner's contact is valid.

        Saves the updated POC data and returns a confirmation response.
        """

        contact = form.save(commit=False)

        # Updating contact and rendering confirmation page.
        contact.save()


        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        
        return HttpResponse(render_to_string('partner/confirm.html'))

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class LocalAdd(CreateView):
    """
    A class-based view to handle the addition of new local coverage areas for partners.

    Requires user authentication and specific API client permissions to proceed with the addition of coverage areas.
    """
    model = coverage
    form_class = localForm
    template_name = 'partner/addlocal.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        """
        Provides additional context data to the local coverage addition template.
        """
        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        
        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context
    
    def form_valid(self, form):
        """
        Handles the processing of valid forms for adding new local coverage areas.
        """
        local = form.save(commit=False)

        # Set the current user on new local area, ensure all necessary information is saved, handle language preference...
        local.user = self.request.user

        local.save()


        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        return redirect('/partner/confirm')

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class LocalDelete(DeleteView):
    """
    A class-based view for partners to delete local coverage areas.

    Partners should only be able to delete their own coverage areas.
    """
    model = coverage
    template_name = 'partner/deletelocal.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        """
        Extends basic context data with additional checks and information like user type.
        """

        # Prevent deletion if the coverage area is not owned by current user...
        if self.object.user != self.request.user:
            raise Http404

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        context['pk'] = self.object.pk

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context

@method_decorator([login_required(login_url="login"), api_client_required], name='dispatch') 
class LocalUpdate(UpdateView):
    """
    Class-based view to handle updates to existing local coverage areas for partners.

    Verification ensures that only the owner partner is able to update their coverage area details.
    """
    model = coverage
    form_class = localForm
    template_name = 'partner/updatelocal.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        """
        Augments the context for the update coverage template with user-specific data.
        """


        # Check if the coverage area belongs to the current user before allowing an update...
        if self.object.user != self.request.user:
            raise Http404

        context = super().get_context_data(**kwargs)
        context['user_type'] = 'client'
        context['pk'] = self.object.pk

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #context['code'] = code
        return context
    
    def form_valid(self, form):
        """
        Logic executed after the form for updating local coverage is validated.
        """
        local = form.save(commit=False)

        local.save()


        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        
        return HttpResponse(render_to_string('partner/confirm.html'))


@login_required(login_url="login")
@api_client_required
def viewTransation(request, *args, **kwargs):
    """
    View a detailed page for a single payment transaction.

    Args:
        request: The HTTP request object.
        pk: The primary key of the payment transaction to view.

    Returns:
        An HttpResponse with the rendered transaction detail template.
    """
    pk = int(kwargs['pk'])

    item = paymentlog.objects.get(pk=pk)

    # Ensure the requesting user is the one associated with the payment log entry
    if item.user != request.user:
        raise Http404

    # Render the transaction detail page and return the response.
    data ={
        'item':item,
        }
    return HttpResponse(render_to_string('partner/viewTransation.html',data))

@login_required(login_url="login")
@api_client_required
def viewLogin(request, *args, **kwargs):
    """
    View a detailed page for a single login log entry.

    Args:
        request: The HTTP request object.
        pk: The primary key of the login log entry to view.

    Returns:
        An HttpResponse with the rendered login log detail template.
    """
    pk = int(kwargs['pk'])

    item = userloginlog.objects.get(pk=pk)
    
    # Verify that the login log entry belongs to the requesting user.
    if item.user != request.user:
        raise Http404

    data ={
        'item':item,
        }
    return HttpResponse(render_to_string('partner/viewLogin.html',data))

@login_required(login_url="login")
@api_client_required
def viewRequest(request, *args, **kwargs):
    """
    Display a detailed page for a single API request log entry.

    Args:
        request: The HTTP request object.
        pk: The primary key of the API request log entry to view.

    Returns:
        An HttpResponse with the rendered request log detail template.
    """
    pk = int(kwargs['pk'])

    item = APILogsModel.objects.get(pk=pk)

    # Ensure the request log entry is associated with the current user.
    if item.user != request.user:
        raise Http404

    data ={
        'item':item,
        }
    return HttpResponse(render_to_string('partner/viewRequest.html',data))


@login_required(login_url="login")
@api_client_required
def searchTransaction(request, *args, **kwargs):
    """
    Search and display a list of payment transactions within a specified date range.

    Args:
        request: The HTTP request object.
        start: Start date for the search query.
        end: End date for the search query.

    Returns:
        An HttpResponse with the rendered search results template.
    """
    start = kwargs['start']
    end = kwargs['end']
    
    partner = profilepartner.objects.get(user=request.user)
    timezone = pytz.timezone(partner.Country.time_zone.TimeZone)

    start = datetime.strptime(start, '%Y-%m-%d')
    startDate = timezone.localize(start)

    end = datetime.strptime(end, '%Y-%m-%d')
    endDate = timezone.localize(end)
    
    payment = paymentlog.objects.filter(user=request.user,RegistrationDate__gte=startDate, RegistrationDate__lte=endDate)
    PaymentLog=[]
    for pay in payment:
        PaymentLog.append([pay.pk,pay.RegistrationDate,pay.OperationType,pay.SettlementDate, pay.Ride.pk,pay.Booking.pk,price_format(pay.Value,partner.Country)])
    
    data ={
        'PaymentLog':PaymentLog,
        }
    return HttpResponse(render_to_string('partner/searchTransaction.html',data))

@login_required(login_url="login")
@api_client_required
def searchRequests(request, *args, **kwargs):
    """
    Search and display a list of API request logs within a specified date range.

    Args:
        request: The HTTP request object.
        start: Start date for the search query.
        end: End date for the search query.

    Returns:
        An HttpResponse with the rendered search results template.
    """
    start = kwargs['start']
    end = kwargs['end']
    
    partner = profilepartner.objects.get(user=request.user)
    timezone = pytz.timezone(partner.Country.time_zone.TimeZone)

    start = datetime.strptime(start, '%Y-%m-%d')
    startDate = timezone.localize(start)

    end = datetime.strptime(end, '%Y-%m-%d')
    endDate = timezone.localize(end)

    requests = APILogsModel.objects.filter(user=request.user,added_on__gte=startDate, added_on__lte=endDate)
    
    EventLog=[]
    for event in requests:
        EventLog.append([event.pk,event.added_on,event.method,event.api,event.client_ip_address])

    data ={
        'EventLog':EventLog,
        }
    return HttpResponse(render_to_string('partner/searchRequests.html',data))

@login_required(login_url="login")
@api_client_required
def searchLogin(request, *args, **kwargs):
    """
    Searches and displays login logs based on the specified date range.

    Args:
        request: The HTTP request object.
        start: Start date for the search query.
        end: End date for the search query.

    Returns:
        An HttpResponse with the list of login logs within the date range.
    """
    start = kwargs['start']
    end = kwargs['end']
    
    partner = profilepartner.objects.get(user=request.user)
    timezone = pytz.timezone(partner.Country.time_zone.TimeZone)

    start = datetime.strptime(start, '%Y-%m-%d')
    startDate = timezone.localize(start)

    end = datetime.strptime(end, '%Y-%m-%d')
    endDate = timezone.localize(end)

    logs = userloginlog.objects.filter(user=request.user,RegistrationDate__gte=startDate, RegistrationDate__lte=endDate)
    
    AccessLog=[]
    for access in logs:
        AccessLog.append([access.RegistrationDate,access.IP,access.local, access.country])

    data ={
        'AccessLog':AccessLog,
        }
    return HttpResponse(render_to_string('partner/searchLogin.html',data))

@login_required(login_url="login")
@api_client_required
def ClientDashboard(request, *args, **kwargs):
    """
    Renders the partner client's dashboard with recent log information.

    Args:
        request: The HTTP request object.

    Returns:
        A rendered template response with the complete dashboard context.
    """
    # Dashboard data preparation and context setup goes here...
    end   = datetime.today()
    start = end - timedelta(days=8)
    
    enddate   = end.strftime("%Y-%m-%d")
    startdate = start.strftime("%Y-%m-%d")

    partner = profilepartner.objects.get(user=request.user)
    
    if partner.API_activated:
        key = Token.objects.get(user=request.user)
    else:
        key = ''
    
    logs = userloginlog.objects.filter(user=request.user,RegistrationDate__gte=start, RegistrationDate__lte=end)
    requests = APILogsModel.objects.filter(user=request.user,added_on__gte=start, added_on__lte=end)
    payment = paymentlog.objects.filter(user=request.user,RegistrationDate__gte=start, RegistrationDate__lte=end)
    cover = coverage.objects.filter(user=request.user)
    poc = partnerpoc.objects.filter(user=request.user)
    
    AccessLog=[]
    for access in logs:
        AccessLog.append([access.pk,access.RegistrationDate,access.IP,access.local, access.country])

    EventLog=[]
    for event in requests:
        EventLog.append([event.pk,event.added_on,event.method,event.api,event.client_ip_address])

    PaymentLog=[]
    for pay in payment:
        PaymentLog.append([pay.pk,pay.RegistrationDate,pay.OperationType,pay.SettlementDate, pay.Ride.pk,pay.Booking.pk,price_format(pay.Value,partner.Country)])

    AppCover=[]
    for local in cover:
        AppCover.append([local.pk,local.Country,local.DistrictRegion, local.CityMunicipality,local.ServiceCategory])

    POCs=[]
    for person in poc:
        POCs.append([person.pk,person.Category,person.Name,person.email, person.Telephone,person.Address,person.Zip_Code,person.Country])

    data ={
        'is_anonymous': 0,
        'is_client': 1, 
        'user': request.user, 
        'partner':partner, 
        'startdate':startdate,
        'enddate':enddate,
        'key': key,
        'AccessLog': AccessLog, 
        'EventLog': EventLog,
        'PaymentLog':PaymentLog,
        'AppCover':AppCover,
        'POCs':POCs,
        }

    return render(request, 'partner/dashboard.html', data) 

def confirmLogin(request):
    """
    Renders a confirmation page upon successful login.

    Returns:
        An HttpResponse with the confirmation template.
    """
    # Render and return the login confirmation page...
    return HttpResponse(render_to_string('partner/confirmLogin.html'))

# Client signup
class ClientSignUp(CreateView):
    """
    Handles the client sign-up process.
    
    Upon successful sign-up, the user is redirected to a confirmation page.
    """
    model = User
    form_class = SignUpForm
    template_name = 'partner/clientsignup.html'
    success_url = '/'

    def get_context_data(self, **kwargs):
        """
        Adds additional context for rendering the client sign-up template.

        Returns:
            The extended context.
        """
        # Add context such as user type...        
        context = super().get_context_data(**kwargs)
        context['user_type'] = 'partner'

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        #activate(code)

        #context['code'] = code

        return context

    def form_valid(self, form):
        """
        Processes a valid sign-up form submission.

        Returns:
            A redirect response to a signup confirmation page.
        """
        # Sign-up form processing and confirmation logic goes here...
        user = form.save()

        #user.set_password(user.password)
        #user.save()

        #try:
        #    code = self.request.session['code']
        #except KeyError:
        #    if self.request.user.Language.Code:
        #        code = self.request.user.Language.Code
        #    else:
        #        code = 'en'

        current_site = get_current_site(self.request)
        subject = gettext('Suroga email account confirmation.')
        next = self.request.session.get('next', '/')
        
        #message = render_to_string('client/email_confirmation_'+code+'.html', {
        #    'username': user.username,
        #    'domain': current_site.domain,
        #    'port': self.request.get_port(),
        #    'next': next,
        #    'uid': urlsafe_base64_encode(force_bytes(user.pk)),
            #'token': account_activation_token.make_token(user),
        #})

       
        #msg = EmailMessage(subject,message, to=[user.email])

        
        login(self.request, user, backend='django.contrib.auth.backends.ModelBackend')
        
        #try:
        #    msg.send()
        #except ConnectionRefusedError:
            # Alert staff
        #    m=MessageBoard(Sender = user, Code = 0, Text = "Connection Refused Error.")
        #    m.save()


        return HttpResponse(render_to_string('partner/confirmSignup.html'))


# --- App: partner - File: admin.py ---

"""
Partner Administration - Suroga API

This module configures the admin interface for the Partner app within the Suroga API project.
It leverages Django's admin.ModelAdmin class to customize the admin panel for the partner models,
allowing administrators to easily add, modify, and delete partner data.

Administrative interface classes such as 'coverageAdmin', 'profilepartnerAdmin', 'jobpocAdmin',
and 'partnerpocAdmin' are defined here to fine-tune the presentation and capabilities of the
admin list view as per the requirements of Suroga API's data management.

By registering models with their respective admin classes, these configurations become effective 
in the admin site, providing a user-friendly and efficient way to manage partner-related information.

Recommended Usage:
    - Refine or expand the list_display attributes to include fields most critical for the admin users.
    - Leverage Django's admin functionalities like 'list_filter', 'search_fields', and 'ordering' to improve data browsing capabilities.

Important:
    - Changes to the admin interface should always be preceded by careful consideration and thorough testing in a development environment to ensure they meet the requirements and do not negatively impact the user experience.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
from django.contrib import admin

# Register your models here.
from partner.models import coverage, profilepartner, jobpoc, partnerpoc

class coverageAdmin(admin.ModelAdmin):
    """
    Configures the Django admin interface for the 'coverage' model.

    This admin class defines the display of the geographical coverage within the admin list view.
    """
    list_display = (
    'pk',
    'Country',
    'DistrictRegion',
    'CityMunicipality',
    'ServiceCategory',
    )
# Registers the 'coverage' model for management in the admin interface
admin.site.register(coverage,coverageAdmin)

class profilepartnerAdmin(admin.ModelAdmin):
    """
    Customizes the Partner Profile model view in the Django admin interface.

    Allows administrators to oversee partner profiles, including verification statuses and API activation.
    """
    list_display = (
    'pk',
    'Validated_profile',
    'user',
    'Name',
    'Country',
    'Language',
    'Telephone',
    'API_activated',
    'Address_verified',
    'Telephone_verified',
    'ITIN_verified',
    'IBAN_verified',
    'Google_play_verified',
    'Apple_store_verified',
    'webwooks_suroo_verified',
    )
# Registers the 'profilepartner' model for management in the admin interface
admin.site.register(profilepartner,profilepartnerAdmin)

class jobpocAdmin(admin.ModelAdmin):
    """
    Admin interface settings for the Job Point of Contact (POC) model.

    Offers a simplified list view showcasing POC categories.
    """
    list_display = (
    'pk',
    'JobCategory',  # Displays the job category of the partner's POC
    )
# Registers the 'jobpoc' model for management in the admin interface
admin.site.register(jobpoc,jobpocAdmin)


class partnerpocAdmin(admin.ModelAdmin):
    """
    Admin interface for managing Points of Contact (POC) associated with partner profiles.

    The list view provides quick access to key details such as the partner's name, email, and telephone.
    """
    list_display = (
    'pk',
    'user', # User entity associated with the POC
    'Category', # POC's job category
    'Name',
    'email',
    'Telephone',
    )
admin.site.register(partnerpoc,partnerpocAdmin)



# --- App: partner - File: apps.py ---

"""
Partner Application Configuration - Suroga API

This module defines the default application configuration ['PartnerConfig'] for the Partner app within the Suroga API project.
It specifies application-specific settings, such as the primary key field type for models and the application's name.

The AppConfig class within this file acts as a container for the application's configuration. When Django starts up, it uses
the information contained here to set up aspects of the application, and it can be a place to perform initialization tasks.

Attributes:
    default_auto_field: Specifies the type of auto field to use as a primary key (e.g., BigAutoField for larger number space).
    name: Declares the application namespace and label. This full dotted Python path is used by Django to find and use the app.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014

Example:
    The default_auto_field is recommended to be set to 'BigAutoField' in new Django projects
    to avoid potential issues after a substantial number of objects have been created.
"""
from django.apps import AppConfig


class PartnerConfig(AppConfig):
    """
    Application configuration for the Partner app within the Suroga API project.
    
    This class configures app-specific settings and acts as a hook for performing initialization and configuration tasks
    like setting the default field type for auto-generated primary keys across all models in the 'partner' app.
    
    Attributes:
        default_auto_field: Specifies the default field type to use for auto-generated primary key fields.
                        Django recommends using 'BigAutoField' for new projects to provide more space for the identifiers.
        name: Declares the application's label for internal reference. It is used by Django to tie together
              the application's various components.
    """
    # Specifies the default field type for auto-generated primary key fields.
    default_auto_field = 'django.db.models.BigAutoField'
    # Sets the label for the application in Django's app registry. Important for relating models, views, etc., to the correct app.
    name = 'partner'


# --- App: partner - File: forms.py ---

"""
Partner App Forms - Suroga API

This module defines the forms used within the Partner application of the Suroga API. Forms in Django are
a flexible way of controlling user input on the frontend by providing fields for data entry and handling
form submissions on the backend.

The forms included here extend Django's default forms and form fields, customizing them for use cases specific
to the Partner application. Custom form fields and widgets, along with appropriate styling and validation, are
applied to ensure data integrity and user-friendly interfaces.

Usage:
    - Utilize these forms in views to handle GET and POST requests, process user data, and render form errors.
    - The forms are integrated with templates to present the correct context and collect user input.

Features:
    - Extends Django's built-in forms like 'UserCreationForm' and 'AuthenticationForm' for user authentication.
    - Model form integrations with 'partnerpoc', 'profilepartner', and other related models.
    - Client-side validation using custom widgets, classes, and placeholders.

References:
    - Django Forms documentation: https://docs.djangoproject.com/en/4.0/topics/forms/
    - Django Widgets reference: https://docs.djangoproject.com/en/4.0/ref/forms/widgets/

Changes should be thoroughly tested to prevent any data mishandling or user experience issues.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
from django import forms
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.db import transaction
from django.utils.translation import gettext_lazy

from core.models import User

from core.models import  country, Language
from core.models import usertype,userprofile
from partner.models import coverage, jobpoc, partnerpoc, profilepartner
from rides.models import ServiceCategory

class profileForm(forms.ModelForm):
    """
    Form for creating and updating partner profiles.

    Includes widgets for enhanced UX, customizations for appearance, and validations.
    """
    # Form fields with assigned widgets and custom classes for styling
    Name = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Address = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Zip_Code = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    City = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    
    # A dropdown for selecting a Country with queryset sorted by Name
    Country = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = 'Select Country', queryset=country.objects.all().order_by('Name'))
    Language = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = 'Select leanguage', queryset=Language.objects.all().order_by('Name'))
    Telephone = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    ITIN = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    IBAN = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    Website = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    APP_domain = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    webwooks_suroo = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    Google_play = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    Apple_store = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    Observation = forms.Field(widget=forms.Textarea(attrs= {
        "class":"form-control", "rows":"7",
        } ),required=True)
    class Meta:
        model = profilepartner
        # Specify model fields that should be included in this form
        fields = ('Name','Address','Zip_Code','City','Website',
        'Country','Language','Telephone','ITIN','IBAN','Google_play','Apple_store',
        'APP_description','APP_domain','webwooks_suroo','Observation',)

class localForm(forms.ModelForm):
    """
    Form for adding or updating local coverage information for a partner's services.

    Provides fields to capture location and service category details.
    """
    Country = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    DistrictRegion = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    CityMunicipality = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    # Dropdown for selecting Service Categories
    ServiceCategory = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = 'Select Category', queryset=ServiceCategory.objects.all().order_by('Name'))
    
    class Meta:
        model = coverage
        # Define the model fields to be included in this form
        fields = ('Country','DistrictRegion',
        'CityMunicipality','ServiceCategory')

class  contactForm(forms.ModelForm):
    """
    Form for creating and editing Partner Points of Contact (POC).

    Customizes form fields with styling classes and specifies model choice fields with custom querysets.
    """
    # Dropdown for selecting titles with sorted queryset
    Category = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=False, empty_label = 'Select title', queryset=jobpoc.objects.all().order_by('JobCategory'))
    Name = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Address  = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Zip_Code = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Country = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = 'Select Country', queryset=country.objects.all().order_by('Name'))
    email = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=True)
    Telephone = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", 
        } ),required=False)
    Language1 = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = 'Select leanguage', queryset=Language.objects.all().order_by('Name'))
    Language2 = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=False, empty_label = 'Select leanguage', queryset=Language.objects.all().order_by('Name'))
    Observation = forms.Field(widget=forms.Textarea(attrs= {
        "class":"form-control", "rows":"7",
        } ),required=False)

    class Meta:
        model = partnerpoc
        fields = ('Category','Name','Address',
        'Zip_Code','Country','Telephone',
        'email','Language1','Language2','Observation')

class SignUpForm(UserCreationForm):
    """
    Custom sign-up form for new users, extending UserCreationForm with additional fields.

    The save method is overridden to perform additional operations after saving the new user.
    """
    username =  forms.EmailField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Email address"),
    } ),required=True)

    Name = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Name"),
    } ),required=True)
    Address = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Address"),
    } ),required=True)
    Zip_Code = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Zip Code"),
    } ),required=True)
    City = forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("City"),
    } ),required=True)

    password1 =  forms.CharField(widget=forms.PasswordInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Password"),
    } ))

    password2 =  forms.CharField(widget=forms.PasswordInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Confirm Password"),
    } ))

     
    country = forms.ModelChoiceField( widget=forms.Select(attrs={'class':'custom-select'}),
    required=True, empty_label = gettext_lazy('Select Country'), queryset=country.objects.order_by('Name'))
    

    class Meta(UserCreationForm.Meta):
        # Inherit default user fields from UserCreationForm Meta and add new ones
        
        model = User
        fields = ('username', 'password1', 'password2')
    
    @transaction.atomic
    def save(self,commit=True):
        """
        Saves the new user and creates an associated profilepartner instance.
        """
        member = super().save(commit=False)
        member.is_active = True 
        member.email_confirmed = False
        member.email=member.username
        member.save()

        Name = self.cleaned_data['Name']
        Address = self.cleaned_data['Address']
        Zip_Code = self.cleaned_data['Zip_Code']
        City = self.cleaned_data['City']
        Country = self.cleaned_data['country']

        # Add client profile
        obj = profilepartner(user=member)
        obj.Name = Name 
        obj.Address = Address 
        obj.City = City 
        obj.Zip_Code = Zip_Code 
        obj.Country = Country
        obj.Language = Country.Language  
        obj.save()

        return member        
        
        
class CustomAuthenticationForm(AuthenticationForm):
    """
    Custom authentication form with styling classes and placeholders for login fields.
    """
    # Input fields for username and password with styling and internationalized placeholders
    
    username =  forms.CharField(widget=forms.TextInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("E-mail"),
    } ))

    password =  forms.CharField(widget=forms.PasswordInput(attrs= {
        "class":"form-control", "placeholder":gettext_lazy("Password"),
    } ))

    class Meta:
        model = User
        fields = ('username', 'password')

    def confirm_login_allowed(self, user):
        """
        Custom login confirmation that checks the user's active status.
        """
        if not user.is_active:
            raise forms.ValidationError('There was a problem with your login.', code='invalid_login')



# --- App: partner.migrations - File: 0008_partnerpoc_language1_partnerpoc_language2.py ---

# Generated by Django 4.0.1 on 2022-12-16 16:32

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0008_alter_events_request'),
        ('partner', '0007_remove_partnerpoc_partner_partnerpoc_user'),
    ]

    operations = [
        migrations.AddField(
            model_name='partnerpoc',
            name='Language1',
            field=models.ForeignKey(blank=True, help_text='POC_Language 1', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_Language1', to='core.language'),
        ),
        migrations.AddField(
            model_name='partnerpoc',
            name='Language2',
            field=models.ForeignKey(blank=True, help_text='POC Language 2', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_Language2', to='core.language'),
        ),
    ]


# --- App: partner.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:07

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('core', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='jobpoc',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('JobCategory', models.CharField(help_text='POC category', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Partners POC category',
            },
        ),
        migrations.CreateModel(
            name='profilepartner',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(blank=True, help_text='Partner Name', max_length=100)),
                ('Address', models.CharField(blank=True, help_text='Address', max_length=100)),
                ('Zip_Code', models.CharField(blank=True, help_text='Zip Code.', max_length=100)),
                ('City', models.CharField(blank=True, help_text='City', max_length=100)),
                ('Telephone', models.CharField(blank=True, help_text='Business telephone.', max_length=100)),
                ('ITIN', models.CharField(blank=True, help_text='Individual Tax Identification Number', max_length=40)),
                ('IBAN', models.CharField(blank=True, help_text='Agency IBAN', max_length=40)),
                ('HashKey', models.CharField(blank=True, help_text='Hash key to identity the partners agents', max_length=40)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('Website', models.URLField(blank=True, default='', help_text='Partner Website. ')),
                ('Stripe_ID', models.CharField(blank=True, default='', help_text='Partner ID', max_length=10)),
                ('API_activated', models.BooleanField(default=False, help_text='Site status TRUE=active/FALSE=inactive.')),
                ('API_integration_level', models.CharField(blank=True, default='', help_text='API integration level.', max_length=10)),
                ('APP_description', models.TextField(blank=True, help_text='JSON APP description.', max_length=1000)),
                ('Payment_Policy', models.TextField(blank=True, help_text='JSON payment policy.', max_length=1000)),
                ('Observation', models.TextField(blank=True, help_text='Observation about client.', max_length=1000)),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.country')),
                ('Language', models.ForeignKey(blank=True, help_text='Language', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.language')),
                ('user', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='partner_user', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Partners',
            },
        ),
        migrations.CreateModel(
            name='partnerpoc',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(blank=True, help_text='ARepresentativegency Name', max_length=100)),
                ('Address', models.CharField(blank=True, help_text='Address', max_length=100)),
                ('Zip_Code', models.CharField(blank=True, help_text='Zip Code.', max_length=100)),
                ('email', models.CharField(blank=True, help_text='Business email.', max_length=15)),
                ('email_verified', models.BooleanField(default=False, help_text='True if email was verified')),
                ('Telephone', models.CharField(blank=True, help_text='Business telephone.', max_length=15)),
                ('HashKey', models.CharField(blank=True, help_text='Hash key to identity Representative', max_length=40)),
                ('Registration', models.DateTimeField(default=django.utils.timezone.now)),
                ('Extra_record', models.TextField(blank=True, help_text='JSON: extra records.', max_length=1000)),
                ('Observation', models.TextField(blank=True, help_text='Observation about Representative.', max_length=1000)),
                ('Category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_category', to='partner.jobpoc')),
                ('Country', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_Country', to='core.country')),
                ('partner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_Agency', to='partner.profilepartner')),
            ],
            options={
                'verbose_name_plural': 'Partner POCs',
            },
        ),
    ]


# --- App: partner.migrations - File: 0003_coverage.py ---

# Generated by Django 4.0.1 on 2022-12-12 11:54

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('partner', '0002_profilepartner_app_domain_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='coverage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Country', models.CharField(blank=True, help_text='Country', max_length=30)),
                ('RegionState', models.CharField(blank=True, help_text='RegionState', max_length=30)),
                ('DistrictRegion', models.CharField(blank=True, help_text='District/Region', max_length=30)),
                ('CityMunicipality', models.CharField(blank=True, help_text='City/Municipality', max_length=30)),
                ('ServiceCategory', models.CharField(blank=True, help_text='Service Category', max_length=30)),
                ('user', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='coverage_user', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'APP coverage',
            },
        ),
    ]


# --- App: partner.migrations - File: 0011_remove_coverage_regionstate.py ---

# Generated by Django 4.0.1 on 2023-01-15 17:44

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0010_alter_partnerpoc_email'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='coverage',
            name='RegionState',
        ),
    ]


# --- App: partner.migrations - File: 0006_alter_coverage_servicecategory.py ---

# Generated by Django 4.0.1 on 2022-12-13 22:32

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0007_paymentlog'),
        ('partner', '0005_profilepartner_api_test_mode_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='coverage',
            name='ServiceCategory',
            field=models.ForeignKey(blank=True, help_text='Service type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='rides.servicecategory'),
        ),
    ]


# --- App: partner.migrations - File: 0005_profilepartner_api_test_mode_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-13 19:52

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0004_profilepartner_balance_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='profilepartner',
            name='API_test_mode',
            field=models.BooleanField(default=True, help_text='Test mode status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AlterField(
            model_name='profilepartner',
            name='API_activated',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
    ]


# --- App: partner.migrations - File: 0007_remove_partnerpoc_partner_partnerpoc_user.py ---

# Generated by Django 4.0.1 on 2022-12-13 22:55

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('partner', '0006_alter_coverage_servicecategory'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='partnerpoc',
            name='partner',
        ),
        migrations.AddField(
            model_name='partnerpoc',
            name='user',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='POC_Agency', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: partner.migrations - File: __init__.py ---



# --- App: partner.migrations - File: 0002_profilepartner_app_domain_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-11 19:42

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='profilepartner',
            name='APP_domain',
            field=models.URLField(blank=True, default='', help_text='APP web domain'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='webwooks_suroo',
            field=models.URLField(blank=True, default='', help_text='Webwook suroo alerts'),
        ),
    ]


# --- App: partner.migrations - File: 0004_profilepartner_balance_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-13 02:26

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0003_coverage'),
    ]

    operations = [
        migrations.AddField(
            model_name='profilepartner',
            name='Balance',
            field=models.DecimalField(decimal_places=2, default=0, help_text='Balance', max_digits=7),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='NumberBookedRides',
            field=models.IntegerField(default=0, help_text='Number booked rides'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='NumberCancedRides',
            field=models.IntegerField(default=0, help_text='Number of canced rides'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='NumberCompletedRides',
            field=models.IntegerField(default=0, help_text='Number of completed rides'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='NumberRegisteredRides',
            field=models.IntegerField(default=0, help_text='Number registered rides'),
        ),
    ]


# --- App: partner.migrations - File: 0010_alter_partnerpoc_email.py ---

# Generated by Django 4.0.1 on 2022-12-18 20:49

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0009_profilepartner_app_domain_verified_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='partnerpoc',
            name='email',
            field=models.CharField(blank=True, help_text='Business email.', max_length=50),
        ),
    ]


# --- App: partner.migrations - File: 0009_profilepartner_app_domain_verified_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-18 16:38

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('partner', '0008_partnerpoc_language1_partnerpoc_language2'),
    ]

    operations = [
        migrations.AddField(
            model_name='profilepartner',
            name='APP_domain_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Address_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Apple_store',
            field=models.URLField(blank=True, default='', help_text='APP in Apple Store. '),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Apple_store_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Google_play',
            field=models.URLField(blank=True, default='', help_text='APP in Google Play. '),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Google_play_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='IBAN_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='ITIN_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Telephone_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='Validated_profile',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AddField(
            model_name='profilepartner',
            name='webwooks_suroo_verified',
            field=models.BooleanField(default=False, help_text='API status TRUE=active/FALSE=inactive.'),
        ),
        migrations.AlterField(
            model_name='profilepartner',
            name='APP_domain',
            field=models.URLField(blank=True, default='API calls', help_text='APP web domain'),
        ),
    ]


# --- App: kit - File: tests.py ---

from django.test import TestCase

# Create your tests here.


# --- App: kit - File: models.py ---

"""
Kit Models - Suroga API

Defines the data models for the Kit application within the Suroga API.
These models represent the essential entities in the kit management system,
such as various types of kits, the stock of kits available, and the logs of
operations performed on them. The models are designed to capture all necessary
information to accurately track and manage kit-related data.

Models:
    - KitType: Describes the types of kits available.
    - KitStock: Manages the inventory of kits, including their types and quantities.
    - OperationType: Categorizes the types of operations that can be applied to kits.
    - OperationLog: Logs specific operations carried out on kit stocks.

Usage:
    These models should be referenced in views, forms, and other components
    that require interaction with kit-related data.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014

Remember to update the 'Last Modified' date whenever you make changes to this file.
"""
import datetime
import hashlib

from django.db import models, IntegrityError
from django.utils import timezone
from django.http import HttpResponse

from supplier.models import  contractsection


class kittype(models.Model):
    """
    Defines the type of kits available within the Partner app ecosystem.

    Attributes:
      KitTypeName: A human-readable name that uniquely identifies the type of kit.
    """
    KitTypeName = models.CharField(max_length=100, unique=True, blank=False, help_text = "Kit Type Name")

    class Meta:
        verbose_name_plural = "Kit Types"
    def __str__(self):
        """
        Returns a string representation of the Kit Type model, utilizing the KitTypeName.
        """
        return self.KitTypeName

class kitstock(models.Model):
    """
    Keeps an inventory of the kits including their types and content specifications.

    Attributes:
      KitType: Relates each stock item to a specific kit type.
      Kit_Ref_Number: A unique identifier for the kit stock item.
      Location: The stored location, potentially relating to a contract section.
      Content: A JSON field describing the contents of the kit.
    """
    KitType = models.ForeignKey(kittype, on_delete=models.SET_NULL, null=True, blank=False, help_text = "Kite type")  
    Kit_Ref_Numer = models.CharField(max_length=15, unique=True, blank=False, help_text = "Kit Ref number")
    Location = models.ForeignKey(contractsection , on_delete=models.SET_NULL, null=True, blank=True, help_text = "Location")  
    Content = models.TextField(max_length=1000, blank=True, help_text = "JSON: kit content") 

    class Meta:
        verbose_name_plural = "Kit Stock"
    def __str__(self):
        """
        Returns the unique reference number of the kit stock, aiding in its identification.
        """
        return self.Kit_Ref_Numer

class operationtype(models.Model):
    """
    Specifies the types of operations that can be performed on or with a kit in the system.

    Attributes:
      OperationTypeName: Name of the operation type, like 'maintenance' or 'replenishment'.
    """
    operationTypeName = models.CharField(max_length=50, unique=True, blank=False, help_text = "Operation Type")
     
    class Meta:
        verbose_name_plural = "Operation Types"

    def __str__(self):
        """
        Returns a string representation of the operation, utilizing the OperationTypeName.
        """
        return self.operationTypeName

class operationlog(models.Model):
    """
    Logs and tracks the details of operations performed on kits.

    Attributes:
      Kit: The kit on which the operation is performed.
      Description: Details of the operation.
      DateTime: Timestamp when the operation was logged.
      OperationType: The type of operation being logged.
      ContractSectionA: Links to a contract section involved in the operation.
      ExpectedArrivalDate: Predicted date of the kit's arrival for the operation.
      ConfirmationFromSectionA: Whether arrival has been confirmed by the contract party.
      ContractSectionD: Links to a contract section responsible for delivery.
      DeliveryFromSectionD: Whether delivery by Section D is confirmed.
      ReceptionFromSectionD: Whether reception from Section D is confirmed.
    """
    Kit = models.ForeignKey(kitstock,on_delete=models.SET_NULL, null=True, blank=False, help_text = "Kit", related_name='operation_kit')
    Description = models.CharField(max_length=100, unique=True, blank=False, help_text = "Operation description")
    DateTime = models.DateTimeField(default=timezone.now)  
    OperationType = models.ForeignKey(operationtype,on_delete=models.SET_NULL, null=True, blank=False, help_text = "Operation Type", related_name='operation_type')
    ContractSectionA = models.ForeignKey(operationtype,on_delete=models.SET_NULL, null=True, blank=False, help_text = "Contract A", related_name='operation_A')
    ExpectedArrivalDate = models.DateTimeField(default=timezone.now)   
    ConfirmationFromSectionA = models.BooleanField(default=False, help_text = "True if supplier confirmed kit arrivel.")
    ContractSectionD = models.ForeignKey(operationtype,on_delete=models.SET_NULL, null=True, blank=False, help_text = "Contract D", related_name='operation_De')
    DeliveryFromSectionD = models.BooleanField(default=False, help_text = "True if supplier confirmed kit delivery.")
    ReceptionFromSectionD = models.BooleanField(default=False, help_text = "True if supplier confirmed kit reception.")

    class Meta:
        verbose_name_plural = "Operation Log"

    def __str__(self):
        """
        Returns a string representation of the Operation Log based on the DateTime.
        """
        return str(self.DateTime)


# --- App: kit - File: __init__.py ---



# --- App: kit - File: views.py ---

from django.shortcuts import render

# Create your views here.


# --- App: kit - File: admin.py ---

"""
Kit Administration - Suroga API

This module configures the administrative interface for managing kits within the Suroga API. It utilizes Django's
admin module to create an admin interface for the Kit app models. Admin classes are defined here to customize
the appearance and functionality of the Kit model views within the Django admin site.

Included Admin Classes:
    - KitTypeAdmin: Manages the display and organization of KitType entities.
    - KitStockAdmin: Provides administration options for KitStock inventory records.
    - OperationTypeAdmin: Facilitates the categorization of various operation types.
    - OperationLogAdmin: Tracks and reviews operation logs related to kits.

By registering the app's models along with their respective Admin classes, the admin interface is enhanced
to provide customized displays for managing kit-related data efficiently and intuitively.

Usage:
    - The Django admin site uses these configurations to provide a user interface for administrative staff.
    - Admin classes determine how records are listed, edited, and displayed in the backend dashboard.

Please ensure proper registration of model Admin classes and consistent updates to the configurations
to match the evolving requirements of the administrative operations.

Maintainer: Carlos Leandro
Last Modified: 15/3/2024

Example:
    The registrations of admin classes use the Django admin.site.register() function to link each model
    to its specific Admin class.
"""
from django.contrib import admin

# Register your models here.

from kit.models import kittype, kitstock, operationtype, operationlog

class kittypeAdmin(admin.ModelAdmin):
    """
    Admin interface configuration for KitType model.

    Displays the `pk` and `KitTypeName` in the admin list view to easily identify different kit types.
    """
    list_display = (
    'pk',
    'KitTypeName',
    )
# Registers KitType model for admin management using the kittypeAdmin configuration
admin.site.register(kittype,kittypeAdmin)

class kitstockAdmin(admin.ModelAdmin):
    """
    Admin interface configuration for KitStock model.

    Defines a detailed view of kit stock items, including their type, reference number, and location content.
    """
    list_display = (
    'pk',
    'KitType',
    'Kit_Ref_Numer',
    'Location',
    'Content'
    )
# Registers KitStock model for admin management using the kitstockAdmin configuration
admin.site.register(kitstock,kitstockAdmin)

class operationtypeAdmin(admin.ModelAdmin):
    """
    Admin interface configuration for OperationType model.

    Provides a concise view featuring the `pk` and `OperationTypeName`, helping to distinguish operation types.
    """
    list_display = (
    'pk',
    'operationTypeName',
    )

# Registers OperationType model for admin management using the operationtypeAdmin configuration
admin.site.register(operationtype,operationtypeAdmin)

class operationlogAdmin(admin.ModelAdmin):
    """
    Admin interface configuration for OperationLog model.

    Allows administrators to view logs of operations performed, their types, and
    statuses related to expected arrival, delivery, and reception.
    """
    list_display = (
    'pk',
    'Kit',
    'Description',
    'DateTime',
    'OperationType',
    'ContractSectionA',
    'ExpectedArrivalDate',
    'ConfirmationFromSectionA',
    'ContractSectionD',
    'DeliveryFromSectionD',
    'ReceptionFromSectionD',
    )
# Registers OperationLog model for admin management using the operationlogAdmin configuration
admin.site.register(operationlog,operationlogAdmin)


# --- App: kit - File: apps.py ---

from django.apps import AppConfig


class KitConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'kit'


# --- App: kit.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:06

from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('supplier', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='kitstock',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Kit_Ref_Numer', models.CharField(help_text='Kit Ref number', max_length=15, unique=True)),
                ('Content', models.TextField(blank=True, help_text='JSON: kit content', max_length=1000)),
            ],
            options={
                'verbose_name_plural': 'Kit stock',
            },
        ),
        migrations.CreateModel(
            name='kittype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('KitTypeName', models.CharField(help_text='Kit Type Name', max_length=100, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Kit Types',
            },
        ),
        migrations.CreateModel(
            name='operationtype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('operationTypeName', models.CharField(help_text='Operation Type', max_length=50, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Operation Types',
            },
        ),
        migrations.CreateModel(
            name='operationlog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Description', models.CharField(help_text='Operation description', max_length=100, unique=True)),
                ('DateTime', models.DateTimeField(default=django.utils.timezone.now)),
                ('ExpectedArrivalDate', models.DateTimeField(default=django.utils.timezone.now)),
                ('ConfirmationFromSectionA', models.BooleanField(default=False, help_text='True if supplier confirmed kit arrivel.')),
                ('DeliveryFromSectionD', models.BooleanField(default=False, help_text='True if supplier confirmed kit delivery.')),
                ('ReceptionFromSectionD', models.BooleanField(default=False, help_text='True if supplier confirmed kit reception.')),
                ('ContractSectionA', models.ForeignKey(help_text='Contract A', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operation_A', to='kit.operationtype')),
                ('ContractSectionD', models.ForeignKey(help_text='Contract D', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operation_De', to='kit.operationtype')),
                ('Kit', models.ForeignKey(help_text='Kit', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operation_kit', to='kit.kitstock')),
                ('OperationType', models.ForeignKey(help_text='Operation Type', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operation_type', to='kit.operationtype')),
            ],
            options={
                'verbose_name_plural': 'Operation Log',
            },
        ),
        migrations.AddField(
            model_name='kitstock',
            name='KitType',
            field=models.ForeignKey(help_text='Kite type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='kit.kittype'),
        ),
        migrations.AddField(
            model_name='kitstock',
            name='Location',
            field=models.ForeignKey(blank=True, help_text='Location', null=True, on_delete=django.db.models.deletion.SET_NULL, to='supplier.contractsection'),
        ),
    ]


# --- App: kit.migrations - File: __init__.py ---



# --- App: rides - File: tests.py ---

"""
Tests for Rides App - Suroga API

This module contains the test cases for the Rides app within the Suroga API. It aims to ensure
that the endpoints for managing ride-related functionalities like creating, retrieving,
updating, and deleting rides operate correctly.

Using Django's built-in test framework and Django REST Framework's APIClient, the tests included here
cover a range of scenarios to validate the behavior and integrity of the application's API endpoints.

Automated tests are crucial for maintaining code quality and stability, making it easier to detect
regressions and other issues during development and before deployment.

Usage:
    The test cases can be executed using the management command:
    `python manage.py test rides.tests`

Recommended Practices:
    Each test class should target a specific set of related behaviors, while individual test methods
    should focus on single functionalities.
    Write tests for expected outcomes as well as edge cases and potential error conditions.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""

from django.urls import reverse
from rest_framework.test import APITestCase
from rest_framework import status
from django.contrib.auth.models import User
from .models import Ride, ServiceCategory, ridetype
from .serializers import RideSerializer

class RideTests(APITestCase):
    @classmethod
    def setUpTestData(cls):
        # Create a user for auth purposes
        cls.user = User.objects.create_user('testuser', 'test@example.com', 'testpassword')
        # Create instances for Ride, ServiceCategory, and RideType for testing
        cls.service_category = ServiceCategory.objects.create(Name='Test Category')
        cls.ride_type = ridetype.objects.create(Name='Test RideType')
        cls.ride = Ride.objects.create(user=cls.user, ServiceCategory=cls.service_category, RideType=cls.ride_type,
                                       ServiceTitle='Test Ride', Country='Testland')
        
    def setUp(self):
        self.client.force_authenticate(user=self.user)  # Force authenticate the user for all tests
        
    def test_get_ride_list(self):
        # Test retrieving a list of rides
        url = reverse('rides:ride-list')
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data), 1)  # Assumes only one Ride instance in test db
        
    def test_create_ride(self):
        # Test creating a new ride
        url = reverse('rides:ride-list')
        data = {
            'ServiceTitle': 'New Test Ride',
            'ServiceCategory': self.service_category.pk,
            'RideType': self.ride_type.pk,
            'Country': 'Testland'
        }
        response = self.client.post(url, data, format='json')
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        
    def test_get_ride_detail(self):
        # Test retrieving a single ride by primary key
        url = reverse('rides:ride-detail', args=[self.ride.pk])
        response = self.client.get(url)
        self.assertEqual(response.status_id, status.HTTP_200_OK)
        self.assertEqual(response.data['ServiceTitle'], self.ride.ServiceTitle)

    # Additional tests for update, delete, and other actions can go here...

# --- App: rides - File: urls.py ---

"""
Rides Application URL Configuration

This module defines the URL patterns for the Rides application within the Suroga API project.
It specifies the mappings between URL paths, views, and actions for handling ride-related resources,
including registration, booking, stock management, and messaging functionalities.

By associating views with specific paths, the Django application can route incoming HTTP requests to the appropriate view logic, 
enabling RESTful interaction with the backend models via the Django REST Framework's viewsets.

The configuration supports both standard CRUD actions generated through routers and custom actions defined within each viewset,
reflecting the needs and the flow of the Rides application logic.

Usage:
    - Used by Django to match requested URLs to appropriate viewsets according to the provided routing patterns.
    - Centralized location to look up URL paths and their corresponding view logic for the application's endpoints.

References:
    - Django URL dispatcher: https://docs.djangoproject.com/en/4.0/topics/http/urls/
    - Django REST Framework routers: https://www.django-rest-framework.org/api-guide/routers/

This file should be updated with care, as changes could alter the public API surface and impact client applications.
Changes should be tested to confirm expected behavior.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
from django.urls import path, include
from rest_framework import routers, serializers, viewsets

from rides.views import messageViewSet,stockViewSet, ratingViewSet,servicecategoryViewSet,ridetypeViewSet,rideViewSet
from rides.views import  bookingViewSet

app_name = 'rides'

# Define URL patterns for rides using rideViewSet class
ride_list = rideViewSet.as_view({
    'get': 'list',
    'post': 'create'
})

ride_detail = rideViewSet.as_view({
    'get': 'retrieve',
    'post': 'update'
})

# Define URL patterns for bookings using bookingViewSet class
booking_list = bookingViewSet.as_view({
    'get': 'list',
    'post': 'create'
})

booking_detail = bookingViewSet.as_view({
    'get': 'retrieve',
    'post': 'update',
})

# Define URL patterns for stock items using stockViewSet class
stock_list = stockViewSet.as_view({
    'get': 'list',
})

stock_detail = stockViewSet.as_view({
    'get': 'retrieve',
})

# Define URL patterns for messages using messageViewSet class
messages_list = messageViewSet.as_view({
    'get': 'list',
})

# Routers provide an easy way of automatically determining the URL conf.
router = routers.DefaultRouter()
router.register(r'rating', ratingViewSet) # URL for rating viewset
router.register(r'ride-category', servicecategoryViewSet) # URL for service category viewset
router.register(r'ride-type', ridetypeViewSet)  # URL for ride type viewset
#router.register(r'registration', rideViewSet)
#router.register(r'booking', bookingViewSet)
#router.register(r'stock', stockViewSet)
#router.register(r'messages', messageViewSet)

# URL patterns for the Ride resource with list and detail views, along with custom actions.
urlpatterns = [
    
    # URL pattern for listing all rides or creating a new ride
    path('registration/', ride_list, name='ride-list'), 
    
    # URL pattern for retrieving, updating, or deleting a specific ride based on its primary key
    path('registration/<int:pk>/', ride_detail, name='ride-detail'),
    
    # URL pattern for canceling a specific ride
    path('registration/<int:pk>/cancel', rideViewSet.as_view({'get': 'cancel'}), name='ride-cancel'),
    
    # URL pattern for deleting a specific ride
    path('registration/<int:pk>/delete', rideViewSet.as_view({'get': 'delete'}), name='ride-delete'),
    
    # URL for generating a payment link for a specific ride
    path('registration/<int:pk>/payment_link', rideViewSet.as_view({'get': 'paymentlink'}), name='ride-payment'),
    
    # URL for closing a ride
    path('registration/<int:pk>/close', rideViewSet.as_view({'get': 'close'}), name='ride-close'),
    
    # URL pattern for listing all bookings or creating a new booking
    path(r'booking/', booking_list, name='booking-list'),
    
    # URL pattern for retrieving, updating, or deleting a specific booking
    path('booking/<int:pk>/', booking_detail, name='booking-detail'),
    
    # URL pattern for sending a message related to a booking
    path('booking/<int:pk>/send', bookingViewSet.as_view({'get': 'send'}), name='booking-send'),
    
    # More URL patterns for custom actions related to bookings, such as cancel, delete, handle extras, dispute, payment link, etc.

    path('booking/<int:pk>/cancel', bookingViewSet.as_view({'get': 'cancel'}), name='booking-cancel'),
    path('booking/<int:pk>/delete', bookingViewSet.as_view({'get': 'delete'}), name='booking-delete'),
    path('booking/<int:pk>/extra_costs', bookingViewSet.as_view({'get': 'extra_costs'}), name='booking-extras'),
    path('booking/<int:pk>/dispute', bookingViewSet.as_view({'get': 'dispute'}), name='booking-dispute'),
    path('booking/<int:pk>/payment_link', bookingViewSet.as_view({'get': 'paymentlink'}), name='booking-payment'),
    path('booking/<int:pk>/dashboards', bookingViewSet.as_view({'get': 'dashoards'}), name='booking-dashoards'),
    path('booking/<int:pk>/client_classification', bookingViewSet.as_view({'get': 'client_classification'}), name='booking-client-rank'),
    path('booking/<int:pk>/surrogate_classification', bookingViewSet.as_view({'get': 'surrogate_classification'}), name='booking-agent-rank'),
    path('booking/<int:pk>/ride_start', bookingViewSet.as_view({'get': 'ride_start'}), name='booking-strat'),
    path('booking/<int:pk>/ride_end', bookingViewSet.as_view({'get': 'ride_end'}), name='booking-end'),
    path('booking/<int:pk>/ride_close', bookingViewSet.as_view({'get': 'close'}), name='booking-close'),
    
    
    # URL pattern for listing stock items
    path('stock/', stock_list, name='stock-list'),
    
    # URL pattern for retrieving a specific stock item details
    path('stock/<int:pk>/', stock_detail, name='stock-detail'),
    
    # URL pattern for selecting or unselecting a stock item
    path('stock/<int:pk>/select',stockViewSet.as_view({'get': 'selected'}), name='stock-select'),
    path('stock/<int:pk>/unselect',stockViewSet.as_view({'get': 'unselected'}), name='stock-unselect'),
    
    # URL pattern for listing messages
    path('messages/', messages_list, name='messages-detail'),
    
    # URL pattern for custom actions on messages, such as mark as read, delete, or report as abuse
    path('messages/<int:pk>/readed', messageViewSet.as_view({'get': 'readed'}), name='message-readed'),
    path('messages/<int:pk>/delete', messageViewSet.as_view({'get': 'delete'}), name='message-delete'),
    path('messages/<int:pk>/abuse', messageViewSet.as_view({'get': 'abuse'}), name='message-abuse'),
    
    # Including URLs from router for DRF ViewSets
    path('', include(router.urls)),
]

# --- App: rides - File: models.py ---

"""
Rides App Models - Suroga API

This module contains the Django models for the 'rides' application within the Suroga API. These models define the essential
entities and concepts for the rides management system, such as Bookings, Rides, Communication Logs, Payment Logs, and
other related features.

Each model represents a table in the database and includes fields that correspond to the different columns within that table.
The models are equipped with attributes and methods to handle business logic, data integrity, and relationships between
different entities.

Usage:
    Instances of these models can be created, retrieved, updated, and deleted through Django's Object-Relational Mapping (ORM)
    layer, providing an abstraction over the database operations. The models are also used in Django's admin interface,
    views, and other parts of the application where ride-related data is needed.

References:
    - Django model reference: https://docs.djangoproject.com/en/4.0/ref/models/
    - Django ORM documentation: https://docs.djangoproject.com/en/4.0/topics/db/

The file structure and Django model conventions should be maintained to keep the models aligned with best practices
and the overall architecture of the Suroga API project.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
import datetime
import hashlib

from django.db import models, IntegrityError
from django.utils import timezone
from django.http import HttpResponse
from django.template.loader import render_to_string
from django.core.mail import EmailMessage

from django.contrib.auth import get_user_model
User = get_user_model()

from core.models import equipment, commchannel, country, districtregion, citymunicipality, RideDuration, image, sound, localwifi, publicevent
from kit.models import kitstock, kittype 
from supplier.models import contractsection, profilerepresentative, commtype
#from rides.models import rating, RideDuration, ServiceCategory,  ridetype, Ride, Booking, ContrSectionRideMkt, mettinglog

from core.extras import EmailThread
from django.conf import settings

# Create your models here.

class rating(models.Model):
    """
    Model representing a rating system used for grading rides, users, clients, and services.
    
    Attributes:
        Name: A label representing the rating classification (e.g., 'Excellent', 'Poor').
        Value: A numerical value associated with the rating (default is 2).
    """
    Name = models.CharField(max_length=20,  blank=False, help_text = "Classification")
    value = models.IntegerField(default=2, help_text= "Rating value")
    class Meta:
        verbose_name_plural = "Ratings"
    def __str__(self):
        return self.Name

class ServiceCategory(models.Model):
    """
    Model representing different categories of services offered.
    
    Attributes:
        Name: The name of the service category (e.g., 'Transportation', 'Delivery').
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "Service Category")
    class Meta:
        verbose_name_plural = "Service Categories"
    def __str__(self):
        return self.Name
        
class ridetype(models.Model):
    """
    Model representing different types of rides.
    
    Attributes:
        Name: The name of the ride type (e.g., 'Standard', 'VIP').
    """
    Name = models.CharField(max_length=100, unique=True, blank=False, help_text = "Ride type")
    class Meta:
        verbose_name_plural = "Ride Types"
    def __str__(self):
        return self.Name

class Ride(models.Model):
    """
    Model representing the details of a ride service.
    
    Attributes:
        (Several attributes such as user identification, service location, time fields, service descriptions, requisites, etc.
         Below is an example subset of these attributes for brevity.)
        User: A ForeignKey linking to the user who created the ride.
        ExternalMetaData: A TextField to store metadata added by the application.
        InternalMetaData: A TextField storing internal API metadata.
        PayedAtRegistration: A BooleanField indicating if payment was made upon registration.
        RideDate: A DateTimeField storing the date and time of the ride.
        ServiceTitle: A CharField for the title of the ride service.
        Description: A TextField describing the service.
        RegistrationDate: A DateTimeField storing when the ride was registered.
        HashKey: A CharField storing a unique hash key for the service identification.
    """
    # User identification
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=True, related_name='user_service')    
    ExternalMetaData = models.TextField(max_length=1000, blank=True, help_text = "APP metadata")
    InternalMetaData = models.TextField(max_length=1000, blank=True, help_text = "API metadata")
    PayedAtRegistration =  models.BooleanField(default=False, help_text = "Payment is made at the ride registration.")  
    #ServiceCategory = models.ForeignKey(ServiceCategory, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Service type") 
    
    # Service Localion
    Country = models.CharField(max_length=20, blank=True, help_text = "Country") 
    DistrictRegion = models.CharField(max_length=20, blank=True, help_text = "District/Region") 
    CityMunicipality = models.CharField(max_length=20, blank=True, help_text = "City/Municipality") 
    StreetName = models.CharField(max_length=100, blank=True, help_text = "Street name")
    StreetNumber = models.CharField(max_length=10, blank=True, help_text = "Street number")
    Floor = models.CharField(max_length=10, blank=True, help_text = "Floor")
    
    ZipCode = models.CharField(max_length=100, blank=True, help_text = "Zip Code part 1")
    #ZipCodeP2 = models.CharField(max_length=100, blank=True, help_text = "Zip Code part 2")
    GPS_latitude = models.DecimalField(max_digits=11, decimal_places=7,default=0, help_text = "location coordinates") 
    GPS_longitude = models.DecimalField(max_digits=11, decimal_places=7,default=0, help_text = "location coordinates") 
    Zoom_map = models.IntegerField(default=15, help_text = "Google maps zoom")
    GooglePlaceID = models.CharField(max_length=30, blank=True, editable=False, help_text = "Google place ID.")
    
    # time field
    #Time = models.TimeField(default=timezone.now, blank=True, help_text = "Ride time of the day.")
    
    # Service description
    RideDate  = models.DateTimeField(default=timezone.now,  blank=True, help_text = "Ride time and date.") 
    
    #Equipment = models.ForeignKey(equipment, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Equipment used")
    #RideType = models.ForeignKey(ridetype, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Ride type") 
    #PublicEvent = models.ForeignKey(publicevent, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Ride type") 
    #LocalWifi = models.ForeignKey(localwifi, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Ride type") 
    #Sound = models.ForeignKey(sound, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Ride type") 
    #Image = models.ForeignKey(image, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Ride type")   
    ServiceTitle = models.CharField(max_length=400, editable=True, blank=True, help_text = "Service title")
    Description = models.TextField(max_length=1000, blank=True, help_text = "Service Description") 
    #ExpectDuration = models.ForeignKey(RideDuration, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Expected service duration.") 
    
    RideType = models.CharField(default='', max_length=20, blank=True, help_text = "Ride Type") 
    ServiceCategory = models.CharField(default='', max_length=20, blank=True, help_text = "Service Category") 
    
    #configuration
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of this registration.")
    GeneratePaymentLink = models.BooleanField(default=False, help_text = "True if API requires payment link") 
    PaymentLink = models.CharField(max_length=100, blank=True, help_text = "Link in Stripe to use for payment.")  
    PaymentCODE = models.CharField(max_length=100, blank=True, help_text = "Payment proof code.") 

    #Status
    NotAvailable = models.BooleanField(default=False, help_text = "Servide not available by SurooAPI") 
    Blocked = models.BooleanField(default=False, help_text = "Ride blocked by SurooAPI") 
    Canceled = models.BooleanField(default=False, help_text = "Service canceled via API") 
    Deleted = models.BooleanField(default=False, help_text = "Service deleted via API.") 
    Closed = models.BooleanField(default=False, help_text = "Service closed via API.") 
    
    #Identification
    HashKey = models.CharField(max_length=30, blank=True, editable=False, help_text = "Service hash key.") 
    Request_Id = models.CharField(max_length=20, blank=True, editable=False, help_text = "API request ID")

    #Requisits
    Requisits = models.CharField(default='', max_length=1000, blank=True, editable=True, help_text = "Service Requisits") 



    class Meta:
        verbose_name_plural = "Rides Registered"
    
    def __str__(self):
        return self.ServiceTitle  # May vary depending on what identifies a ride instance best
            

    def save(self,force_insert=False, force_update=False, using=None):
        # Custom save method to include business logic
        if not self.HashKey:
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
            
        try:
            return  super(Ride, self).save()
        except Exception as exc:
            return exc 

class Booking(models.Model):
    """
    Model representing a booking made for a ride service.

    Attributes:
        user: A ForeignKey to the User model, representing the user associated with the booking.
        ExternalMetaData: Stores metadata provided by the app for the booking.
        InternalMetaData: Stores metadata used by the API for the booking.
        ride: A ForeignKey to the Ride model, linking a booking with the ride being booked.
        RideDate: A DateTimeField to specify the date for the appointment/booking.
        Sound: A ForeignKey to the sound model for potential sound requirements for the ride.
        Image: A ForeignKey to the image model for potential video requirements for the ride.
        Equipment: A ForeignKey to the equipment model for required equipment for the ride.
        localwifi: A ForeignKey to the localwifi model for required local wifi details.
        publicevent: A ForeignKey to the publicevent model for potential public event details.
        APIrequiresMettingURL: Indicates whether a meeting URL is required to be sent to the API.
        MeetingURL: Stores the meeting link if necessary for the booking.
        MeetingPasswd: Stores the meeting password or pin if necessary.
        RegistrationDate: Records when the booking was made, auto-set to the current time.
        Blocked: Indicates if a ride is blocked.
        Canceled: Indicates if the ride is canceled via the API.
        Deleted: Indicates if the ride is deleted via the API.
        ServiceTitle: Stores the title of the service being offered.
        Description: Provides a description for the service.
        ExpectDuration: A ForeignKey to the RideDuration model for expected service duration.
        FinalDuration: Stores the final distance to go or the duration it took.
        ExtraPrice: An additional cost for the service.
        SelectStock: Indicates if stock must be selected for the booking.
        Completed: Indicates if the service is selected as completed.
        StockSelected: Indicates if the stock was selected for the service.
        CanceledAgent: Indicates if the ride was canceled by the surrogate.
        RequisitsSatisfied: Indicates whether the requisites were satisfied for the ride.
        Expired: Indicates if the selection for the service has expired.
        Error: Indicates if there was an error in the selection process.
        Disputed: Indicates if the ride is in dispute.
        InvitationSend: Indicates if an invitation was sent to the surrogate.
        InvitationAccepted: Indicates if the surrogate has accepted the invitation.
        closed: Indicates if the service was completed.
        SystemInfo: Stores system information in JSON format.
        ErrorMessages: Records any error message that may have occurred.
        GeneratePaymentLink: Indicates if a payment link generation is needed.
        PaymentLink: Stores the payment link for the service if needed.
        PaymentCODE: Stores the payment proof code.

        # Fields for Dashboard links, Rankings, Ride info, and Stock info are also included.
    """
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=True, related_name='Booking_service')    
    ExternalMetaData = models.TextField(max_length=1000, blank=True, help_text = "APP metadata")
    InternalMetaData = models.TextField(max_length=1000, blank=True, help_text = "API metadata")

    # Ride registration
    ride = models.ForeignKey(Ride,on_delete=models.SET_NULL, null=True, blank=True, related_name='Booking_booking')    

    # Ride date
    RideDate  = models.DateTimeField(default=timezone.now,  blank=False, help_text = "Appointment date.") 
    Sound = models.ForeignKey(sound, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Sound requisits") 
    Image = models.ForeignKey(image, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Video requisits")   
    Equipment = models.ForeignKey(equipment, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Required equipment", related_name='service_equipment') 
    localwifi = models.ForeignKey(localwifi, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Local wifi", related_name='service_wifi') 
    publicevent = models.ForeignKey(publicevent, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Public event", related_name='service_public') 
    
    
    # Meeting config
    APIrequiresMettingURL = models.BooleanField(default=True, help_text = "True if meeting URL must be sent to API")
    MeetingURL = models.CharField(max_length=100, editable=True, blank=True, help_text = "The meeting link")
    MeetingPasswd = models.CharField(max_length=100, editable=True, blank=True, help_text = "The meeting password/pin")
    
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of this registration.")

    # Satus
    Blocked = models.BooleanField(default=False, help_text = "Ride blocked by Suroga.") 
    Canceled = models.BooleanField(default=False, help_text = "Ride canceled via API") 
    Deleted = models.BooleanField(default=False, help_text = "Ride deleted via API") 

    # Service description
    ServiceTitle = models.CharField(max_length=400, editable=True, blank=True, help_text = "Service title")
    Description = models.TextField(max_length=1000, blank=True, help_text = "Service Description") 
    ExpectDuration = models.ForeignKey(RideDuration, on_delete=models.SET_NULL, null=True, blank=True, help_text = "Expected service duration.") 
    FinalDuration = models.DecimalField(max_digits=5, decimal_places=2,default=0, help_text = "Distance to go in doing the service.")
    ExtraPrice = models.DecimalField(max_digits=5, decimal_places=2,default=0.0, help_text = "Extra price.")
    
    # configuration
    SelectStock = models.BooleanField(default=False, help_text = "True if stock must be selected") 
    Completed = models.BooleanField(default=False, help_text = "True if service selected") 
    StockSelected = models.BooleanField(default=False, help_text = "True if stock was selected") 
    CanceledAgent = models.BooleanField(default=False, help_text = "True if ride canceled by surrogate") 
    RequisitsSatisfied = models.BooleanField(default=False, help_text = "True if ride riquisites were satisfied") 
    Expired = models.BooleanField(default=False, help_text = "True if selection expired") 
    Error = models.BooleanField(default=False, help_text = "True if error on seelction process") 
    Disputed = models.BooleanField(default=False, help_text = "True if ride is in dispute") 
    InvitationSend = models.BooleanField(default=False, help_text = "True if invitation was sent to surrogate")
    InvitationAccepted = models.BooleanField(default=False, help_text = "True if invitation was accepted by surrogate")
    closed = models.BooleanField(default=False, help_text = "True if service was completed")

    # System status
    SystemInfo = models.TextField(max_length=1000, blank=True, help_text = "JSON: System information")
    ErrorMessages = models.TextField(max_length=100, blank=True, help_text = "Error message")

    #Payment
    GeneratePaymentLink = models.BooleanField(default=False, help_text = "True if API requires payment link") 
    PaymentLink = models.CharField(max_length=100, blank=True, help_text = "Link in Stripe to use for payment.")  
    PaymentCODE = models.CharField(max_length=100, blank=True, help_text = "Payment proof code.") 

    # Dashboards
    APIrequiresDashboardURL = models.BooleanField(default=True, help_text = "True if API requires dashdoards") 
    DashboardClientURL = models.CharField(max_length=100, blank=True, editable=True, help_text = "Client dasboard on surooAPI") 
    ClientKey = models.CharField(max_length=10, blank=True, help_text = "Client Key")
    DashboardSurrogateURL = models.CharField(max_length=100, blank=True, editable=True, help_text = "Surrogate dasboard on surooAPI") 
    SurrogateKey = models.CharField(max_length=10, blank=True, help_text = "Client Key")

    # Ranking
    AgentRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Surrogate rating", related_name='booking_surrrank') 
    ClientRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Client rating", related_name='booking_clientrank') 
    SupplierARank= models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier A rating", related_name='booking_Arank') 
    SupplierBRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier B rating", related_name='booking_Brank')
    SupplierCRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier C rating", related_name='booking_Crank')
    SupplierDRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier D rating", related_name='booking_Drank')
    SupplierERank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier E rating", related_name='booking_Erank')
    SupplierFRank = models.ForeignKey(rating, on_delete=models.CASCADE, null=True, blank=True, help_text = "Supplier F rating", related_name='booking_Fank')

    # Ride
    RideStarted = models.BooleanField(default=False, help_text = "Ride started.") 
    RideEnded = models.BooleanField(default=False, help_text = "Ride ended.") 
    RideStartDate = models.DateTimeField(default=timezone.now, editable=True, help_text = "Date ride start.")
    RideEndDate = models.DateTimeField(default=timezone.now, editable=True, help_text = "Date ride end.")
    
    #Identification
    HashKey = models.CharField(max_length=30, blank=True, editable=False, help_text = "Service hash key.") 
    Request_Id =  models.CharField(max_length=20, blank=True, editable=False, help_text = "API request ID")
    
    #Ride Stock
    KitPack = models.ForeignKey(kitstock, on_delete=models.CASCADE, null=True, blank=True, help_text = "kit", related_name='booking_kit')
    Kit_Ref_Number=  models.CharField(max_length=15, blank=True, editable=False, help_text = "Kit Ref Number")
    Surrogate = models.ForeignKey(User, on_delete=models.CASCADE, null=True, blank=True, help_text = "Surrogate with account", related_name='booking_agent')
    Stock_Id = models.IntegerField(default=0, help_text = "Stock Id")
    
    class Meta:
        verbose_name_plural = "Rides Booked" # The plural name for the model in the admin interface.
    
    def __str__(self):
        return self.ServiceTitle  # Human-readable string representation of the model, returning the ServiceTitle.
    

    def save(self,force_insert=False, force_update=False, using=None):
        """
        Custom save method for Booking models. Upon saving, it may trigger an email to be sent
        and ensure unique hash keys are generated for identification. If there are specific country
        settings, they can be applied here as well.

        Also included is a threaded approach to send emails in the background.
        """
        
        # An email is composed and sent to a back-office email address to notify about the booking.
        
        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET

        message = render_to_string('emails_backoffice/booking_ride.html', {
            'UserID': self.user.pk,
            'User': self.user.username,
            'RideID': self.ride.pk,  
            'Title': self.ride.ServiceTitle,
            'BookingID': self.pk, 
            'RideDate': self.RideDate 
        })
        msg = EmailMessage('Support: Booking Ride',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        # Generate a unique HashKey if not already set.

        if not self.HashKey:
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
        return super(Booking, self).save()

        # Error handling for the save operation.
        try:
            return super(Booking, self).save()
        except Exception as exc:
            return exc

class ContrSectionRideMkt(models.Model):
    """
    Model representing stock in the context of a ride service market, particularly for contract sections.

    Attributes:
        Name: A name to identify a service or stock item.
        user: A ForeignKey linking to the User that is related to this stock item.
        Ride: A ForeignKey linking to a specific Ride that this stock item is associated with.
        rank: An IntegerField representing the rank or priority of the stock item.
        miss: A CharField specifying any items that are missing from the stock.
        ContractSection[A-F]: ForeignKeys linking to various `contractsection` instances.
        KitType: A ForeignKey linking to the required kit type for this stock item.
        KitRequired: A BooleanField indicating whether a kit is required.
        ContractPrice[A-F]: DecimalFields representing prices for different contract sections.
        TotalPrice: A DecimalField representing the total price for the ride.
        HashKey: A CharField that stores a unique hash key for identification.
        Selected: A BooleanField indicating whether the stock item has been selected or started.
        RequiredConfigTime: A DecimalField stating the time required for configuration.
        setting: A TextField to store JSON configuration settings for the ride.
    """
    Name = models.CharField(default="Test",max_length=50, unique=False, blank=False, help_text = "Service name")
    user = models.ForeignKey(User,on_delete=models.SET_NULL, null=True, blank=True, related_name='stock_user')    
    Ride = models.ForeignKey(Ride,on_delete=models.SET_NULL, null=True, default=None, blank=True, related_name='market_booking')    
    rank = models.IntegerField(default=0, help_text = "Item rank")
    miss = models.CharField(max_length=300, blank=True, help_text = "Items missing") 
    ContractSectionA = models.ForeignKey(contractsection , on_delete=models.CASCADE, null=False, blank=False, help_text = "Contract Section A", related_name='market_sectionA') 
    ContractSectionB = models.ForeignKey(contractsection, on_delete=models.CASCADE, null=True, blank=True, help_text = "Contract Section B", related_name='market_sectionB') 
    ContractSectionC = models.ForeignKey(contractsection, on_delete=models.CASCADE, null=True, blank=True, help_text = "Contract Section C", related_name='market_sectionC')
    ContractSectionD = models.ForeignKey(contractsection, on_delete=models.CASCADE, null=True, blank=True, help_text = "Contract Section D", related_name='market_sectionD')
    ContractSectionE = models.ForeignKey(contractsection, on_delete=models.CASCADE, null=True, blank=True, help_text = "Contract Section E", related_name='market_sectionE')
    ContractSectionF = models.ForeignKey(contractsection, on_delete=models.CASCADE, null=True, blank=True, help_text = "Contract Section F", related_name='market_sectionF')
    KitType = models.ForeignKey(kittype, on_delete=models.CASCADE, null=True, blank=True, help_text = "Kit required", related_name='market_kit')
    KitRequired = models.BooleanField(default=False, help_text = "Kit required") 
    ContractPriceA = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract A")
    ContractPriceB = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract B")
    ContractPriceC = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract C")
    ContractPriceD = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract D")
    ContractPriceE = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract E")
    ContractPriceF = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Price contract F")
    TotalPrice = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Total Price")
    HashKey = models.CharField(max_length=30, blank=True, editable=True, help_text = "Market hash key") 
    Selected = models.BooleanField(default=False, help_text = "Option started") 
    RequiredConfigTime  = models.DecimalField(max_digits=6, decimal_places=2,default=0, help_text = "Required config time (hours)")
    setting = models.TextField(max_length=1000, blank=True, help_text = "JSON: ride setting") 


    class Meta:
        verbose_name_plural = "Section Ride Market" # Reflects the human-readable name for the object in plural form
    

    
    def save(self,force_insert=False, force_update=False, using=None):
        """
        Overrides the default save method to generate a hash key before saving if it doesn't exist yet.

        The generated hash key is based on the current date, time, and the primary key value of the instance.
        """
        if not self.HashKey:
            # Generating the hash key based on the instance's primary key, current date, and time.
            data = datetime.date.today()
            time = datetime.datetime.today()
            code = str(self.pk)+str(data)+str(time)
            self.HashKey = hashlib.sha1(code.encode()).hexdigest()
        
        # Attempt to save the instance using the superclass's save method
        
        return super(ContrSectionRideMkt, self).save()

        try:
            return super(ContrSectionRideMkt, self).save()
        except Exception as exc:
            return exc


class mettinglog(models.Model):
    """
    Model for logging meeting-related actions and statuses.

    Attributes:
        Ride: A ForeignKey linking to the `Booking` with which the meeting is associated.
        ActionType: A CharField indicating the type of action in the meeting log.
        DateTime: A DateTimeField recording the date and time of the entry.
        Status: A CharField indicating the current status of the meeting.
    """
    Ride = models.ForeignKey(Booking,on_delete=models.SET_NULL, null=True, blank=True, related_name='meeting_booking')     
    ActionType = models.CharField(max_length=20, unique=True, blank=False, help_text = "Action type")
    DateTime = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date")
    Satus = models.CharField(max_length=20, unique=True, blank=False, help_text = "Metting status")

    class Meta:
        verbose_name_plural = "Meeting Log" # Reflects the human-readable name for the object in plural form



class commlog(models.Model):
    """
    Model used for logging communication events related to ride services. 

    Attributes:
        POC: A reference to 'profilerepresentative', indicating the point of contact for the communication.
        Ride: A ForeignKey to the 'Booking' model - denoting which booking the communication pertains to.
        Contract: A ForeignKey to 'contractsection', showing which contract section is relevant to the communication.
        DateTime: A DateTimeField capturing the exact date and time when the communication took place.
        Message: A TextField storing the actual content of the communication message.
        Comm_Type: A ForeignKey to 'commtype', defining the type of communication that occurred.
        Attributes: A TextField to hold any additional JSON-formatted communication attributes.

    The Meta class sets the plural name for use within the Django admin site.
    """
    POC = models.ForeignKey(profilerepresentative,on_delete=models.SET_NULL, null=True, blank=True,related_name='comm_POC')   
    Ride = models.ForeignKey(Booking,on_delete=models.SET_NULL, null=True, blank=True,related_name='comm_Ride')   
    Contract = models.ForeignKey(contractsection,on_delete=models.SET_NULL,null=True, blank=True, related_name='comm_contractsection') 
    DateTime = models.DateTimeField(default=timezone.now) 
    Message = models.TextField(max_length=1000, blank=True, help_text = "Comm message") 
    Comm_Type = models.ForeignKey(commtype,on_delete=models.SET_NULL, null=True, blank=True, related_name='comm_Type') 
    Attributes = models.TextField(max_length=1000, blank=True, help_text = "JSON: comm att") 

    class Meta:
        verbose_name_plural = "Communication Logs"


class paymentlog(models.Model):
    """
    Model for recording detailed payment transaction information.

    Attributes:
        user: A ForeignKey to Django's built-in User model, associating a payment log with a specific user.
        PlantformUserType: A field specifying the type of the platform user involved in the transaction.
        OperationType: A field specifying the type of operation (e.g., deposit, withdrawal).
        SettlementDate: A DateTimeField recording when the transaction was settled.
        PaymMethodResul: A field indicating the result of the payment method transaction.
        StripTransactionID: A field storing the transaction ID from the Stripe service.
        SurooBankTransactionID: A field storing a transaction ID from Suroo's banking service.
        Ride: A ForeignKey to 'Booking' that associates the payment with a particular ride.
        Booking: Another ForeignKey to 'Booking', which might be redundant or for a different purpose (requires clarification).
        Value: A DecimalField capturing the value amount of the transaction.
        is_debit: A BooleanField indicating whether the transaction is a debit.
        RegistrationDate: A DateTimeField marking when the payment log entry was created.

    The Meta class defines the plural name for the model as it will appear in the Django admin.
    """
    user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "payment_user") 
    PlantformUserType = models.CharField(max_length=10, unique=True, blank=False, help_text = "User type")
    OperationType = models.CharField(max_length=10, unique=True, blank=False, help_text = "Operation type")
    SettlementDate  = models.DateTimeField(default=timezone.now, editable=False, help_text = "Transation settlement date")
    PaymMethodResul = models.CharField(max_length=100, unique=True, blank=False, help_text = "Payment result")
    StripTransactionID = models.CharField(max_length=20, unique=True, blank=False, help_text = "Strip Transation ID")
    SurooBankTransactionID = models.CharField(max_length=20, unique=True, blank=False, help_text = "Bank Transation ID")  
    Ride = models.ForeignKey(Booking,on_delete=models.SET_NULL, null=True, blank=True,related_name='payment_ride')   
    Booking = models.ForeignKey(Booking,on_delete=models.SET_NULL, null=True, default=None, blank=True, related_name='payment_booking')
    Value  = models.DecimalField(max_digits=12, decimal_places=8, default=0, help_text = "Value") 
    is_debit= models.BooleanField(default=False, help_text = "True if it is a debit.")
    RegistrationDate = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of this registration.")


    class Meta:
        verbose_name_plural = "Payment log"

class MessageBoard(models.Model):
    """
    Model for managing messages between users and related to specific bookings within the ride service.

    Attributes:
        user: A ForeignKey to Django's built-in User model, which references the user sending or receiving the message.
        booking: A ForeignKey linking a message to a booking, indicating which booking the message is pertinent to.
        SendByClient: A BooleanField that shows whether the sender of the message is the client.
        Text: A TextField that contains the body content of the message.
        Read: A BooleanField indicating whether the message has been read by the recipient.
        Date: A DateTimeField stamping the creation date and time of the message.
        deleted: A BooleanField indicating if the message was deleted by the sender.
        Abuse: A BooleanField indicating if the message was marked as abusive by the recipient.

    """
    user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, default="", help_text = "API_user", related_name='message_user') 
    booking = models.ForeignKey(Booking,on_delete=models.CASCADE, null=True, default=None, blank=True, related_name='message_booking')
    SendByClient = models.BooleanField(default=False, help_text = "True if message was sent by client")
    
    Text = models.TextField(max_length=2000, blank=True, help_text = "Message body") # Text
    Read = models.BooleanField(default=False, help_text = "Message was readed") # True if message was readed
    Date = models.DateTimeField(default=timezone.now, editable=False, help_text = "Date of this registration.")
    deleted = models.BooleanField(default=False, help_text = "deleted by sender")
    Abuse = models.BooleanField(default=False, help_text = "Classified abusive by recipient")
    
    class Meta:
        verbose_name_plural = "Message Boards"  # How the model is referred to in the admin interface in plural form



# --- App: rides - File: __init__.py ---



# --- App: rides - File: views.py ---

"""
Rides App ViewSets - Suroga API

This module contains the viewsets for the 'rides' application within the Suroga API.
ViewSets in Django REST Framework provide a way to combine logic for a set of related views.
These classes define the behavior and permissions for API endpoints associated with Ride management,
including booking of rides, management of ride stock items, and handling of messages on the message board.

Usage:
    These viewsets are used to create RESTful APIs and are typically routed in the app's urls.py file.
    They provide a rich interface for interacting with the models over HTTP with JSON.

Features:
    - Standard CRUD operations for both stock items and messages via ModelViewSet.
    - Custom actions for additional business logic like selecting, reading, and deleting items.
    - Token-based authentication and permission classes for protected API access.

References:
    - Django REST Framework ViewSets: https://www.django-rest-framework.org/api-guide/viewsets/
    - Django Authentication: https://docs.djangoproject.com/en/4.0/topics/auth/default/
    - Permissions: https://www.django-rest-framework.org/api-guide/permissions/

The classes and methods should be carefully maintained and extended with caution to ensure the API's integrity and consistency across different clients.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""

import json
import datetime
from django.shortcuts import render

from rest_framework import status
from rest_framework.response import Response
from rest_framework.permissions import BasePermission, IsAuthenticated,IsAuthenticatedOrReadOnly
from rest_framework.authentication import TokenAuthentication
from rest_framework import viewsets
from rest_framework.decorators import action
from rest_framework.views import APIView
from django.utils import timezone

from django.core import serializers as core_serializers 

from rides.models import MessageBoard, ContrSectionRideMkt, Booking,rating, ServiceCategory, Ride, ridetype
from rides.serializers import MessageBoardSerializer, stockSerializer, ratingSerializer, servicecategorySerializer, ridetypeSerializer, rideSerializer
from rides.serializers import bookingSerializer
from django.core.mail import EmailMessage
from django.template.loader import render_to_string
from core.extras import EmailThread
from django.conf import settings

from supplier.models import  servicetype, contractsection
from rides.models import MessageBoard, Ride, ContrSectionRideMkt
from core.models import publicevent, localwifi, equipment, image, sound, RideDuration, commchannel, country, districtregion, citymunicipality
from django.db.models import Q

from django.core.exceptions import ObjectDoesNotExist as DoesNotExist

# rating: ViewSets define the view behavior.
class ratingViewSet(viewsets.ModelViewSet):
    """
    API endpoint that provides access to rating operations.

    It allows for the retrieval, creation, update, and deletion of rating entries.
    Authentication is enforced via token, and only authenticated users can interact with this viewset.
    

    Retrieve: ['pk','Name','value']
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = rating.objects.all()
    serializer_class = ratingSerializer

# Service Category: ViewSets define the view behavior.
class servicecategoryViewSet(viewsets.ModelViewSet):
    """
    API endpoint that allows operations on service categories.

    Provides a standard interface for CRUD operations on the ServiceCategory model items.
    

    Retrieve: ['pk','Name']
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = ServiceCategory.objects.all()
    serializer_class = servicecategorySerializer

# ridetype: ViewSets define the view behavior.
class ridetypeViewSet(viewsets.ModelViewSet):
    """
    API endpoint for handling ride types.

    Accessible to authenticated users to view, create, modify, or delete ride types.
    

    Retrieve: ['pk','Name']
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = ridetype.objects.all()
    serializer_class = ridetypeSerializer

def loadset(rideSet):
    """
    Aggregates different ride set items into a unique set.
    
    It adds equipment, extras, and channel information into a set, excluding any empty strings.
    
    Args:
        rideSet (dict): A dictionary containing 'equipment', 'extras', and 'channel' keys.

    Returns:
        set: A set containing unique service items.
    """
    # Initialize a set and gather service items from rideSet
    serviceSet = set()
    serviceSet.add(rideSet['equipment'])
    serviceSet = serviceSet | (set(rideSet['extras']) - {''})
    serviceSet.add(rideSet['channel'])
    return serviceSet

def price(sectioVariant, date, duration, price_type):
    """
    Calculates the price based on section variant configurations.

    Args:
        sectioVariant (str): A JSON string representing variant configurations including pricing details.
        date (datetime): The starting date and time of the service.
        duration (int): The duration of the service in minutes.
        price_type (str): A string representing the type of price to apply.

    Returns:
        float: The calculated price based on the provided parameters.
    """
    data = json.loads(sectioVariant)[0]
    if 'time_in' in data:
        inTime, price1, price2 = data['time_in']
        if 'time_out' in data:
            outTime1, outTime2 = data['time_out']

        startTime = date.time()

        endTime = (date + datetime.timedelta(minutes = duration)).time()

        if datetime.time.fromisoformat(inTime[0]) <= startTime <= datetime.time.fromisoformat(inTime[1]) and datetime.time.fromisoformat(inTime[0]) <= endTime <= datetime.time.fromisoformat(inTime[1]):
            return price1
        return price2
    if 'price' in data:
        return data['price']
    return 0



# Ride: ViewSets define the view behavior.
class rideViewSet(viewsets.ModelViewSet): 
    """
    A viewset that provides the standard actions to be performed on the Ride model instances.

    Custom actions for canceling, deleting, requesting a payment link, 
    and closing a ride are defined to accommodate specific business logic.
    
    
    The create method is overridden to include custom logic for ride creation. This logic involves sending notifications, validation of data before saving the ride, and determining the available stock based on requisites. If threading is used to send emails, ensure that the threading implementation is imported and handled correctly to prevent blocking the request/response cycle. Error handling is also done within the method, which dictates the responses returned to the client.

    Custom actions like cancel, delete, paymentlink, and close are added to the rideViewSet using the @action decorator. These actions extend the functionality of the viewset beyond the standard CRUD operations, providing endpoints for ride-specific business actions and reflect state changes that may happen to a ride after it's initially created.

    The get_queryset method has been customized to filter queryset dynamically based on query parameters passed in the request. This enables frontend clients to filter rides based on specific criteria supplied by the user.

    It's important to note that sending emails and performing business logic in the viewset methods should be optimized so they don't affect the performance of the application. Long-running tasks should ideally be handled asynchronously, outside the request/response cycle (e.g., by using Django's background task processing capabilities or a task queue like Celery).

    Additionally, this code assumes that a function named loadset, a model named ContrSectionRideMkt and serializers named rideSerializer and stockSerializer are defined somewhere in the project. The queryset filtering in get_queryset also refers to models country, districtregion, and citymunicipality which must be imported to function correctly. Also, make sure to import the necessary methods, such as DoesNotExist exception, to handle specific model query exceptions.
    """
    # Token authentication and the requirement that users are authenticated to access this viewset
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = Ride.objects.all() # Gives access to all ride instances for super users or view filtering
    serializer_class = rideSerializer # Specifies the serializer for this viewset to handle requests and responses

    
    def create(self, request, *args, **kwargs):
        """
        Overridden create method with additional logic to send emails and process booking conditions, etc.
        """
        serializer = self.get_serializer(data=request.data)
        if not serializer.is_valid(raise_exception=False):
            return Response({"Fail": "blablal"}, status=status.HTTP_400_BAD_REQUEST)

        self.perform_create(serializer)

        headers = self.get_success_headers(serializer.data)
        
        pk = int(serializer.data['pk'])
        ServiceTitle = serializer.data['ServiceTitle']
        
        #if CountryID:
        #    comm = commchannel.objects.filter(Country = CountryID)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET

        message = render_to_string('emails_backoffice/ride_registration.html', {
            'UserID': request.user.pk,
            'User': request.user.username,
            'RideID': pk,  
            'Title': ServiceTitle, 
            'URL': settings.DOMAIN+'/admin/rides/ride/'+str(pk)+'/change/', 
            'STATUS': 'Registred',
        })
        msg = EmailMessage('Support: Ride registration',message, to=[mail_backoffice])
        
        #EmailThread(msg).start()

        ###
        # Create stock list
        ###
        StreetName = serializer.validated_data['StreetName']

        if not StreetName:
            return Response({"Success": 0, "Error": 'L000', "Message": "Street name required by Suroo API","ride": serializer.data,"stock":[]})


        # Services requirements
        #ExpectDuration = serializer.validated_data['ExpectDuration']

        # Services requirements
        Country = serializer.validated_data['Country']
        ServiceCategory = serializer.validated_data['ServiceCategory']
        RideType = serializer.validated_data['RideType']
        #PublicEvent = serializer.validated_data['PublicEvent']
        #LocalWifi = serializer.validated_data['LocalWifi']
        #Sound = serializer.validated_data['Sound']
        #Image = serializer.validated_data['Image']
        #ExpectDuration = serializer.validated_data['ExpectDuration']
        
        RideDate = serializer.validated_data['RideDate']
        
        Requisits = serializer.validated_data['Requisits']

        
        RequestSet = loadset(json.loads(Requisits)[0]) 

        #services = servicetype.objects.filter(Q(Duration=ExpectDuration),Q(Image=Image),Q(Sound=Sound),Q(LocalWifi=LocalWifi),Q(PublicEvent=PublicEvent))
        services = servicetype.objects.all()
        

        servicesRank = []
        for service in services:
            setting = json.loads(service.ServiceSetting)
            print(setting)
            serviceSet = loadset(setting[0])
            rank = RequestSet - serviceSet
            servicesRank.append((len(rank),service,rank,serviceSet))

        # Local
        
        CountryName = serializer.validated_data['Country']       
        if not CountryName:
            return Response({"Success": 0, "Error": 'L001', "Message": "Country required by Suroo API","ride": serializer.data,"stock":[]})

        DistrictRegionName = serializer.validated_data['DistrictRegion']
        if not DistrictRegionName:
            return Response({"Success": 0, "Error": 'L002', "Message": "District or region name required by Suroo API","ride": serializer.data,"stock":[]})

        CityMunicipalityName = serializer.validated_data['CityMunicipality']
        if not CityMunicipalityName:
            return Response({"Success": 0, "Error": 'L003', "Message": "City and municipality name required by Suroo API","ride": serializer.data,"stock":[]})

        try:
            CountryID = country.objects.get(Name = CountryName)
        except DoesNotExist:
            return Response({"Success": 0, "Error": 'L011', "Message": "Country isn't covered by Suroo API", "ride": serializer.data,"stock":[]})

        try:
            DistrictRegionID = districtregion.objects.get(Name = DistrictRegionName)
        except DoesNotExist:
            return Response({"Success": 0, "Error": 'L012', "Message": "District or region isn't covered by Suroo API", "ride": serializer.data,"stock":[]})

        try:
            CityMunicipalityID = citymunicipality.objects.get(Name = CityMunicipalityName)
        except DoesNotExist:
            return Response({"Success": 0, "Error": 'L013', "Message": "City or municipality isn't covered by Suroo API", "ride": serializer.data,"stock":[]})

        contracts = contractsection.objects.filter(Q(is_active=True), Q(Country=CountryID), Q(DistrictRegion=DistrictRegionID) | Q(DistrictRegion__isnull = True), Q(CityMunicipality=CityMunicipalityID) | Q(CityMunicipality__isnull = True)) 


        stock={}
        for rank, record, miss, serviceSet in servicesRank:
            stock[record.pk]={'Name':record.Name, 'rank': rank, 'miss':miss, 'serviceSet': serviceSet, 'Contracts':{}}
            for item in contracts: 
                if item.contract.contract_type.pk==1:
                    if 1 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][1]=[]
                    stock[record.pk]['Contracts'][1].append(item)

                if record.ContractB and item.contract.contract_type.pk==2:
                    if 2 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][2]=[]
                    stock[record.pk]['Contracts'][2].append(item)

                if record.ContractC and item.contract.contract_type.pk==3:
                    if 3 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][3]=[]
                    stock[record.pk]['Contracts'][3].append(item)

                if record.ContractD and item.contract.contract_type.pk==4:
                    if 4 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][4]=[]
                    stock[record.pk]['Contracts'][4].append(item)

                if record.ContractE and item.contract.contract_type.pk==5:
                    if 5 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][5]=[]
                    stock[record.pk]['Contracts'][5].append(item)

                if record.ContractF and item.contract.contract_type.pk==6:
                    if 6 not in stock[record.pk]:
                        stock[record.pk]['Contracts'][6]=[]
                    stock[record.pk]['Contracts'][6].append(item)
 
        
        rideIdx = Ride.objects.get(pk=pk)
        stockMkt = []
        for idS in stock:
            item = stock[idS]['Contracts']
            Mkt = ContrSectionRideMkt()
            Mkt.miss = json.dumps(list(stock[idS]['miss']))
            Mkt.rank = stock[idS]['rank']
            Mkt.setting = json.dumps(list(stock[idS]['serviceSet']))
            Mkt.Name = stock[idS]['Name']
            Mkt.user = request.user
            Mkt.Ride = rideIdx
            Mkt.TotalPrice = 0
            Mkt.RequiredConfigTime = 0
            for id in item:
                PriceItem = 0
                if id == 1:
                    Mkt.ContractSectionA = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1) 
                    Mkt.ContractPriceA = PriceItem

                if id == 2:
                    Mkt.ContractSectionB = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1)
                    Mkt.ContractPriceB = PriceItem

                if id == 3:
                    Mkt.ContractSectionC = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1)
                    Mkt.ContractPriceC = PriceItem

                if id == 4:
                    Mkt.ContractSectionD = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1)
                    Mkt.ContractPriceD = PriceItem

                if id == 5:
                    Mkt.ContractSectionE = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1)
                    Mkt.ContractPriceE = PriceItem

                if id == 6:
                    Mkt.ContractSectionF = item[id][0]
                    PriceItem = price(item[id][0].variante,RideDate,30,1)
                    Mkt.ContractPriceF = PriceItem

                Mkt.TotalPrice += PriceItem
                Mkt.RequiredConfigTime = max(Mkt.RequiredConfigTime,item[id][0].RequiredMaxConfigTime)
            
            Mkt.save()
            stockMkt.append(Mkt)
        
        stockMkt = ContrSectionRideMkt.objects.filter(Ride = rideIdx)
        
        if len(stockMkt) == 0:
            return Response({"Success": 0, "Error": 'S020', "Message": "Service isn't available by Suroo API for your location.", "ride": serializer.data,"stock":[]})

        # match services
        #kwargs["stock"] = contracts

        return Response({"Success": 1, "stock":stockSerializer(stockMkt,many=True).data, "ride": serializer.data}, status=status.HTTP_201_CREATED, headers=headers)

    # A custom action for canceling a ride
    @action(detail=True, methods=['get'], name='Cancel ride')
    def cancel(self, request, pk=None):
        try:
            with transaction.atomic():
                # Ride cancellation logic including email notification goes here...
                ride = self.get_object()
                ride.Canceled = True
                ride.save()
                #if self.Country:
                #    comm = commchannel.objects.filter(Country = self.ride.Country)
                #    mail_backoffice = comm.mail_ride
                #else:
                mail_backoffice = settings.EMAILMARKET

                message = render_to_string('emails_backoffice/ride_status_changed.html', {
                    'UserID': ride.user.pk,
                    'User': ride.user.username,
                    'RideID': ride.pk,  
                    'Title': ride.ServiceTitle,
                    'URL': settings.DOMAIN+'/admin/rides/ride/'+str(ride.pk)+'/change/', 
                    'STATUS': 'Cancel',
                })
                msg = EmailMessage('Support: Ride canceled',message, to=[mail_backoffice])
                EmailThread(msg).start()
        
            return Response({'status': 'OK','ride': core_serializers.serialize('json', [ride,])})
        
        except Exception as e:
            logging.error(f"Ride cancellation failed: {e}")
            return Response({'status': 'error', 'detail': str(e)}, status=500)
            
    # A custom action for deleting a ride
    @action(detail=True, methods=['get'], name='Remove ride')
    def delete(self, request, pk=None):
        # Ride deletion logic goes here...
        ride = self.get_object()
        booking = Booking.objects.filter(ride=ride)
        if booking:
            return Response({'status': 'ERROR','Error':'100','Message': 'You have a assigment to this ride','ride':  core_serializers.serialize('json', [ride,])})
        ride.Deleted = True # add condition
        ride.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET

        message = render_to_string('emails_backoffice/ride_status_changed.html', {
            'UserID': ride.user.pk,
            'User': ride.user.username,
            'RideID': ride.pk,  
            'Title': ride.ServiceTitle,
            'URL': settings.DOMAIN+'/admin/rides/ride/'+str(ride.pk)+'/change/', 
            'STATUS': 'Delete',
        })
        msg = EmailMessage('Support: Ride deleted',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','ride': core_serializers.serialize('json', [ride,])})

    # A custom action for requesting a payment link
    @action(detail=True, methods=['get'], name='Request payment link')
    def paymentlink(self, request, pk=None):
        # Payment link request logic goes here...
        ride = self.get_object()
        ride.GeneratePaymentLink = True # reques payment link
        ride.PaymentLink = 'xxx999xxx'
        ride.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET

        message = render_to_string('emails_backoffice/ride_paymentlink.html', {
            'UserID': ride.user.pk,
            'User': ride.user.username,
            'RideID': ride.pk,  
            'Title': ride.ServiceTitle, 
            'PaymentLink': ride.PaymentLink,
            'URL': settings.DOMAIN+'/admin/rides/ride/'+str(ride.pk)+'/change/', 
            'STATUS': 'Paymentlink',
        })
        msg = EmailMessage('Support: Ride Payment Link',message, to=[mail_backoffice])
        
        
        EmailThread(msg).start()

        return Response({'status': 'OK','ride': core_serializers.serialize('json', [ride,])})

    # A custom action for closing a ride
    @action(detail=True, methods=['get'], name='Close ride')
    def close(self, request, pk=None):
        # Ride closing logic goes here...
        ride = self.get_object()
        ride.Closed = True
        ride.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/ride_status_changed.html', {
            'UserID': ride.user.pk,
            'User': ride.user.username,
            'RideID': ride.pk,  
            'Title': ride.ServiceTitle, 
            'URL': settings.DOMAIN+'/admin/rides/ride/'+str(ride.pk)+'/change/',
            'STATUS': 'Close',
        })
        msg = EmailMessage('Support: Ride Closed',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK', 'ride': core_serializers.serialize('json', [ride,])})
   
    def get_queryset(self):
        """
        Custom queryset filtering based on the request's parameters.

        Filters applied include Country, DistrictRegion, CityMunicipality, ServiceCategory, 
        RideType, and flags such as Blocked, Canceled, and Deleted, among others.
        """
        queryset = Ride.objects.filter(user=self.request.user, Closed=False)
        Country = self.request.query_params.get('Country')
        DistrictRegion = self.request.query_params.get('DistrictRegion')
        CityMunicipality = self.request.query_params.get('CityMunicipality')
        ServiceCategory = self.request.query_params.get('ServiceCategory')
        RideType = self.request.query_params.get('RideType')
        Blocked = self.request.query_params.get('Blocked')
        Canceled = self.request.query_params.get('Canceled')
        Deleted = self.request.query_params.get('Deleted')
        
        #Todo: Error ID --> Query by ID --> record
        if Country is not None:
            queryset = queryset.filter(Country=Country)
        if DistrictRegion is not None:
            queryset = queryset.filter(DistrictRegion=DistrictRegion)
        if CityMunicipality is not None:
            queryset = queryset.filter(CityMunicipality=CityMunicipality)
        if ServiceCategory is not None:
            queryset = queryset.filter(ServiceCategory=ServiceCategory)
        if RideType is not None:
            queryset = queryset.filter(RideType=RideType)
        if Blocked is not None:
            if Blocked == '1':
                queryset = queryset.filter(Blocked=True)
            elif Blocked == '0':
                queryset = queryset.filter(Blocked=False)
        if Canceled is not None:
            if Canceled == '1':
                queryset = queryset.filter(Canceled=True)
            elif Canceled == '0':
                queryset = queryset.filter(Canceled=False)
        if Deleted is not None:
            if Deleted == '1':
                queryset = queryset.filter(Deleted=True)     
            elif Deleted == '0':
                queryset = queryset.filter(Deleted=False)   
        return queryset
 
# Booking: ViewSets define the view behavior.
class bookingViewSet(viewsets.ModelViewSet):
    """
    A viewset for handling API requests related to bookings of rides.
    
    Supports standard CRUD operations with token authentication and additional custom actions
    for specific use cases like canceling and deleting bookings.
    

    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = Booking.objects.all()
    serializer_class = bookingSerializer

    def create(self, request, *args, **kwargs):
        """
        Handles the creation of a new booking instance.

        Validates the serializer, assigns stock items, calculates total prices, 
        and initializes the booking-related attributes. If validation
        fails or certain conditions are not met, an appropriate response
        is returned. An email notification is sent upon successful creation.
        """
        # Serializer validation and booking initialization logic
        serializer = self.get_serializer(data=request.data)

        if not serializer.is_valid(raise_exception=False):
            return Response({"Fail": "blablal"}, status=status.HTTP_400_BAD_REQUEST)

        self.perform_create(serializer)

        headers = self.get_success_headers(serializer.data)
        
        pk = int(serializer.data['pk'])
        booking = Booking.objects.get(pk=pk)
        Mkt =  ContrSectionRideMkt.objects.get(pk=booking.Stock_Id)
        ride_booked = booking.ride

        
        
        Duration = RideDuration.objects.values_list('Token', flat = True)
        Equipement = equipment.objects.values_list('Token', flat = True)
        Sound = sound.objects.values_list('Token', flat = True)
        Image = image.objects.values_list('Token', flat = True)
        Localwifi = localwifi.objects.values_list('Token', flat = True)

        # Assorted logic related to ride equipment, expectations, and settings
        for item in json.loads(Mkt.setting):
            if item in Duration:
                booking.ExpectDuration = RideDuration.objects.get(Token = item)
            elif item in Equipement:
                booking.Equipment = equipment.objects.get(Token = item)
            elif item in Sound:
                booking.Sound = sound.objects.get(Token = item)
            elif item in Image:
                booking.Image = image.objects.get(Token = item)
            elif item in Localwifi:
                booking.localwifi = localwifi.objects.get(Token = item)
            else:
                booking.ErrorMessages ="Fail: Seetings " + "item"
                booking.save()
                return Response({"Fail": "Seetings"}, status=status.HTTP_400_BAD_REQUEST)
  
        booking.SelectStock = True
        # Calculation of total price based on market data and assignment of expected services
        
        booking.TotalPrice = Mkt.TotalPrice

        # Stripe: payment link

        # Ride Stock: Kit

        # Generate: Surogate Dashboard

        # Generate: Teams meeting

        booking.save()

        # Sending an email notification about the booking registration
        
        #if CountryID:
        #    comm = commchannel.objects.filter(Country = CountryID)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET

        message = render_to_string('emails_backoffice/booking_ride.html', {
            'UserID': request.user.pk,
            'User': request.user.username,
            'RideID': ride_booked.pk,
            'BookingID': booking.pk,  
            'Title': ride_booked.ServiceTitle, 
            'RideDate': ride_booked.RideDate,
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(pk)+'/change/', 
            'STATUS': 'Registred',
        })
        msg = EmailMessage('Support: Ride booked',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        # Successful response upon creating booking
        return Response({"Success": 1, "booked": serializer.data}, status=status.HTTP_201_CREATED, headers=headers)

    # Custom action: canceling a booking
    @action(detail=True, methods=['get'], name='Cancel ride')
    def cancel(self, request, pk=None):
        """
        Cancels a booking if it hasn't started yet, updates booking status, and sends notification.
        """
        booking = self.get_object()
        if not booking.RideStarted:
            # Implementation of ride cancellation logic, including email notification
        
            booking.Canceled = True
            booking.save()

            #if self.Country:
            #    comm = commchannel.objects.filter(Country = self.ride.Country)
            #    mail_backoffice = comm.mail_ride
            #else:
            mail_backoffice = settings.EMAILMARKET
            
            message = render_to_string('emails_backoffice/booking_status_changed.html', {
                'UserID': booking.user.pk,
                'User': booking.user.username,
                'RideID': booking.ride.pk,  
                'Title': booking.ride.ServiceTitle,
                'BookedID': booking.pk,
                'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
                'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
                'STATUS': 'cancel',
            })
            
            msg = EmailMessage('Support: Ride Started',message, to=[mail_backoffice])
            
            EmailThread(msg).start()

            return Response({'status': 'OK','booking': core_serializers.serialize('json', [booking,])})
        return Response({'status': 'ERROR','Error':'102','Message': 'The ride started','booking':  core_serializers.serialize('json', [booking,])})
    
    # Custom action: deleting a booking
    @action(detail=True, methods=['get'], name='Remove ride booking')
    def delete(self, request, pk=None):
        """
        Deletes a booking based on cancellation status, updates booking status, and sends notification.
        """
        booking = self.get_object()
        if booking.Canceled:
            # Implementation of booking deletion logic, including email notification
            booking.Deleted = True # add condition
            booking.save()

            #if self.Country:
            #    comm = commchannel.objects.filter(Country = self.ride.Country)
            #    mail_backoffice = comm.mail_ride
            #else:
            mail_backoffice = settings.EMAILMARKET
            
            message = render_to_string('emails_backoffice/booking_status_changed.html', {
                'UserID': booking.user.pk,
                'User': booking.user.username,
                'RideID': booking.ride.pk,  
                'Title': booking.ride.ServiceTitle,
                'BookedID': booking.pk, 
                'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
                'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
                'STATUS': 'delete',
            })
            msg = EmailMessage('Support: Ride Deleted',message, to=[mail_backoffice])
            
            EmailThread(msg).start()

            return Response({'status': 'OK','booking':  core_serializers.serialize('json', [booking,])})
        return Response({'status': 'ERROR','Error':'101','Message': 'Only canceled rides can be deleted.','booking':  core_serializers.serialize('json', [booking,])})

    # Custom action: paying ride extra costs
    @action(detail=True, methods=['get'], name='Ride extras')
    def extra_costs (self, request, pk=None):
        """
        Handles additional costs for a booking.
        Updates booking details to reflect extra costs and sends a notification.
        """
        # Addition of extra costs to the booking
        booking = self.get_object()
        ExtraPrice = request.query_params.get('ExtraPrice')
        booking.ExtraPrice = ExtraPrice
        booking.save()
        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'extra_costs',
        })
        msg = EmailMessage('Support: Ride extra costs',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','booking': core_serializers.serialize('json', [booking,])})

    # Custom action: disputing a ride
    @action(detail=True, methods=['get'], name='Dispute Ride')
    def dispute (self, request, pk=None):
        """
        Marks a ride as disputed within the booking.
        Updates booking details to reflect dispute status and sends a notification.
        """
        # Implementation of booking dispute marking logic
        booking = self.get_object()
        booking.Disputed = True
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'dispute',
        })
        msg = EmailMessage('Support: Ride distputed',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'Ride disputed','booking':  core_serializers.serialize('json', [booking,])})

    def send(self, request, pk=None):
        """Client classification """
        message = request.query_params.get('message')
        booking = self.get_object()
        board = MessageBoard()
        board.user = booking.user
        board.SendByClient = True
        board.Text = message
        board.booking = booking

        board.save()

        return Response({'status': 'OK','message': core_serializers.serialize('json', [board,])})  

    @action(detail=True, methods=['get'], name='Request payment link')
    def paymentlink(self, request, pk=None):
        """payment link """
        booking = self.get_object()
        booking.GeneratePaymentLink = True # reques payment link
        booking.PaymentLink = 'xxx999xxx'
        booking.save()
        
        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk,
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'paymentlink', 
        })

        msg = EmailMessage('Support: Ride booking payment link',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','booking': core_serializers.serialize('json', [booking,])})

    @action(detail=True, methods=['get'], name='Request payment link')
    def dashoards(self, request, pk=None):
        """dashoards generation """
        booking = self.get_object()
        booking.APIrequiresDashboardURL = True # reques payment link
        booking.DashboardClientURL = 'xxx999xxx'
        booking.ClientKey = '1223'
        booking.DashboardSurrogateURL = 'xxx9888xxx'
        booking.SurrogateKey = 'xxx999xxx'
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk,
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'dashoards', 
        })

        msg = EmailMessage('Support: Ride dashboards',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','booking': core_serializers.serialize('json', [booking,])})

    @action(detail=True, methods=['get'], name='Client classification')
    def client_classification (self, request, pk=None):
        """Client classification """
        rank = request.query_params.get('ClientRank')
        booking = self.get_object()
        booking.ClientRank = rating.objects.get(pk=rank)
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'client_classification',
        })
        msg = EmailMessage('Support: Ride Client classification',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','booking': core_serializers.serialize('json', [booking,])})  

    @action(detail=True, methods=['get'], name='Surrogate classification')
    def surrogate_classification (self, request, pk=None):
        """Client classification """
        booking = self.get_object()
        rank = request.query_params.get('AgentRank')
        booking.AgentRank =  rating.objects.get(pk=rank)
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'surrogate_classification',
        })
        msg = EmailMessage('Support: Ride surrogate classification',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK','booking':  core_serializers.serialize('json', [booking,])})

    @action(detail=True, methods=['get'], name='Start ride')
    def ride_start(self, request, pk=None):
        """Start Ride """
        booking = self.get_object()
        booking.RideStarted = True
        booking.RideStartDate = timezone.now()
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'Close',
        })
        
        msg = EmailMessage('Support: Ride Start',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK', 'booking': core_serializers.serialize('json', [booking,])})
    
    @action(detail=True, methods=['get'], name='End ride')
    def ride_end(self, request, pk=None):
        """End Ride """
        booking = self.get_object()
        booking.RideEnded = True
        booking.RideEndDate = timezone.now()
        booking.save()


        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(booking.pk)+'/change/',
            'STATUS': 'ride_end',
        })
        
        msg = EmailMessage('Support: Ride End',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK', 'booking': core_serializers.serialize('json', [booking,])})
    
    @action(detail=True, methods=['get'], name='Close ride')
    def close(self, request, pk=None):
        """Cancel Ride """
        booking = self.get_object()
        booking.closed = True
        booking.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/booking_status_changed.html', {
            'UserID': booking.user.pk,
            'User': booking.user.username,
            'RideID': booking.ride.pk,  
            'Title': booking.ride.ServiceTitle,
            'BookedID': booking.pk, 
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.ride.pk)+'/change/',
            'BookingURL': settings.DOMAIN+'/admin/rides/ride/'+str(booking.pk)+'/change/',
            'STATUS': 'close',
        })
        
        msg = EmailMessage('Support: Ride closed',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'OK', 'booking': core_serializers.serialize('json', [booking,])})
   

    def get_queryset(self):
        """
        Customizes the queryset based on various filter parameters provided in the request.
        
        Filters the bookings by ride ID, client selection, and different status flags such as
        completed, canceled, selected, requisites satisfied, expired, disputed, error, and blocked.
        """
        queryset = Booking.objects.filter(user=self.request.user, closed=False)
        ride = self.request.query_params.get('ride')
        SelectStock = self.request.query_params.get('select-agent')
        Completed = self.request.query_params.get('completed')
        Canceled = self.request.query_params.get('canceled')
        StockSelected = self.request.query_params.get('agent-selected')
        RequisitedSatisfied = self.request.query_params.get('requisits-satisfied')
        Expired = self.request.query_params.get('expired')
        Disputed = self.request.query_params.get('disputed')
        Error = self.request.query_params.get('error')
        Blocked = self.request.query_params.get('blocked')
        Deleted = self.request.query_params.get('deleted')
        if ride is not None:
            queryset = queryset.filter(ride=ride)
        if SelectStock is not None:
            if SelectAgent == '1':
                queryset = queryset.filter(SelectStock=True)
            elif SelectAgent == '0':
                queryset = queryset.filter(SelectStock=False)
        if Completed is not None:
            if Completed == '1':
                queryset = queryset.filter(Completed=True)
            elif Completed == '0':
                queryset = queryset.filter(Completed=False)
        if Canceled is not None:
            if Canceled == '1':
                queryset = queryset.filter(Canceled=True) 
            elif Canceled == '0':
                queryset = queryset.filter(Canceled=False) 
        if StockSelected is not None:
            if AgentSelected == '1':
                queryset = queryset.filter(StockSelected=True)
            elif AgentSelected == '0':
                queryset = queryset.filter(StockSelected=False) 
        if RequisitedSatisfied is not None:
            if RequisitedSatisfied == '1':
                queryset = queryset.filter(RequisitsSatisfied=True) 
            elif RequisitedSatisfied == '0':
                queryset = queryset.filter(RequisitsSatisfied=False)
        if Expired is not None:
            if Expired == '1':
                queryset = queryset.filter(Expired=True)
            elif Expired == '0':
                queryset = queryset.filter(Expired=False) 
        if Error is not None:
            if Error == '1':
                queryset = queryset.filter(Error=True) 
            elif Error == '0':
                queryset = queryset.filter(Error=False) 
        if Disputed is not None:
            if Disputed == '1':
                queryset = queryset.filter(Disputed=True) 
            elif Disputed == '0':
                queryset = queryset.filter(Disputed=False)
        if Blocked is not None:
            if Blocked == '1':
                queryset = queryset.filter(Blocked=True)
            elif Blocked == '0':
                queryset = queryset.filter(Blocked=False)
        if Deleted is not None:
            if Deleted == '1':
                queryset = queryset.filter(Deleted=True)     
            elif Deleted == '0':
                queryset = queryset.filter(Deleted=False)
        return queryset


# Ride: ViewSets define the view behavior.
class stockViewSet(viewsets.ModelViewSet): 
    """
    A viewset for handling API requests related to stock items in contract ride markets.

    It provides standard CRUD operations and custom actions for selecting and unselecting stock items.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = ContrSectionRideMkt.objects.all()
    serializer_class = stockSerializer

    @action(detail=True, methods=['get'], name='select stock item')
    def selected (self, request, pk=None):
        """
        Marks the stock item as selected and sends an email notification.

        This custom action updates the `Selected` status of a given stock item to `True` 
        and triggers an email to notify relevant parties of the change in status.
        """
        item = self.get_object()
        item.Selected = True
        item.save()

        #if self.Country:
        #    comm = commchannel.objects.filter(Country = self.ride.Country)
        #    mail_backoffice = comm.mail_ride
        #else:
        
        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/stock_status_changed.html', {
            'UserID': item.user.pk,
            'User': item.user.username,
            'RideID': item.Ride.ride.pk,  
            'Title': item.Ride.ride.ServiceTitle,
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(item.Ride.ride.pk)+'/change/',
            'BookedID': item.Ride.pk, 
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(item.Ride.pk)+'/change/',
            'ItemID': item.pk,
            'ItemURL': settings.DOMAIN+'/admin/rides/contrsectionridemkt/'+str(item.pk)+'/change/',
            'STATUS': 'selected',
        })
        
        msg = EmailMessage('Support: Stock selected',message, to=[mail_backoffice])
        
        EmailThread(msg).start()

        return Response({'status': 'Selected stock item', 'item':core_serializers.serialize('json', [item,])})

    @action(detail=True, methods=['get'], name='Unselect stock item')
    def unselected (self, request, pk=None):
        """
        Marks the stock item as unselected and sends an email notification.

        This custom action updates the `Selected` status of a given stock item to `False`
        and triggers an email to notify relevant parties that the item is no longer selected.
        """
        item = self.get_object()
        item.Selected = False
        item.save()

        mail_backoffice = settings.EMAILMARKET
        
        message = render_to_string('emails_backoffice/stock_status_changed.html', {
            'UserID': item.user.pk,
            'User': item.user.username,
            'RideID': item.Ride.ride.pk,  
            'Title': item.Ride.ride.ServiceTitle,
            'RideURL': settings.DOMAIN+'/admin/rides/ride/'+str(item.Ride.ride.pk)+'/change/',
            'BookedID': item.Ride.pk, 
            'BookingURL': settings.DOMAIN+'/admin/rides/booking/'+str(item.Ride.pk)+'/change/',
            'ItemID': item.pk,
            'ItemURL': settings.DOMAIN+'/admin/rides/contrsectionridemkt/'+str(item.pk)+'/change/',
            'STATUS': 'unselected',
        })
        
        msg = EmailMessage('Support: Stock unselected',message, to=[mail_backoffice])
        
        EmailThread(msg).start()
        
        return Response({'status': 'UnSelected stock item', 'item':core_serializers.serialize('json', [item,])})

    def get_queryset(self):
        """
        Customizes the queryset to display stock items related to the current user and optional booking parameter.
        """
        queryset = ContrSectionRideMkt.objects.filter(user=self.request.user)
        ride = self.request.query_params.get('booking')
       
        if ride is not None:
            queryset = queryset.filter(Ride=ride)

        return queryset

# Ride: ViewSets define the view behavior.
class messageViewSet(viewsets.ModelViewSet): 
    """
    A viewset for handling API requests related to messaging on the message board.

    It provides standard CRUD operations and custom actions for marking messages as read, deleted, or abusive.
    """
    authentication_classes = [TokenAuthentication]
    permission_classes = [IsAuthenticated]
    queryset = MessageBoard.objects.all()
    serializer_class = MessageBoardSerializer

    def get_queryset(self):
        """
        Customizes the queryset to display messages related to the current user and optional booking parameter.
        """
        # Filter the queryset based on the current user and booking query parameter
        
        queryset = MessageBoard.objects.filter(user=self.request.user)
        ride = self.request.query_params.get('booking')
        if ride is not None:
            queryset = queryset.filter(booking=ride)

        return queryset
    
    @action(detail=True, methods=['get'], name='Close ride')
    def readed(self, request, pk=None):
        """
        Marks a message as read.
        
        This custom action updates the `Read` status of the message.
        """
        board = self.get_object()
        if board.SendByClient:
            board.Read = True
            board.save()

        return Response({'status': 'OK', 'message': core_serializers.serialize('json', [board,])})
   
    @action(detail=True, methods=['get'], name='Delete message')
    def delete(self, request, pk=None):
        """
        Deletes a message from the message board.

        This custom action sets the `deleted` flag for the message, marking it as removed by the client.
        """
        board = self.get_object()
        if board.SendByClient:
            board.deleted = True
            board.save()

        return Response({'status': 'OK', 'message': 'Deleted'})

    @action(detail=True, methods=['get'], name='Report as abusive')
    def abuse(self, request, pk=None):
        """
        Reports a message as abusive.
        
        This custom action marks the message as abusive, updating its `Abuse` status.
        """
        board = self.get_object()
        if not board.SendByClient:
            board.Read = True
            board.save()

        return Response({'status': 'OK', 'message': core_serializers.serialize('json', [board,])})
    

# --- App: rides - File: admin.py ---

"""
Rides App Administration - Suroga API

This module defines custom Django admin classes for the 'rides' app within the Suroga API project.
It configures the admin interface for various models such as Contract Section Ride Market, 
Meeting Log, Communication Log, and Message Board, making each of these models editable through
Django's built-in admin interface. Each admin class specifies the fields to be displayed in the list view,
providing the administrators with a convenient way to oversee and manage application-related data.

The admin classes utilize the Django ModelAdmin to customize the admin panel's display, forms, and other behaviors.

Usage:
    - Register model classes with their corresponding ModelAdmin subclasses to customize admin interfaces.
    - Use list_display to control which model fields are displayed in the admin's list views for each model.

Notes:
    - Make sure all models that require admin interface representation are properly registered.
    - Changes to admin configurations should be rigorous as they impact the admin panel's functionality and UX.

Recommended reading:
    - Django admin site documentation: https://docs.djangoproject.com/en/4.0/ref/contrib/admin/
    - Django ModelAdmin documentation: https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#modeladmin-objects

Maintainer: Carlos Leandro
Last Modified: 15/3/2024
"""

from django.contrib import admin

# Register your models here.
from rides.models import rating, ServiceCategory, ridetype, Ride, Booking
from rides.models import MessageBoard, paymentlog, ContrSectionRideMkt, mettinglog, commlog 


class paymentlogAdmin(admin.ModelAdmin):
    """
    Customizes the Django admin interface for the paymentlog model.

    The list_display attribute specifies which fields to display in the admin list view.
    """
    list_display = (
    'pk',
    'PlantformUserType',
    'user',
    'OperationType',
    'SettlementDate',
    'PaymMethodResul',
    'StripTransactionID',
    'Ride',
    'Booking',
    'Value',
    'is_debit',
    'RegistrationDate',
    )
# Registers the paymentlog model with the paymentlogAdmin configuration for the admin site
admin.site.register(paymentlog,paymentlogAdmin)


class ratingAdmin(admin.ModelAdmin):
    """
    Configures the admin list view for the rating model to include specific fields.

    Allows admin users to easily view and manage ratings in the admin interface.
    """
    list_display = (
    'pk',
    'Name',
    'value',
    )
# Register rating model to be managed in admin
admin.site.register(rating,ratingAdmin)

class ServiceCategoryAdmin(admin.ModelAdmin):
    """
    Admin configuration for the ServiceCategory model in the admin list view.

    Facilitates management of service category entries for admin users.
    """
    list_display = (
    'pk',
    'Name',
    )
# Register ServiceCategory model to be managed in admin
admin.site.register(ServiceCategory,ServiceCategoryAdmin)

class ridetypeAdmin(admin.ModelAdmin):
    """
    Customizes the display of ridetype entities in the Django admin interface.

    Ease of viewing and editing ridetype entries in the admin panel.
    """
    list_display = (
    'pk',
    'Name',
    )
# Register ridetype model to be managed in admin
admin.site.register(ridetype,ridetypeAdmin)

class RideAdmin(admin.ModelAdmin):
    """
    Admin interface settings for the Ride model for detailed list view representation.

    Fields provided offer a relevant snapshot of ride information for admin users.
    """
    list_display = (
    'pk',
    'user',
    'CityMunicipality',
    'DistrictRegion',
    'Country',
    'PayedAtRegistration',
    'ServiceCategory',
    'ServiceTitle',
    #'ExpectDuration',
    'RegistrationDate',
    'Blocked',
    'Canceled',
    'Deleted',
    'Request_Id'
    )
# Register Ride model to be managed in admin
admin.site.register(Ride,RideAdmin)


class BookingAdmin(admin.ModelAdmin):
    """
    Defines admin settings for the Booking model, with customization on the list view.

    Enables admins to see the status and important details of bookings at a glance.
    """
    list_display = (
    'pk',
    'ride',
    'RegistrationDate',
    'RideDate',
    'ServiceTitle',
    'ExpectDuration',
    'Canceled',
    'StockSelected',
    'RequisitsSatisfied',
    'Expired',
    'Error',
    'Disputed',
    'ExtraPrice',
    'RideStarted',
    'RideStartDate',
    'RideEnded',
    'RideEndDate',
    'Request_Id',
    )
# Register Booking model to be managed in admin
admin.site.register(Booking,BookingAdmin)

class ContrSectionRideMktAdmin(admin.ModelAdmin):
    """
    Admin interface customization for Contract Section Ride Market model.

    Provides a list view that highlights key information about each market item.
    """
    list_display = (
    'pk',
    'Name',
    'Selected',
    'Ride',
    'ContractSectionA',
    'ContractSectionB',
    'ContractSectionC',
    'ContractSectionD',
    'ContractSectionE',
    'ContractSectionF',
    'KitType',
    'KitRequired',
    'TotalPrice',
    )
# Registration of the admin class for Contract Section Ride Market model
admin.site.register(ContrSectionRideMkt,ContrSectionRideMktAdmin)

class mettinglogAdmin(admin.ModelAdmin):
    """
    Custom admin display for meeting log entries.

    Aligns with the admin interface for clear inventory of meeting records related to rides.
    """
    list_display = (
    'pk',
    'Ride',
    'ActionType',
    'DateTime', # Displays when the action within a meeting took place.
    'Satus', # Denotes the status of the meeting.
    )
# Registration of the admin class for meeting log model
admin.site.register(mettinglog,mettinglogAdmin)

class commlogAdmin(admin.ModelAdmin):
    """
    Configures admin list display for communication logs.

    Offers a detailed view of communication events between users and contract sections.
    """
    list_display = (
    'pk', 
    'Comm_Type', # Indicates the type of communication that took place.
    'Ride',
    'Contract', # Show which contract section is associated with the communication.
    'DateTime', # Records the time of the communication.
    'Message',  # The actual content of the communication.
    )
# Registration of the admin class for communication log model
admin.site.register(commlog,commlogAdmin)

class MessageBoardAdmin(admin.ModelAdmin):
    """
    Defines settings for the MessageBoard model in the Django admin interface.

    Provides quick administrative insight into the read status, deletion, and abuse reports
    for messages related to booking operations.
    """
    list_display = (
    'pk',
    #'Date',
    #'user',
    #'booking',
    'Read',    # Indicates if the message was read.
    'deleted', # Shows if the message was deleted by the sender.
    'Abuse',   # Highlights if the message was reported as abusive by the recipient.
    )
# Registration of the admin class for Message Board model
admin.site.register(MessageBoard,MessageBoardAdmin)

# --- App: rides - File: serializers.py ---

"""
Rides App Serializers - Suroga API

This module contains serializers for converting complex data types such as Django model instances
to native Python datatypes and then rendering those into JSON for API endpoints within the 'rides'
application of the Suroga API project. These serializers also provide deserialization, allowing
parsed data to be converted back into complex types after first validating the incoming data.

The serializers define the API representation for various models like Booking, Stock in the
contract ride market, and messaging on the Message Board.

Usage:
    These serializers are typically used in views and viewsets provided by Django REST Framework to handle
    the inbound and outbound data processing for API requests and responses.

References:
    - Django REST Framework serializers: https://www.django-rest-framework.org/api-guide/serializers/
    - ModelSerializer class: https://www.django-rest-framework.org/api-guide/serializers/#modelserializer

The file should be maintained thoughtfully, as changes to the serializers affect data validation,
serialization, and the overall input/output contracts of the API.

Maintainer: Carlos Leandro
Last Modified: 15/3/2014
"""
from rest_framework import routers, serializers, viewsets
from rest_framework.response import Response
from rest_framework.permissions import BasePermission, IsAuthenticated, SAFE_METHODS

from rest_framework.decorators import api_view
from rest_framework.response import Response

from rest_framework.views import APIView

from rides.models import MessageBoard, ContrSectionRideMkt, rating, ServiceCategory, ridetype, Ride, Booking

from supplier.models import servicetype, contractsection

from django.db.models import Q

from django.core import serializers as core_serializers


# Serializers define the API representation.

# Serializer for the Rating model
class ratingSerializer(serializers.ModelSerializer):
    """
    Serializer for the Rating model that defines the representation in the API.
    
    The fields attribute specifies which model fields should be included in the serialized output/input.
    """
    class Meta:
        model = rating # The model associated with this serializer
        fields = ['pk','Name','value'] # Fields that should be included in the serialized data

# Serializer for the ServiceCategory model
class servicecategorySerializer(serializers.ModelSerializer):
    """
    Serializer for the ServiceCategory model for REST API representation.
    """
    class Meta:
        model = ServiceCategory # The model associated with this serializer
        fields = ['pk','Name'] # The fields to be included

# Serializer for the RideType model
class ridetypeSerializer(serializers.ModelSerializer):
    """
    Serializer for the RideType model to convert it to and from JSON format for API interactions.
    """
    class Meta:
        model = ridetype # The model associated with this serializer
        fields = ['pk','Name'] # The required fields


# Serializer for the Ride model
class rideSerializer(serializers.ModelSerializer):

    """
    Serializer for the Ride model which defines the detailed API endpoint representation.
    
    Includes complex logic for the creation, where some fields are populated based on the current user 
    and default values. `read_only_fields` specifies fields that cannot be edited via the API.
    """
    # Primary key related field that automatically populates with the current user's id
    user = serializers.PrimaryKeyRelatedField(read_only=True, default=serializers.CurrentUserDefault())

    class Meta:
        model = Ride # The model associated with this serializer
        # All the fields that can be included in the serialized form of a Ride, including read-only fields.
        fields = ['pk','user','ExternalMetaData','PayedAtRegistration','ServiceCategory','Country', 'RideDate',
        'DistrictRegion','CityMunicipality','StreetName','StreetNumber','Floor', 'ZipCode',
        'GPS_latitude','GPS_longitude','Zoom_map','GooglePlaceID','RideType','ServiceTitle',
        'Description','RegistrationDate','GeneratePaymentLink','PaymentLink','PaymentCODE','Blocked','Canceled',
        'Deleted','NotAvailable','HashKey','Request_Id','Closed','Requisits']
        # Fields that are read-only and won't accept data during updates/creates.
        read_only_fields = ['pk','user','PayedAtRegistration','RegistrationDate','GeneratePaymentLink','PaymentLink','PaymentCODE','NotAvailable',
        'Blocked','HashKey','Request_Id']
    
    def save(self, **kwargs):
        """
        Overridden save method to include a default value for the read_only `user` field.
        """
        kwargs["user"] = self.fields["user"].get_default()   # Assign the current user as a default
        
        return super().save(**kwargs)  # Call the super class's save method to handle further operations

# Serializer for Booking Model
class bookingSerializer(serializers.ModelSerializer):
    """
    Serializer for the Booking model to handle serialization for API input/output.
    
    Specifies fields to include in the serialized form, with certain fields set as read-only.
    Includes default fields such as the current user, which are automatically populated.
    """
    user = serializers.PrimaryKeyRelatedField(read_only=True, default=serializers.CurrentUserDefault())

    class Meta:
        model = Booking # Define the associated model
        # Define fields that this serializer should process
        fields = [
            'pk',
            'user',
            'ExternalMetaData',

            'ride',

            'RideDate', 
            'Image',
            'Sound',
            'Equipment',
            'localwifi',
            'publicevent',
            'ExpectDuration',
            
            'APIrequiresMettingURL',
            'MeetingURL',
            'MeetingPasswd',
            'RegistrationDate',
            'Blocked',
            'Canceled',
            'Deleted',
            'ServiceTitle',
            
            'Description',
            'FinalDuration',
            'ExtraPrice',
            'SelectStock',
            'Completed',
            'StockSelected',
            'CanceledAgent',
            'RequisitsSatisfied',
            'Expired',
            'Error',
            'Disputed',
            'InvitationSend',
            'InvitationAccepted',
            'closed',
            
            'SystemInfo',
            'ErrorMessages',
            
            'GeneratePaymentLink',
            'PaymentLink',
            'PaymentCODE',

            'APIrequiresDashboardURL',
            'DashboardClientURL',
            'ClientKey',
            'DashboardSurrogateURL',
            'SurrogateKey',
            
            'ClientRank',

            'RideStarted',
            'RideEnded',
            'RideStartDate',
            'RideEndDate',
            'HashKey',
            'Request_Id',
            'Stock_Id'
            ]
        # Fields that will be read-only once a Booking instance is created
        read_only_fields = [
            'pk',
            'user',
            'Image',
            'Sound',
            'Equipment',
            'localwifi',
            'publicevent',
            'ExpectDuration',
            'RegistrationDate',
            'Blocked',
            'Completed',
            'Expired',
            'Error',
            'Disputed',
            'InvitationSend',
            'InvitationAccepted',
            'SystemInfo',
            'ErrorMessages',
            'GeneratePaymentLink',
            'PaymentLink',
            'PaymentCODE',
            'APIrequiresDashboardURL',
            'DashboardClientURL',
            'ClientKey',
            'DashboardSurrogateURL',
            'SurrogateKey',
            'HashKey'
            ]
    #
    #def validate_rute(self, value):
    #    """
    #    Check if ride is valide
    #    """
    #    obj = Ride.objects.get(pk=value.pk)
    #    if obj.user != self.fields["user"].get_default():
    #        raise serializers.ValidationError("The ride is invalide")
    #    return value
    #
    def save(self, **kwargs):
        """
        Custom save method to include default value for the read-only `user` field before
        saving a new Booking instance to the database.
        """
        kwargs["user"] = self.fields["user"].get_default()
        return super().save(**kwargs)

# Serializer for the ContrSectionRideMkt Model    
class stockSerializer(serializers.ModelSerializer):
    """
    Serializer for the Contract Section Ride Market model.

    It represents the structure of a stock item for Ride within the API, 
    specifying the fields included and which ones are read-only.
    """
    class Meta:
        model = ContrSectionRideMkt
        fields = ['pk','Name','rank','miss','Ride','TotalPrice','HashKey','Selected','RequiredConfigTime','setting']
        read_only_fields = ['pk','Name','rank','miss','Ride','TotalPrice','HashKey','RequiredConfigTime','setting']

# Serializer for the MessageBoard Model
class MessageBoardSerializer(serializers.ModelSerializer):
    """
    Serializer for the MessageBoard model detailing the API representation,
    which fields are included, and the default current user applied to the `user` field.
    """

    user = serializers.PrimaryKeyRelatedField(read_only=True, default=serializers.CurrentUserDefault())

    class Meta:
        model = MessageBoard
         #List of fields included in the serialization process
        fields = ['pk','user','booking','SendByClient','Text','Read','deleted','Abuse','Date']
        # Fields that are not editable and act as read-only
        read_only_fields = ['pk','user','booking','SendByClient','Text','Read','deleted','Abuse','Date']

# --- App: rides - File: apps.py ---

"""
Rides Application Configuration - Suroga API

This module defines the application configuration for the Rides app within the Suroga API project.
The AppConfig subclass provides metadata and configuration options for the app, such as the default
field type for auto-generated model primary keys and the application label.

Usage:
    The configuration class `RidesConfig` is usually referenced in the project settings in the
    INSTALLED_APPS list to include this application within the project setup.

Best Practices:
    Avoid modifying the 'name' attribute without updating the project settings accordingly.
    Any changes to 'default_auto_field' should be coupled with the appropriate database migrations.

References:
    - Django AppConfig documentation: https://docs.djangoproject.com/en/4.0/ref/applications/#appconfig-classes

Maintainer: Carlos Leandro
Last Modified: 15/3/2024
"""
from django.apps import AppConfig


class RidesConfig(AppConfig):
    """
    The AppConfig subclass defining metadata and default configuration for the Rides application.
    """
    default_auto_field = 'django.db.models.BigAutoField' # Specifies the default AutoField type for primary keys
    name = 'rides' # The full Python path to the application, used by Django for identifying the app


# --- App: rides - File: forms.py ---

from django import forms
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.db import transaction
from django.utils.translation import gettext_lazy

from core.models import User
from rides.models import paymentlog



# --- App: rides.migrations - File: 0027_remove_messageboard_booking_remove_messageboard_user.py ---

# Generated by Django 4.0.1 on 2023-01-24 11:03

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0026_alter_messageboard_user'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='messageboard',
            name='booking',
        ),
        migrations.RemoveField(
            model_name='messageboard',
            name='user',
        ),
    ]


# --- App: rides.migrations - File: 0002_ride_notavailable.py ---

# Generated by Django 4.0.1 on 2022-12-08 23:02

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='ride',
            name='NotAvailable',
            field=models.BooleanField(default=False, help_text='Servide not available by SurooAPI'),
        ),
    ]


# --- App: rides.migrations - File: 0004_booking_systeminfo.py ---

# Generated by Django 4.0.1 on 2022-12-10 11:19

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0003_remove_booking_ridetiem'),
    ]

    operations = [
        migrations.AddField(
            model_name='booking',
            name='SystemInfo',
            field=models.TextField(blank=True, help_text='JSON: System information', max_length=1000),
        ),
    ]


# --- App: rides.migrations - File: 0015_contrsectionridemkt_miss_contrsectionridemkt_rank_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-18 02:34

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0014_contrsectionridemkt_name'),
    ]

    operations = [
        migrations.AddField(
            model_name='contrsectionridemkt',
            name='miss',
            field=models.CharField(blank=True, help_text='Items missing', max_length=300),
        ),
        migrations.AddField(
            model_name='contrsectionridemkt',
            name='rank',
            field=models.IntegerField(default=0, help_text='Item rank'),
        ),
        migrations.AddField(
            model_name='contrsectionridemkt',
            name='setting',
            field=models.TextField(blank=True, help_text='JSON: ride setting', max_length=1000),
        ),
    ]


# --- App: rides.migrations - File: 0006_contrsectionridemkt_user.py ---

# Generated by Django 4.0.1 on 2022-12-10 18:01

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('rides', '0005_alter_booking_dashboardclienturl_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='contrsectionridemkt',
            name='user',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='stock_user', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: rides.migrations - File: 0022_messageboard.py ---

# Generated by Django 4.0.1 on 2023-01-23 04:20

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('rides', '0021_alter_ride_requisits'),
    ]

    operations = [
        migrations.CreateModel(
            name='MessageBoard',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('SendByClient', models.BooleanField(default=True, help_text='True if message was sent by client')),
                ('Text', models.TextField(blank=True, help_text='Message body', max_length=2000)),
                ('Read', models.BooleanField(default=False, help_text='Message was readed')),
                ('Date', models.DateTimeField(default=django.utils.timezone.now)),
                ('index', models.IntegerField(default=0, help_text='Message index in the conversation')),
                ('deleted', models.BooleanField(default=False, help_text='deleted by sender')),
                ('Abuse', models.BooleanField(default=False, help_text='Classified abusive by recipient')),
                ('Service', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='message_booking', to='rides.booking')),
                ('user', models.ForeignKey(blank=True, default='', help_text='API_user', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Message Board',
            },
        ),
    ]


# --- App: rides.migrations - File: 0005_alter_booking_dashboardclienturl_and_more.py ---

# Generated by Django 4.0.1 on 2022-12-10 12:13

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0004_booking_systeminfo'),
    ]

    operations = [
        migrations.AlterField(
            model_name='booking',
            name='DashboardClientURL',
            field=models.CharField(blank=True, help_text='Client dasboard on surooAPI', max_length=100),
        ),
        migrations.AlterField(
            model_name='booking',
            name='DashboardSurrogateURL',
            field=models.CharField(blank=True, help_text='Surrogate dasboard on surooAPI', max_length=100),
        ),
        migrations.AlterField(
            model_name='booking',
            name='RideEndDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Date ride end.'),
        ),
        migrations.AlterField(
            model_name='booking',
            name='RideStartDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Date ride start.'),
        ),
    ]


# --- App: rides.migrations - File: 0001_initial.py ---

# Generated by Django 4.0.1 on 2022-12-08 11:07

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('supplier', '0001_initial'),
        ('kit', '0001_initial'),
        ('core', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Booking',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ExternalMetaData', models.TextField(blank=True, help_text='APP metadata', max_length=1000)),
                ('InternalMetaData', models.TextField(blank=True, help_text='API metadata', max_length=1000)),
                ('RideDate', models.DateTimeField(help_text='Appointment date+time.')),
                ('RideTiem', models.TimeField(help_text='Appointment time.')),
                ('SelectionDeadLine', models.DateField(blank=True, help_text='Date for the selection Deadline.', null=True)),
                ('APIrequiresMettingURL', models.BooleanField(default=True, help_text='True if meeting URL must be sent to API')),
                ('MeetingURL', models.CharField(blank=True, help_text='The meeting link', max_length=100)),
                ('MeetingPasswd', models.CharField(blank=True, help_text='The meeting password/pin', max_length=100)),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.')),
                ('Blocked', models.BooleanField(default=False, help_text='Ride blocked by Suroga.')),
                ('Canceled', models.BooleanField(default=False, help_text='Ride canceled via API')),
                ('Deleted', models.BooleanField(default=False, help_text='Ride deleted via API')),
                ('ServiceTitle', models.CharField(blank=True, help_text='Service title', max_length=400)),
                ('Description', models.TextField(blank=True, help_text='Service Description', max_length=1000)),
                ('FinalDuration', models.DecimalField(decimal_places=2, default=0, help_text='Distance to go in doing the service.', max_digits=5)),
                ('ExtraPrice', models.DecimalField(decimal_places=2, default=0.0, help_text='Extra price.', max_digits=5)),
                ('SelectStock', models.BooleanField(default=False, help_text='True if stock must be selected')),
                ('Completed', models.BooleanField(default=False, help_text='True if service selected')),
                ('StockSelected', models.BooleanField(default=False, help_text='True if stock was selected')),
                ('CanceledAgent', models.BooleanField(default=False, help_text='True if ride canceled by surrogate')),
                ('RequisitsSatisfied', models.BooleanField(default=False, help_text='True if ride riquisites were satisfied')),
                ('Expired', models.BooleanField(default=False, help_text='True if selection expired')),
                ('Error', models.BooleanField(default=False, help_text='True if error on seelction process')),
                ('Disputed', models.BooleanField(default=False, help_text='True if ride is in dispute')),
                ('InvitationSend', models.BooleanField(default=False, help_text='True if invitation was sent to surrogate')),
                ('InvitationAccepted', models.BooleanField(default=False, help_text='True if invitation was accepted by surrogate')),
                ('closed', models.BooleanField(default=False, help_text='True if service was completed')),
                ('ErrorMessages', models.TextField(blank=True, help_text='Error message', max_length=100)),
                ('GeneratePaymentLink', models.BooleanField(default=False, help_text='True if API requires payment link')),
                ('PaymentLink', models.CharField(blank=True, help_text='Link in Stripe to use for payment.', max_length=100)),
                ('PaymentCODE', models.CharField(blank=True, help_text='Payment proof code.', max_length=100)),
                ('APIrequiresDashboardURL', models.BooleanField(default=True, help_text='True if API requires dashdoards')),
                ('DashboardClientURL', models.CharField(blank=True, editable=False, help_text='Client dasboard on surooAPI', max_length=100)),
                ('ClientKey', models.CharField(blank=True, help_text='Client Key', max_length=10)),
                ('DashboardSurrogateURL', models.CharField(blank=True, editable=False, help_text='Surrogate dasboard on surooAPI', max_length=100)),
                ('SurrogateKey', models.CharField(blank=True, help_text='Client Key', max_length=10)),
                ('RideStarted', models.BooleanField(default=False, help_text='Ride started.')),
                ('RideEnded', models.BooleanField(default=False, help_text='Ride ended.')),
                ('RideStartDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date ride start.')),
                ('RideEndDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date ride end.')),
                ('HashKey', models.CharField(blank=True, editable=False, help_text='Service hash key.', max_length=30)),
                ('Request_Id', models.CharField(blank=True, editable=False, help_text='API request ID', max_length=20)),
                ('Kit_Ref_Number', models.CharField(blank=True, editable=False, help_text='Kit Ref Number', max_length=15)),
                ('Options', models.TextField(blank=True, help_text='JSON: Stock options', max_length=1000)),
            ],
            options={
                'verbose_name_plural': 'Rides booked',
            },
        ),
        migrations.CreateModel(
            name='rating',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Classification', max_length=20)),
                ('value', models.IntegerField(default=2, help_text='rating')),
            ],
            options={
                'verbose_name_plural': 'Ratings',
            },
        ),
        migrations.CreateModel(
            name='ridetype',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Ride type', max_length=100, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Ride type',
            },
        ),
        migrations.CreateModel(
            name='ServiceCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('Name', models.CharField(help_text='Service Category', max_length=100, unique=True)),
            ],
            options={
                'verbose_name_plural': 'Service Category',
            },
        ),
        migrations.CreateModel(
            name='Ride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ExternalMetaData', models.TextField(blank=True, help_text='APP metadata', max_length=1000)),
                ('InternalMetaData', models.TextField(blank=True, help_text='API metadata', max_length=1000)),
                ('PayedAtRegistration', models.BooleanField(default=False, help_text='Payment is made at the ride registration.')),
                ('Country', models.CharField(blank=True, help_text='Country', max_length=20)),
                ('RegionState', models.CharField(blank=True, help_text='Region/State', max_length=20)),
                ('DistrictRegion', models.CharField(blank=True, help_text='District/Region', max_length=20)),
                ('CityMunicipality', models.CharField(blank=True, help_text='City/Municipality', max_length=20)),
                ('StreetName', models.CharField(blank=True, help_text='Street name', max_length=100)),
                ('StreetNumber', models.CharField(blank=True, help_text='Street number', max_length=10)),
                ('ZipCodeP1', models.CharField(blank=True, help_text='Zip Code part 1', max_length=100)),
                ('ZipCodeP2', models.CharField(blank=True, help_text='Zip Code part 2', max_length=100)),
                ('GPS_latitude', models.DecimalField(decimal_places=7, default=0, help_text='location coordinates', max_digits=11)),
                ('GPS_longitude', models.DecimalField(decimal_places=7, default=0, help_text='location coordinates', max_digits=11)),
                ('Zoom_map', models.IntegerField(default=15, help_text='Google maps zoom')),
                ('GooglePlaceID', models.CharField(blank=True, editable=False, help_text='Google place ID.', max_length=30)),
                ('ServiceTitle', models.CharField(blank=True, help_text='Service title', max_length=400)),
                ('Description', models.TextField(blank=True, help_text='Service Description', max_length=1000)),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.')),
                ('GeneratePaymentLink', models.BooleanField(default=False, help_text='True if API requires payment link')),
                ('PaymentLink', models.CharField(blank=True, help_text='Link in Stripe to use for payment.', max_length=100)),
                ('PaymentCODE', models.CharField(blank=True, help_text='Payment proof code.', max_length=100)),
                ('Blocked', models.BooleanField(default=False, help_text='Ride blocked by SurooAPI')),
                ('Canceled', models.BooleanField(default=False, help_text='Service canceled by API')),
                ('Deleted', models.BooleanField(default=False, help_text='Service deleted by API.')),
                ('HashKey', models.CharField(blank=True, editable=False, help_text='Service hash key.', max_length=30)),
                ('Request_Id', models.CharField(blank=True, editable=False, help_text='API request ID', max_length=20)),
                ('CityMunicipalityID', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.citymunicipality')),
                ('CountryID', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.country')),
                ('DistrictRegionID', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.districtregion')),
                ('ExpectDuration', models.ForeignKey(blank=True, help_text='Expected service duration.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.rideduration')),
                ('Image', models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.image')),
                ('LocalWifi', models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.localwifi')),
                ('PublicEvent', models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.publicevent')),
                ('RegionStateID', models.ForeignKey(blank=True, help_text='Country', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.regionstate')),
                ('RideType', models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='rides.ridetype')),
                ('ServiceCategory', models.ForeignKey(blank=True, help_text='Service type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='rides.servicecategory')),
                ('Sound', models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.sound')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_service', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Rides registred',
            },
        ),
        migrations.CreateModel(
            name='mettinglog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ActionType', models.CharField(help_text='Action type', max_length=20, unique=True)),
                ('DateTime', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date')),
                ('Satus', models.CharField(help_text='Metting status', max_length=20, unique=True)),
                ('Ride', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='meeting_booking', to='rides.booking')),
            ],
            options={
                'verbose_name_plural': 'Metting Log',
            },
        ),
        migrations.CreateModel(
            name='ContrSectionRideMkt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('KitRequired', models.BooleanField(default=False, help_text='Kit required')),
                ('ContractPriceA', models.DecimalField(decimal_places=2, default=0, help_text='Price contract A', max_digits=6)),
                ('ContractPriceB', models.DecimalField(decimal_places=2, default=0, help_text='Price contract B', max_digits=6)),
                ('ContractPriceC', models.DecimalField(decimal_places=2, default=0, help_text='Price contract C', max_digits=6)),
                ('ContractPriceD', models.DecimalField(decimal_places=2, default=0, help_text='Price contract D', max_digits=6)),
                ('ContractPriceE', models.DecimalField(decimal_places=2, default=0, help_text='Price contract E', max_digits=6)),
                ('ContractPriceF', models.DecimalField(decimal_places=2, default=0, help_text='Price contract F', max_digits=6)),
                ('TotalPrice', models.DecimalField(decimal_places=2, default=0, help_text='Total Price', max_digits=6)),
                ('HashKey', models.CharField(blank=True, editable=False, help_text='Market hash key', max_length=30)),
                ('Selected', models.BooleanField(default=False, help_text='Option started')),
                ('RequiredConfigTime', models.DecimalField(decimal_places=2, default=0, help_text='Required config time (hours)', max_digits=6)),
                ('ContractSectionA', models.ForeignKey(help_text='Contract Section A', on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionA', to='supplier.contractsection')),
                ('ContractSectionB', models.ForeignKey(blank=True, help_text='Contract Section B', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionB', to='supplier.contractsection')),
                ('ContractSectionC', models.ForeignKey(blank=True, help_text='Contract Section C', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionC', to='supplier.contractsection')),
                ('ContractSectionD', models.ForeignKey(blank=True, help_text='Contract Section D', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionD', to='supplier.contractsection')),
                ('ContractSectionE', models.ForeignKey(blank=True, help_text='Contract Section E', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionE', to='supplier.contractsection')),
                ('ContractSectionF', models.ForeignKey(blank=True, help_text='Contract Section F', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_sectionF', to='supplier.contractsection')),
                ('KitType', models.ForeignKey(blank=True, help_text='Kit required', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='market_kit', to='kit.kittype')),
                ('Ride', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='market_booking', to='rides.booking')),
            ],
            options={
                'verbose_name_plural': 'Section ride Market',
            },
        ),
        migrations.CreateModel(
            name='commlog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('DateTime', models.DateTimeField(default=django.utils.timezone.now)),
                ('Message', models.TextField(blank=True, help_text='Comm message', max_length=1000)),
                ('Attributes', models.TextField(blank=True, help_text='JSON: comm att', max_length=1000)),
                ('Comm_Type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comm_Type', to='supplier.commtype')),
                ('Contract', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comm_contractsection', to='supplier.contractsection')),
                ('POC', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comm_POC', to='supplier.profilerepresentative')),
                ('Ride', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comm_Ride', to='rides.booking')),
            ],
            options={
                'verbose_name_plural': 'Communication Log',
            },
        ),
        migrations.AddField(
            model_name='booking',
            name='AgentRank',
            field=models.ForeignKey(blank=True, help_text='Surrogate rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_surrrank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ClientRank',
            field=models.ForeignKey(blank=True, help_text='Client rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_clientrank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ExpectDuration',
            field=models.ForeignKey(blank=True, help_text='Expected service duration.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.rideduration'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Image',
            field=models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.image'),
        ),
        migrations.AddField(
            model_name='booking',
            name='KitPack',
            field=models.ForeignKey(blank=True, help_text='kit', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_kit', to='kit.kitstock'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Sound',
            field=models.ForeignKey(blank=True, help_text='Ride type', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.sound'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierARank',
            field=models.ForeignKey(blank=True, help_text='Supplier A rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Arank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierBRank',
            field=models.ForeignKey(blank=True, help_text='Supplier B rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Brank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierCRank',
            field=models.ForeignKey(blank=True, help_text='Supplier C rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Crank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierDRank',
            field=models.ForeignKey(blank=True, help_text='Supplier D rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Drank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierERank',
            field=models.ForeignKey(blank=True, help_text='Supplier E rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Erank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierFRank',
            field=models.ForeignKey(blank=True, help_text='Supplier F rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Fank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Surrogate',
            field=models.ForeignKey(blank=True, help_text='Surrogate with account', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_agent', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='booking',
            name='ride',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='Booking_booking', to='rides.ride'),
        ),
        migrations.AddField(
            model_name='booking',
            name='user',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='Booking_service', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: rides.migrations - File: 0029_remove_booking_apirequiresdashboardurl_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-24 12:02

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0028_messageboard_user'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='booking',
            name='APIrequiresDashboardURL',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='APIrequiresMettingURL',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='AgentRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Blocked',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Canceled',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='CanceledAgent',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ClientKey',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ClientRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Completed',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='DashboardClientURL',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='DashboardSurrogateURL',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Deleted',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Description',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Disputed',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Error',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ErrorMessages',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ExpectDuration',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Expired',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ExtraPrice',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='FinalDuration',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='GeneratePaymentLink',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='HashKey',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Image',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='InvitationAccepted',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='InvitationSend',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='KitPack',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Kit_Ref_Number',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='MeetingPasswd',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='MeetingURL',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Options',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='PaymentCODE',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='PaymentLink',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RegistrationDate',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Request_Id',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RequisitsSatisfied',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideDate',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideEndDate',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideEnded',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideStartDate',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideStarted',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideTime',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SelectStock',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SelectionDeadLine',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='ServiceTitle',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Sound',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='StockSelected',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierARank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierBRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierCRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierDRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierERank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SupplierFRank',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='Surrogate',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SurrogateKey',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='SystemInfo',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='closed',
        ),
        migrations.AddField(
            model_name='messageboard',
            name='booking',
            field=models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='message_booking', to='rides.booking'),
        ),
    ]


# --- App: rides.migrations - File: 0021_alter_ride_requisits.py ---

# Generated by Django 4.0.1 on 2023-01-20 17:24

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0020_remove_ride_equipment_remove_ride_expectduration_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='ride',
            name='Requisits',
            field=models.CharField(blank=True, default='', help_text='Service Requisits', max_length=1000),
        ),
    ]


# --- App: rides.migrations - File: 0009_ride_closed_alter_ride_canceled_alter_ride_deleted.py ---

# Generated by Django 4.0.1 on 2022-12-23 15:25

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0008_rename_plantformuser_paymentlog_user'),
    ]

    operations = [
        migrations.AddField(
            model_name='ride',
            name='Closed',
            field=models.BooleanField(default=False, help_text='Service closed via API.'),
        ),
        migrations.AlterField(
            model_name='ride',
            name='Canceled',
            field=models.BooleanField(default=False, help_text='Service canceled via API'),
        ),
        migrations.AlterField(
            model_name='ride',
            name='Deleted',
            field=models.BooleanField(default=False, help_text='Service deleted via API.'),
        ),
    ]


# --- App: rides.migrations - File: 0011_rename_zipcodep1_ride_zipcode_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-14 02:11

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0010_alter_contrsectionridemkt_ride'),
    ]

    operations = [
        migrations.RenameField(
            model_name='ride',
            old_name='ZipCodeP1',
            new_name='ZipCode',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='CityMunicipalityID',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='CountryID',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='DistrictRegionID',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='RegionStateID',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='ZipCodeP2',
        ),
    ]


# --- App: rides.migrations - File: 0033_booking_api_booking_id_ride_api_ride_id.py ---

# Generated by Django 4.0.1 on 2023-02-06 13:23

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0032_alter_contrsectionridemkt_hashkey'),
    ]

    operations = [
        migrations.AddField(
            model_name='booking',
            name='API_booking_ID',
            field=models.IntegerField(default=0, help_text='Booking id from API'),
        ),
        migrations.AddField(
            model_name='ride',
            name='API_ride_ID',
            field=models.IntegerField(default=0, help_text='Booking id from API'),
        ),
    ]


# --- App: rides.migrations - File: 0032_alter_contrsectionridemkt_hashkey.py ---

# Generated by Django 4.0.1 on 2023-01-29 18:06

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0031_remove_booking_options_remove_booking_ridetime_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='contrsectionridemkt',
            name='HashKey',
            field=models.CharField(blank=True, help_text='Market hash key', max_length=30),
        ),
    ]


# --- App: rides.migrations - File: 0014_contrsectionridemkt_name.py ---

# Generated by Django 4.0.1 on 2023-01-16 00:49

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0013_remove_ride_regionstate_alter_ride_floor'),
    ]

    operations = [
        migrations.AddField(
            model_name='contrsectionridemkt',
            name='Name',
            field=models.CharField(default='Test', help_text='Service name', max_length=50),
        ),
    ]


# --- App: rides.migrations - File: 0010_alter_contrsectionridemkt_ride.py ---

# Generated by Django 4.0.1 on 2023-01-11 03:06

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0009_ride_closed_alter_ride_canceled_alter_ride_deleted'),
    ]

    operations = [
        migrations.AlterField(
            model_name='contrsectionridemkt',
            name='Ride',
            field=models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='market_booking', to='rides.ride'),
        ),
    ]


# --- App: rides.migrations - File: 0016_booking_ridetime_ride_time_alter_booking_image_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-18 11:39

from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
        ('rides', '0015_contrsectionridemkt_miss_contrsectionridemkt_rank_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='booking',
            name='RideTime',
            field=models.TimeField(default=django.utils.timezone.now, help_text='Appointment time of the day.'),
        ),
        migrations.AddField(
            model_name='ride',
            name='Time',
            field=models.TimeField(blank=True, default=django.utils.timezone.now, help_text='Ride time of the day.'),
        ),
        migrations.AlterField(
            model_name='booking',
            name='Image',
            field=models.ForeignKey(blank=True, help_text='Video requisits', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.image'),
        ),
        migrations.AlterField(
            model_name='booking',
            name='RideDate',
            field=models.DateField(help_text='Appointment date.'),
        ),
        migrations.AlterField(
            model_name='booking',
            name='Sound',
            field=models.ForeignKey(blank=True, help_text='Sound requisits', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.sound'),
        ),
    ]


# --- App: rides.migrations - File: 0020_remove_ride_equipment_remove_ride_expectduration_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-19 19:14

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0019_remove_ride_time_ride_requisits'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='ride',
            name='Equipment',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='ExpectDuration',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='Image',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='LocalWifi',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='PublicEvent',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='Sound',
        ),
        migrations.AlterField(
            model_name='ride',
            name='Requisits',
            field=models.CharField(blank=True, default='', help_text='Service Requisits', max_length=30),
        ),
        migrations.AlterField(
            model_name='ride',
            name='RideType',
            field=models.CharField(blank=True, default='', help_text='Ride Type', max_length=20),
        ),
        migrations.AlterField(
            model_name='ride',
            name='ServiceCategory',
            field=models.CharField(blank=True, default='', help_text='Service Category', max_length=20),
        ),
    ]


# --- App: rides.migrations - File: 0031_remove_booking_options_remove_booking_ridetime_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-28 23:25

from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
        ('rides', '0030_booking_apirequiresdashboardurl_and_more'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='booking',
            name='Options',
        ),
        migrations.RemoveField(
            model_name='booking',
            name='RideTime',
        ),
        migrations.AddField(
            model_name='booking',
            name='Equipment',
            field=models.ForeignKey(blank=True, help_text='Required equipment', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_equipment', to='core.equipment'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Stock_Id',
            field=models.IntegerField(default=0, help_text='Stock Id'),
        ),
        migrations.AddField(
            model_name='booking',
            name='localwifi',
            field=models.ForeignKey(blank=True, help_text='Local wifi', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_wifi', to='core.localwifi'),
        ),
        migrations.AddField(
            model_name='booking',
            name='publicevent',
            field=models.ForeignKey(blank=True, help_text='Public event', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='service_public', to='core.publicevent'),
        ),
        migrations.AlterField(
            model_name='booking',
            name='RideDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Appointment date.'),
        ),
    ]


# --- App: rides.migrations - File: __init__.py ---



# --- App: rides.migrations - File: 0017_alter_booking_ridedate.py ---

# Generated by Django 4.0.1 on 2023-01-18 11:44

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0016_booking_ridetime_ride_time_alter_booking_image_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='booking',
            name='RideDate',
            field=models.DateField(default=django.utils.timezone.now, help_text='Appointment date.'),
        ),
    ]


# --- App: rides.migrations - File: 0007_paymentlog.py ---

# Generated by Django 4.0.1 on 2022-12-13 22:08

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('rides', '0006_contrsectionridemkt_user'),
    ]

    operations = [
        migrations.CreateModel(
            name='paymentlog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('PlantformUserType', models.CharField(help_text='User type', max_length=10, unique=True)),
                ('OperationType', models.CharField(help_text='Operation type', max_length=10, unique=True)),
                ('SettlementDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Transation settlement date')),
                ('PaymMethodResul', models.CharField(help_text='Payment result', max_length=100, unique=True)),
                ('StripTransactionID', models.CharField(help_text='Strip Transation ID', max_length=20, unique=True)),
                ('SurooBankTransactionID', models.CharField(help_text='Bank Transation ID', max_length=20, unique=True)),
                ('Value', models.DecimalField(decimal_places=8, default=0, help_text='Value', max_digits=12)),
                ('is_debit', models.BooleanField(default=False, help_text='True if it is a debit.')),
                ('RegistrationDate', models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.')),
                ('Booking', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payment_booking', to='rides.booking')),
                ('PlantformUser', models.ForeignKey(blank=True, default='', help_text='payment_user', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('Ride', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payment_ride', to='rides.booking')),
            ],
            options={
                'verbose_name_plural': 'Payment log',
            },
        ),
    ]


# --- App: rides.migrations - File: 0025_messageboard_date.py ---

# Generated by Django 4.0.1 on 2023-01-24 11:00

from django.db import migrations, models
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0024_remove_messageboard_date'),
    ]

    operations = [
        migrations.AddField(
            model_name='messageboard',
            name='Date',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.'),
        ),
    ]


# --- App: rides.migrations - File: 0019_remove_ride_time_ride_requisits.py ---

# Generated by Django 4.0.1 on 2023-01-19 18:29

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0018_ride_equipment_ride_ridedate'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='ride',
            name='Time',
        ),
        migrations.AddField(
            model_name='ride',
            name='Requisits',
            field=models.CharField(blank=True, help_text='Service Requisits', max_length=30),
        ),
    ]


# --- App: rides.migrations - File: 0028_messageboard_user.py ---

# Generated by Django 4.0.1 on 2023-01-24 11:04

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('rides', '0027_remove_messageboard_booking_remove_messageboard_user'),
    ]

    operations = [
        migrations.AddField(
            model_name='messageboard',
            name='user',
            field=models.ForeignKey(blank=True, default='', help_text='API_user', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='message_user', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: rides.migrations - File: 0024_remove_messageboard_date.py ---

# Generated by Django 4.0.1 on 2023-01-24 10:56

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0023_rename_service_messageboard_booking_and_more'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='messageboard',
            name='Date',
        ),
    ]


# --- App: rides.migrations - File: 0012_ride_floor.py ---

# Generated by Django 4.0.1 on 2023-01-15 16:35

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0011_rename_zipcodep1_ride_zipcode_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='ride',
            name='Floor',
            field=models.CharField(blank=True, default='', help_text='Floor', max_length=10),
        ),
    ]


# --- App: rides.migrations - File: 0030_booking_apirequiresdashboardurl_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-24 12:58

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('kit', '0001_initial'),
        ('rides', '0029_remove_booking_apirequiresdashboardurl_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='booking',
            name='APIrequiresDashboardURL',
            field=models.BooleanField(default=True, help_text='True if API requires dashdoards'),
        ),
        migrations.AddField(
            model_name='booking',
            name='APIrequiresMettingURL',
            field=models.BooleanField(default=True, help_text='True if meeting URL must be sent to API'),
        ),
        migrations.AddField(
            model_name='booking',
            name='AgentRank',
            field=models.ForeignKey(blank=True, help_text='Surrogate rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_surrrank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Blocked',
            field=models.BooleanField(default=False, help_text='Ride blocked by Suroga.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Canceled',
            field=models.BooleanField(default=False, help_text='Ride canceled via API'),
        ),
        migrations.AddField(
            model_name='booking',
            name='CanceledAgent',
            field=models.BooleanField(default=False, help_text='True if ride canceled by surrogate'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ClientKey',
            field=models.CharField(blank=True, help_text='Client Key', max_length=10),
        ),
        migrations.AddField(
            model_name='booking',
            name='ClientRank',
            field=models.ForeignKey(blank=True, help_text='Client rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_clientrank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Completed',
            field=models.BooleanField(default=False, help_text='True if service selected'),
        ),
        migrations.AddField(
            model_name='booking',
            name='DashboardClientURL',
            field=models.CharField(blank=True, help_text='Client dasboard on surooAPI', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='DashboardSurrogateURL',
            field=models.CharField(blank=True, help_text='Surrogate dasboard on surooAPI', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='Deleted',
            field=models.BooleanField(default=False, help_text='Ride deleted via API'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Description',
            field=models.TextField(blank=True, help_text='Service Description', max_length=1000),
        ),
        migrations.AddField(
            model_name='booking',
            name='Disputed',
            field=models.BooleanField(default=False, help_text='True if ride is in dispute'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Error',
            field=models.BooleanField(default=False, help_text='True if error on seelction process'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ErrorMessages',
            field=models.TextField(blank=True, help_text='Error message', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='ExpectDuration',
            field=models.ForeignKey(blank=True, help_text='Expected service duration.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.rideduration'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Expired',
            field=models.BooleanField(default=False, help_text='True if selection expired'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ExtraPrice',
            field=models.DecimalField(decimal_places=2, default=0.0, help_text='Extra price.', max_digits=5),
        ),
        migrations.AddField(
            model_name='booking',
            name='FinalDuration',
            field=models.DecimalField(decimal_places=2, default=0, help_text='Distance to go in doing the service.', max_digits=5),
        ),
        migrations.AddField(
            model_name='booking',
            name='GeneratePaymentLink',
            field=models.BooleanField(default=False, help_text='True if API requires payment link'),
        ),
        migrations.AddField(
            model_name='booking',
            name='HashKey',
            field=models.CharField(blank=True, editable=False, help_text='Service hash key.', max_length=30),
        ),
        migrations.AddField(
            model_name='booking',
            name='Image',
            field=models.ForeignKey(blank=True, help_text='Video requisits', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.image'),
        ),
        migrations.AddField(
            model_name='booking',
            name='InvitationAccepted',
            field=models.BooleanField(default=False, help_text='True if invitation was accepted by surrogate'),
        ),
        migrations.AddField(
            model_name='booking',
            name='InvitationSend',
            field=models.BooleanField(default=False, help_text='True if invitation was sent to surrogate'),
        ),
        migrations.AddField(
            model_name='booking',
            name='KitPack',
            field=models.ForeignKey(blank=True, help_text='kit', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_kit', to='kit.kitstock'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Kit_Ref_Number',
            field=models.CharField(blank=True, editable=False, help_text='Kit Ref Number', max_length=15),
        ),
        migrations.AddField(
            model_name='booking',
            name='MeetingPasswd',
            field=models.CharField(blank=True, help_text='The meeting password/pin', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='MeetingURL',
            field=models.CharField(blank=True, help_text='The meeting link', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='Options',
            field=models.TextField(blank=True, help_text='JSON: Stock options', max_length=1000),
        ),
        migrations.AddField(
            model_name='booking',
            name='PaymentCODE',
            field=models.CharField(blank=True, help_text='Payment proof code.', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='PaymentLink',
            field=models.CharField(blank=True, help_text='Link in Stripe to use for payment.', max_length=100),
        ),
        migrations.AddField(
            model_name='booking',
            name='RegistrationDate',
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False, help_text='Date of this registration.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Request_Id',
            field=models.CharField(blank=True, editable=False, help_text='API request ID', max_length=20),
        ),
        migrations.AddField(
            model_name='booking',
            name='RequisitsSatisfied',
            field=models.BooleanField(default=False, help_text='True if ride riquisites were satisfied'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideDate',
            field=models.DateField(default=django.utils.timezone.now, help_text='Appointment date.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideEndDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Date ride end.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideEnded',
            field=models.BooleanField(default=False, help_text='Ride ended.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideStartDate',
            field=models.DateTimeField(default=django.utils.timezone.now, help_text='Date ride start.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideStarted',
            field=models.BooleanField(default=False, help_text='Ride started.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='RideTime',
            field=models.TimeField(default=django.utils.timezone.now, help_text='Appointment time of the day.'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SelectStock',
            field=models.BooleanField(default=False, help_text='True if stock must be selected'),
        ),
        migrations.AddField(
            model_name='booking',
            name='ServiceTitle',
            field=models.CharField(blank=True, help_text='Service title', max_length=400),
        ),
        migrations.AddField(
            model_name='booking',
            name='Sound',
            field=models.ForeignKey(blank=True, help_text='Sound requisits', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.sound'),
        ),
        migrations.AddField(
            model_name='booking',
            name='StockSelected',
            field=models.BooleanField(default=False, help_text='True if stock was selected'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierARank',
            field=models.ForeignKey(blank=True, help_text='Supplier A rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Arank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierBRank',
            field=models.ForeignKey(blank=True, help_text='Supplier B rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Brank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierCRank',
            field=models.ForeignKey(blank=True, help_text='Supplier C rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Crank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierDRank',
            field=models.ForeignKey(blank=True, help_text='Supplier D rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Drank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierERank',
            field=models.ForeignKey(blank=True, help_text='Supplier E rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Erank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='SupplierFRank',
            field=models.ForeignKey(blank=True, help_text='Supplier F rating', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_Fank', to='rides.rating'),
        ),
        migrations.AddField(
            model_name='booking',
            name='Surrogate',
            field=models.ForeignKey(blank=True, help_text='Surrogate with account', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='booking_agent', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='booking',
            name='SurrogateKey',
            field=models.CharField(blank=True, help_text='Client Key', max_length=10),
        ),
        migrations.AddField(
            model_name='booking',
            name='SystemInfo',
            field=models.TextField(blank=True, help_text='JSON: System information', max_length=1000),
        ),
        migrations.AddField(
            model_name='booking',
            name='closed',
            field=models.BooleanField(default=False, help_text='True if service was completed'),
        ),
    ]


# --- App: rides.migrations - File: 0026_alter_messageboard_user.py ---

# Generated by Django 4.0.1 on 2023-01-24 11:02

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('rides', '0025_messageboard_date'),
    ]

    operations = [
        migrations.AlterField(
            model_name='messageboard',
            name='user',
            field=models.ForeignKey(blank=True, default='', help_text='API_user', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='message_user', to=settings.AUTH_USER_MODEL),
        ),
    ]


# --- App: rides.migrations - File: 0013_remove_ride_regionstate_alter_ride_floor.py ---

# Generated by Django 4.0.1 on 2023-01-15 17:44

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0012_ride_floor'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='ride',
            name='RegionState',
        ),
        migrations.AlterField(
            model_name='ride',
            name='Floor',
            field=models.CharField(blank=True, help_text='Floor', max_length=10),
        ),
    ]


# --- App: rides.migrations - File: 0018_ride_equipment_ride_ridedate.py ---

# Generated by Django 4.0.1 on 2023-01-19 01:39

from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0019_equipment_token_image_token_localwifi_token_and_more'),
        ('rides', '0017_alter_booking_ridedate'),
    ]

    operations = [
        migrations.AddField(
            model_name='ride',
            name='Equipment',
            field=models.ForeignKey(blank=True, help_text='Equipment used', null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.equipment'),
        ),
        migrations.AddField(
            model_name='ride',
            name='RideDate',
            field=models.DateTimeField(blank=True, default=django.utils.timezone.now, help_text='Ride time and date.'),
        ),
    ]


# --- App: rides.migrations - File: 0023_rename_service_messageboard_booking_and_more.py ---

# Generated by Django 4.0.1 on 2023-01-24 01:01

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0022_messageboard'),
    ]

    operations = [
        migrations.RenameField(
            model_name='messageboard',
            old_name='Service',
            new_name='booking',
        ),
        migrations.RemoveField(
            model_name='messageboard',
            name='index',
        ),
        migrations.AlterField(
            model_name='messageboard',
            name='SendByClient',
            field=models.BooleanField(default=False, help_text='True if message was sent by client'),
        ),
    ]


# --- App: rides.migrations - File: 0034_remove_booking_api_booking_id_and_more.py ---

# Generated by Django 4.0.1 on 2023-02-06 13:26

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0033_booking_api_booking_id_ride_api_ride_id'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='booking',
            name='API_booking_ID',
        ),
        migrations.RemoveField(
            model_name='ride',
            name='API_ride_ID',
        ),
    ]


# --- App: rides.migrations - File: 0003_remove_booking_ridetiem.py ---

# Generated by Django 4.0.1 on 2022-12-10 11:11

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0002_ride_notavailable'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='booking',
            name='RideTiem',
        ),
    ]


# --- App: rides.migrations - File: 0008_rename_plantformuser_paymentlog_user.py ---

# Generated by Django 4.0.1 on 2022-12-13 23:17

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('rides', '0007_paymentlog'),
    ]

    operations = [
        migrations.RenameField(
            model_name='paymentlog',
            old_name='PlantformUser',
            new_name='user',
        ),
    ]


